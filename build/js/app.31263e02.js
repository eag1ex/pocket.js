window.Pocket=function(t){function e(e){for(var r,o,s=e[0],u=e[1],c=e[2],d=0,f=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(l&&l(e);f.length;)f.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,s=1;s<n.length;s++){var u=n[s];0!==i[u]&&(r=!1)}r&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},i={0:0},a=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window.webpackJsonpPocket=window.webpackJsonpPocket||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var l=u;return a.push([2,1]),n()}([function(t,e,n){function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var i=n(3),a=n(7);e.uniq=function(t){return t.filter((function(t,e,n){return n.indexOf(t)===e}))},e.objectSize=function(t){return t&&Object.prototype===t.__proto__?Object.entries(t).length:0},e.last=function(t){return t&&Array.prototype===t.__proto__?t[t.length-1]:null},e.copyBy=function(t,e){return e.reduce((function(e,n,r){return void 0!==t[n]&&(e[n]=t[n]),e}),{})},e.validID=function(t){return t?(t||"").toString().toLowerCase():null},e.isNumber=function(t){return void 0!==t&&t.__proto__===Number.prototype},e.isPromise=function(t){return Promise.prototype===(t||{}).__proto__},e.uniq=function(t){return t.filter((function(t,e,n){return n.indexOf(t)===e}))},e.isObject=function(t){return!!t&&(Object.prototype===t.__proto__||t instanceof Object)},e.isArray=function(t){return!!t&&Array.prototype===t.__proto__},e.isString=function(t){return!!t&&String.prototype===t.__proto__},e.isFunction=function(t){return"function"==typeof t},e.log=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e=(e=[].concat("[Pocket]",e)).map((function(t){return i.inspect(t,!1,3,!0)})),console.log.apply(null,e)},e.warn=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e=(e=[].concat("[warning]",e)).map((function(t){return a.cyan(i.inspect(t,!1,2,!1),!0)})),console.warn.apply(null,e)},e.onerror=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e=(e=[].concat("[error]",e)).map((function(t){return a.red(i.inspect(t,!1,2,!1),!0)})),console.log("  "),console.error.apply(null,e),console.log("  ")},e.copy=function(t){if(!t)return t;try{return JSON.parse(JSON.stringify(t))}catch(t){return t.toString()}},e.errorMessages=function(t){for(var e={},n=0,i=Object.entries(t);n<i.length;n++){var a=(u=i[n],c=2,function(t){if(Array.isArray(t))return t}(u)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(u,c)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(u,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],s=a[1];e[o]={message:s[0],code:o}}var u,c;return e}},,function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=l(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,a=!0,o=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){o=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function l(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");var n,r;t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&(n=t,r=e,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(n,r))}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g(t);if(e){var i=g(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}function b(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(){var t=n(0),e=t.objectSize,r=t.log,a=t.onerror,l=t.warn,d=t.isArray,h=t.isObject,b=t.isPromise,m=t.validID,k=n(1),_=n(9)(),O=n(11),P=function(t){y(n,t);var e=v(n);function n(t,r){return f(this,n),e.call(this,t,r)}return p(n,[{key:"$payload",value:function(t,e){var r=this,o=function(t){return r.d=t,r},s=void 0!==e?e:this.async;return s&&b(t)?o(t.then((function(t){return i(g(n.prototype),"$payload",r).call(r,t)}),(function(t){return t}))):this.async||b(t)?(this.debug&&a("[payload] with opts.async=true, data must be a promise, or do not set async when not a promise"),o(!!s&&Promise.reject())):o(i(g(n.prototype),"$payload",this).call(this,t))}},{key:"$project",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.$payload.apply(this,e)}},{key:"$ready",value:function(t){var e,r=this;return e=i(g(n.prototype),"$ready",this).call(this,t).then((function(e){return r.deletePocketSet(t),e}),(function(t){return Promise.reject(t)})),r.d=e,r}}]),n}(function(t){y(i,t);var n=v(i);function i(t,e){var a;return f(this,i),(a=n.call(this,t,e)).dispatcher&&a.dispatcher.initListener().subscribe((function(t){var e=t||{},n=e.probe,i=e.status;"error"===i&&a.debug&&r("[dispatcher] probe id:".concat(n.id," error")),"open"===i&&a.debug&&r("[dispatcher] probe id:".concat(n.id," created")),"complete"===i&&a.debug&&r("[dispatcher] probe id:".concat(n.id," completed"))})),a}return p(i,[{key:"$payload",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.d=null,!h(e))return!1;var n=Object.keys(e);if(n.every((function(t){return-1===["id","tasks"].indexOf(t)})))return this.debug&&a("[$payload] id and tasks are required"),!1;if(!d(e.tasks))return this.debug&&a("[$payload] data.tasks must be an array"),!1;if(e.id=this.validProjectID(e.id),!e.id)return this.debug&&a("[$payload] data.id invalid"),!1;if(this.payloadData[e.id])return this.debug&&l("[$payload] this payload.id already exists"),!1;var r,i=c(e.tasks.values());try{var o=function(){var n=r.value;return n.task?t.idRegexValid(n.task)&&-1===n.task.indexOf("::")?(t.payloadData[e.id]||(t.payloadData[e.id]={value:[],status:"open",timestamp:(new Date).getTime()}),t.payloadData[e.id].value.filter((function(t){return-1!==t.task.indexOf(n.task)})).length?(t.debug&&l('the same task "'.concat(n.task,'" already exists on the payload, you must choose uniq')),"continue"):(t.payloadData[e.id].value.push(n),void(t.lastPocketTimestamp=t.payloadData[e.id].timestamp))):(t.debug&&l("[$payload] invalid taskName, failed idRegexValid validation"),"continue"):(t.debug&&l("[$payload] task must be set for your tasks"),"continue")};for(i.s();!(r=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}return!!this.payloadData[e.id]&&(this.lastProjectID(e.id),this.distributor().setDefer(e.id),!0)}},{key:"$get",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e){return t.d=e,n?t:t.d};return this.d=null,r((e=this.lastProbeID(e))?this.pocket[e]:null)}},{key:"$probeStatusAsync",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=function(e){return t.d=e,t};return n((e=this.lastProbeID(e))?this.pocket[e].getStatusAsync:null)}},{key:"$update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this._setUpdate(t,e,n,"update")}},{key:"$set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._setUpdate(t,null,e,"set")}},{key:"$activeTasks",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=function(e){return t.d=e,t};if(n=this.lastProjectID(n),!e(this.pocket))return r([]);var i=Object.entries(this.pocket).reduce((function(e,r){var i=u(r,2),a=i[0],o=i[1];return 0===a.indexOf(n||"")&&n&&t.payloadData[n]?e.push(o.task):n||e.push(o.task),e}),[]);return r(i)}},{key:"$ready",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.d=null,!(t=this.lastProjectID(t)))throw"payloadID must be set";if(!this._ready[t])throw"ready[payloadID] is not set, maybe you called it before $payload()";return this._ready[t].promise()}},{key:"_setUpdate",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update",o=function(t){return e.d=t,e},c=this.lastProbeID(r);if(!c)return this.debug&&a("[$update] must specify id"),o(!1);if(!h(t))return this.debug&&l("[$update] dataFrom must be an "),o(!1);if(!this.pocket[c])return this.debug&&a("[$update] this.pocket with id:".concat(c," not found")),o(!1);var d=!1;t=Object.entries(t).reduce((function(t,n){var r=u(n,2),i=r[0],a=r[1],o=e.probeProps.indexOf(i);return e.probeProps[o]===i&&t.push({inx:o,data:s({},i,a)}),t}),[]);for(var f=0;f<t.length;f++)if(void 0!==(t[f]||{}).data){var p=u(Object.entries(t[f].data)[0],2),y=p[0],v=p[1];"id"===y||"task"===y||void 0===this.pocket[c][y]?this.debug&&l("[$update] not a valid propName: ".concat(y)):(this.pocket[c][y]="data"===y&&!0===n?Object.assign({},this.pocket[c][y],v):v,d=!0)}return d&&"set"===i&&(this.clearStoreTransfers(c),this.$transfer_lastID===c&&(this.$transfer_lastID=""),this._$cached_data[c]&&delete this._$cached_data[c]),o(d)}},{key:"setDefer",value:function(t){var n=this;if(!(t=m(t)))throw"id must be set";if(this._ready[t]||(this._ready[t]=k()),!e(this.pocket)){var r="[setDefer] probe is empty, so nothing set, id:".concat(t);return this.debug&&a(r),this._ready[t].reject(r),null}var i=Object.values(this.pocket).filter((function(e){return-1!==e.id.indexOf(t)}));if(!i.length){var o="[setDefer] no pocketSet found for id:".concat(t," ");return this.debug&&a(o),this._ready[t].reject(o),null}try{return Promise.all(i.map((function(t){return t.sq.promise()}))).then((function(e){var r=e.map((function(t){return function(t){var e={};if(!h(t))return null;for(var r=0;r<n.probeProps.length;r++){var i=n.probeProps[r];t[i]&&(e[i]=t[i])}return e}(t.probe)})).filter((function(t){return!!t}));n._ready[t].resolve(r)}),(function(t){a("[setDefer] Promise.all",t)})),!0}catch(t){a("[setDefer]",t)}return!1}},{key:"distributor",value:function(){for(var t=0,e=Object.entries(this.payloadData);t<e.length;t++){var n=u(e[t],2),r=n[0],i=n[1];if(!(this.lastPocketTimestamp>i.timestamp)&&"complete"!==i.status&&"send"!==i.status&&"error"!==i.status){var s,l=c(i.value.values());try{for(l.s();!(s=l.n()).done;){var d=o({id:r},s.value);this.setProbe(d)||a("probe for id:".concat(r," already exists"))}}catch(t){l.e(t)}finally{l.f()}}}return this}},{key:"setProbe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.id||!t.task)throw"id and task both must be set";if(!m(t.id))throw"opts.id not valid";var e="".concat(t.id,"::").concat(t.task);if(this.pocket[e])return this.debug&&r("[setProbe] probe: ".concat(e," already set")),null;try{t.id=e;var n=new this.Probe(t,this.debug);this.pocket[e]=n}catch(t){return a(t),null}return this.pocket[e]}},{key:"_emit",value:function(t){if(!t)return null;if(!this.dispatcher)return null;try{return this.dispatcher.initListener().next(t),!0}catch(t){return a("[_emit] dispatcher did not emit"),null}}},{key:"deletePocketSet",value:function(t){if(Object.values(this.pocket).length)for(var e=0,n=Object.values(this.pocket);e<n.length;e++){var r=n[e];this._$cached_data[r.id]&&delete this._$cached_data[r.id],r.id.includes(t)&&delete this.pocket[r.id]}this.payloadData[t]&&delete this.payloadData[t],this._ready[t]&&delete this._ready[t],this.clearStoreTransfers(t)}},{key:"Probe",get:function(){return O(this)}}]),i}(_));return n(12)(P)}},,,,,,,function(t,e,n){function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(){var t=n(0),e=t.objectSize,i=t.warn,s=t.validID,u=t.copy,c=t.log,l=t.isString;return function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;a(this,t),this.debug=r||!1,this.async=(e||{}).async||null,this.dispatcher=(e||{}).dispatcher?n(10)():null,this.pocket={},this.payloadData={},this.lastPocketTimestamp=0,this._lastProjectID=null,this._lastProbeID=null,this._$cached_data={},this.$transfer_lastID="",this._ready={},this.d=void 0,this._transferCached=[]}var d,f;return d=t,(f=[{key:"clearStoreTransfers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var n=!1;return this._transferCached.length&&this._transferCached.forEach((function(r,i){var a=(r||{}).fromProbeID;a&&-1!==a.indexOf(e)&&(t._transferCached.splice(i,1),n=!0,t.debug&&c("[clearStoreTransfers] transferCached for probeID: ".concat(a," has been removed")))})),n}}},{key:"storeTransfers",value:function(t,e){return this._transferCached.push({timestamp:(new Date).getTime(),fromProbeID:t,data:e}),this._transferCached}},{key:"accessLastValidTransfer",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!this._transferCached.length)return{};this._transferCached.sort((function(t,e){return t.timestamp-e.timestamp}));var r=u(this._transferCached),i=r.reduce((function(e,r,i){var a=r.timestamp,o=(new Date).getTime()+n;return o>a&&o-a-n<=n&&(e=r,t._transferCached.splice(i,1)),e}),{});return e(i)?i:{}}},{key:"selectByTask",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e=l(e)?e:"",!this.idRegexValid(e)&&e)return null;if(console.log("what is taskOrProbeID",e),e.indexOf(":")>0&&!this.pocket[e])return this.debug&&i("[selectByTask] when using '::' prefix selector, it should come at 0 index"),null;if(e.split(":").length>3||2===e.split(":").length)return this.debug&&i("[selectByTask] wrong taskName :".concat(e,", allowed prefix is '::taskName'")),null;if(n&&this.lastProbeID(e,!0),this.pocket[e])return n&&this.lastProbeID(e),e;var r=function(e){var n=e.split("::")[1]||e;return(t._lastProbeID||"").indexOf(n)>0&&n?t._lastProbeID:t._lastProjectID&&n?t._lastProjectID+"::"+n:t._lastProbeID},a=r(e);return a?n&&this.lastProbeID(a):this.debug&&i("[selectByTask] newProbeID was not found from taskOrProbeID: ".concat(e)),a}},{key:"lastProjectID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t&&this._lastProbeID&&(t=this._lastProjectID),(t=this.validProjectID(t,e))?(this.payloadData[t]&&(this._lastProjectID=t),t):null}},{key:"lastProbeID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t&&this._lastProbeID&&(t=this._lastProbeID),(t=this.validProbe(t,e))?(this.pocket[t]&&(this._lastProbeID=t),t):null}},{key:"validProjectID",value:function(t){return(t=s(t))?(t||"").split(" ").length>1?null:this.idRegexValid(t)?t:null:null}},{key:"dataPropSelector",value:function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data()",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{return t=Object.entries(o).reduce((function(t,e,n){var i=r(e,2),a=i[0];return i[1],void 0!==u[a]&&(t[a]=u[a]),t}),{}),e(t)||(t=void 0),e(t)+e(o)===2&&(t=Object.values(t).shift()),"data()"===n&&(this._$cached_data[a]=t),s?this:t}catch(e){return this.debug&&i("[$data] no dataProp found on probeID: ".concat(a)),"data()"===n&&(this._$cached_data[a]=t),s?this:t}}},{key:"idRegexValid",value:function(t){return!new RegExp(/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi,"gi").test(t)||null}},{key:"validProbe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(t=s(t))?this.idRegexValid(t)?-1===t.indexOf("::")?null:this.pocket[t]?t:(this.debug&&null===e&&i("[get] did not find probe with probeID ".concat(t)),null):void 0:null}},{key:"probeProps",get:function(){return["compaign","data","task","id","status"]}}])&&o(d.prototype,f),t}()}},function(t,e){t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new function(){var n=this,r="[dispatcher]";this.uid=(t||"").toString()||(new Date).getTime(),this.debug=e,this.cbQueue={},this.dispatchInstance={},this.initListener=function(){return n.Dispatch(),n},this.next=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n.dispatchInstance[n.uid]?n.dispatchInstance[n.uid].next(t):n.debug&&console.log({message:"".concat(r," for uid not available"),uid:n.uid}),n},this.Dispatch=function(){if(n.dispatchInstance[n.uid])return n;var t=n;return n.dispatchInstance[n.uid]||(n.dispatchInstance[n.uid]=new function(){var e=this;this.uid=t.uid,this.data=null,this.next=function(n){"cb"!==(n||{}).type&&(e.data=n),"cb"!==(n||{}).type?e.data?"function"==typeof t.cbQueue[t.uid]&&t.cbQueue[t.uid](e.data,t.uid):e.debug&&console.log("".concat(r," no callback data")):"function"==typeof n.cb&&(t.cbQueue[t.uid]||(t.cbQueue[t.uid]=n.cb),e.data&&n.cb(e.data,t.uid))}}),n},this.del=function(){return delete n.cbQueue[n.uid],delete n.dispatchInstance[n.uid],!n.cbQueue[n.uid]&&n.dispatchInstance[n.uid],n},this.subscribe=function(t){return"function"==typeof t?(n.dispatchInstance[n.uid]||n.Dispatch(),n.dispatchInstance[n.uid]&&n.dispatchInstance[n.uid].next({type:"cb",cb:t}),n):(n.debug&&console.log("".concat(r,"[batchReady] cb must be set")),n)}}(t,e)}},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t){var e=n(0),a=e.isString,o=e.warn,s=e.log,u=e.isNumber,c=e.onerror,l=e.last,d=e.copy,f=e.isObject,h=n(1);return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(r(this,e),this.debug=n||!1,(u(t.id)||t.id)&&(t.id=t.id.toString()),!t.task||!a(t.task))throw"task as string is required";this._id=null,this._task=null,this._status=null,this._data=null,this._compaign=null,this._dataIndex=0,this._statusIndex=0,this._statusAsync=[],this.task=t.task,this.id=t.id,this.status="open",t.data!==this._data&&(this.data=t.data),t.compaign&&(this.compaign=t.compaign)}var n,p;return n=e,(p=[{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"complete"===this.status||"send"===this.status?(this.debug&&o("[Probe][update] cannot update data on complete status"),this):!f(t)&&e?(this.debug&&o("[Probe][update] cannot update none object 'data' with option 'merge=true' set"),this):(f(t)&&e?this.data=Object.assign({},this.data,t):void 0!==t&&(this.data=t),this)}},{key:"all",value:function(){return{compaign:this.compaign,data:this.data,id:this.id,task:this.task,status:this.status}}},{key:"onComplete",value:function(e){var n=this;("complete"===e||"error"===e)&&"send"!==this._status&&this._dataIndex>0&&(t&&setTimeout((function(){t&&t._emit({probe:n,status:e})})),this.sq.resolve({probe:this.all()}),this._status="send")}},{key:"onOpenStatus",value:function(e){var n=this;"open"===e&&setTimeout((function(){t&&t._emit({probe:n,status:"open"})}))}},{key:"sq",get:function(){return this._sq||(this._sq=h()),this._sq}},{key:"id",set:function(t){if(this._id)this.debug&&o("cannot update already set id: ".concat(this._id));else{if(!t)throw"id is required";if(t.split(" ").length>1)throw"each id cannot have spaces";if(-1===t.indexOf("::"))throw"each id must be of format id::taskName";if(-1!==t.indexOf(":::"))throw"each id must be of format id::taskName";var e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your id is invalid, allowed chars: ".concat(e);if(-1===(t=t.replace(/ /gi,"_").toLowerCase()).indexOf(this._task))throw"wrong id setup, your id should make up the taks name, example: id='cocacola::drink'";this._id=t}},get:function(){return this._id}},{key:"compaign",get:function(){return this._compaign},set:function(t){this._compaign?this.debug&&o("cannot update already set compaign ".concat(this._compaign)):t&&(a(t)?this._compaign=t:this.debug&&o("compaign must be a string",t))}},{key:"task",set:function(t){if(this._task)this.debug&&o("cannot update already set task");else if(t)if(a(t)){if(-1!==t.indexOf("::"))throw"task seperator :: is restricted";if(t.split(" ").length>1)throw"task cannot have spaces, use seperators: _+";var e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your task is invalid, allowed chars: ".concat(e);this._task=t.replace(/ /gi,"_").toLowerCase()}else this.debug&&o("task must be a string")},get:function(){return this._task}},{key:"data",set:function(t){if("complete"===this.status||"send"===this.status)return this.debug&&o("you cannot update data once the status is complete or send"),null;this._dataIndex++,"open"===this.status&&null!==this._data&&this._dataIndex>1&&(this.status="updated"),this._data=t},get:function(){return this._data}},{key:"statusStackOrder",get:function(){return{open:{value:1,set:!1},updated:{value:2,set:!1},complete:{value:3,set:!1},send:{value:4,set:!1},error:{value:5,set:!1}}}},{key:"status",get:function(){return this._status},set:function(t){var e=this;!function(n){try{if(e.statusStackOrder[n].value>2&&!0===e.statusStackOrder[n].set)return!1}catch(t){c("statusStackOrder invalid status")}if("complete"===e._status||"send"===e._status)return e.debug&&o("cannot update status if already complete, id:".concat(e.id)),!1;switch(n){case"open":if("updated"===e._status){e.debug&&o("cannot set status back to open once set to updated");break}e._status=n,e.statusStackOrder[n].set=!0,e.onOpenStatus(t),e.setStatusAsync=n;break;case"updated":if("complete"===e._status){e.debug&&o("cannot update status to 'updated' then previously set to 'complete'");break}e._dataIndex>0&&(e._status=n,e.statusStackOrder[n].set=!0,e.setStatusAsync=n,e.debug&&s("id:".concat(e.id,", data updated")));break;case"complete":e.statusStackOrder[n].set=!0,e.setStatusAsync=n,e._status=n,e.onComplete(t);break;case"send":if("complete"!==e._status){e.debug&&o("cannot update status to 'send' then previously not set to 'complete'");break}e._status=n,e.statusStackOrder[n].set=!0,e.setStatusAsync=n;break;case"error":if("complete"===e._status)return;e.statusStackOrder[n].set=!0,e.setStatusAsync=n,e.onComplete(t);break;default:e.debug&&o("id:".concat(e.id,",  you set invalid status: ").concat(n,", nothing changed"))}}(t)}},{key:"setStatusAsync",set:function(t){var e={timestamp:(new Date).getTime(),p:h()};this._statusAsync.push(e)},get:function(){var t=l(this._statusAsync.sort((function(t,e){return t.timestamp-e.timestamp})).map((function(t){return t.p})));return t.resolve(d(this.status)),t}},{key:"getStatusAsync",get:function(){return this.setStatusAsync.promise()}}])&&i(n.prototype,p),e}()}},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=n(0),r=e.copy,c=e.warn,l=e.isArray,d=e.onerror,f=e.objectSize,h=e.isString,p=e.uniq;return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(g,t);var e,n,y,v,b=(y=g,v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=u(y);if(v){var n=u(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return s(this,t)});function g(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g),b.call(this,t,e)}return e=g,(n=[{key:"$probeStatusAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);return a(u(g.prototype),"$probeStatusAsync",this).call(this,e)}},{key:"$get",value:function(t,e){t=this.selectByTask(t,!0);var n=this.lastProbeID(t);return a(u(g.prototype),"$get",this).call(this,n,e)}},{key:"$set",value:function(t,e){e=this.selectByTask(e,!0);var n=this.lastProbeID(e);return a(u(g.prototype),"$set",this).call(this,t,n)}},{key:"$probe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);if(this.pocket[e]){if("Probe"===this.pocket[e].constructor.name)return this.pocket[e];this.debug&&d("[$probe] probeID: ".concat(t," is not an instance of Probe{}"))}else this.debug&&c("[$probe] not found for probeID: ".concat(t))}},{key:"$update",value:function(t,e,n){n=this.selectByTask(n,!0);var r=this.lastProbeID(n);return a(u(g.prototype),"$update",this).call(this,t,e,r)}},{key:"$select",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=h(t)?t:"",this.lastProjectID(t),this}},{key:"$transfer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.selectByTask(t,!0),t=this.lastProbeID(t),this.pocket[t]?(this.storeTransfers(t,r(this.pocket[t].data)),this.$transfer_lastID=t,this):(this.debug&&c("[$transfer] no Probe{} found for this id fromProbeID:".concat(t)),this)}},{key:"$to",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(t=this.selectByTask(t,e),e&&(t=this.validProbe(t)),!t)return this.debug&&c("[$to] toProbeID is invalid"),this;if(!this.pocket[t])return this.debug&&c("[$to] no Probe{} found for this id toProbeID:".concat(t)),this;if(this.$transfer_lastID){var r=this.accessLastValidTransfer(n);if(f(r)){var i=r.fromProbeID,a=r.data;this.$transfer_lastID===i&&(this.pocket[i].data=null,this.pocket[t].data=a)}else this.debug&&c("[$to] no last valid transfer found");this.$transfer_lastID=""}return this}},{key:"$of",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.selectByTask(t,!0),this}},{key:"$data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=this.selectByTask(e,!0),this.pocket[e]?(l(t)&&(t||[]).length&&(t=p(t).reduce((function(t,e){return void 0!==e&&(t[e.trim()]=!0),t}),{})),t&&f(t)?this.dataPropSelector("data()",e,t,n,r(this.pocket[e].data)):(this._$cached_data[e]=r(this.pocket[e].data),n?this:this._$cached_data[e])):n?this:void 0}},{key:"$cached",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e=this.selectByTask(e,!0),this.pocket[e]){var n=void 0!==this._$cached_data[e]&&null!==this._$cached_data[e];if(n)return h(t)&&(t||"").length&&(t=p(t.trim().replace(/ /gi,"").split(",")).reduce((function(t,e){return void 0!==e&&(t[e]=!0),t}),{})),!f(this._$cached_data[e])&&n?f(t)?void 0:this._$cached_data[e]:t&&f(t)?this.dataPropSelector("cached()",e,t,!1,this._$cached_data[e]):void 0===this._$cached_data[e]?void 0:this._$cached_data[e]}}},{key:"$compaign",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?r(this.pocket[t].compaign):null}},{key:"$status",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?r(this.pocket[t].status):null}},{key:"$task",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?r(this.pocket[t].task):null}},{key:"$all",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?r(this.pocket[t].all()):null}}])&&i(e.prototype,n),g}(t)}}]);
//# sourceMappingURL=app.31263e02.js.map