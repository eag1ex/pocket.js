!function(t,e){for(var r in e)t[r]=e[r]}(window,function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){(function(r){var n,i,o,a;a=function(t){"use strict";var e=Number.prototype,n=String.prototype;function i(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.disableLogging=()=>{try{if(window)return window.xUtilsConfig?window.xUtilsConfig.logging="off":window.xUtilsConfig={logging:"off"},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig.logging="off":r.xUtilsConfig={logging:"off"},!0}catch(t){}return!1},t.resetLogging=()=>{try{if(window)return window.xUtilsConfig?window.xUtilsConfig.logging="on":window.xUtilsConfig={logging:"on"},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig.logging="on":r.xUtilsConfig={logging:"on"},!0}catch(t){}return!1},t.loggerSetting=function(t,e){if(void 0===t&&(t="log"),void 0===e&&(e="off"),!["log","warn","onerror","error","alert","attention","debug"].includes(t)||!t)return!1;if(!["on","off"].includes(e)||!e)return!1;"onerror"===t&&(t="error");try{if(window)return window.xUtilsConfig?window.xUtilsConfig[t]=e:window.xUtilsConfig={[t]:e},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig[t]=e:r.xUtilsConfig={[t]:e},!0}catch(t){}return!1};var o=t=>{try{if(window)return window.xUtilsConfig&&window.xUtilsConfig[t]?window.xUtilsConfig[t]:"on"}catch(t){}try{return r.xUtilsConfig&&r.xUtilsConfig[t]?r.xUtilsConfig[t]:"on"}catch(t){}return"on"},a=()=>{try{if(window)return"on"===(window.xUtilsConfig||{}).logging||void 0===(window.xUtilsConfig||{}).logging}catch(t){}try{return"on"===(r.xUtilsConfig||{}).logging||void 0===(r.xUtilsConfig||{}).logging}catch(t){}return!0},s=function(t,e){void 0===t&&(t=""),e.length||(e[0]="");var r=0===e.filter(t=>"string"==typeof t||void 0===t).length?"%o":"";"log"===t&&(e=[].concat("[90m[log][0m[2m"+r+" ",e,"[0m")),"debug"===t&&(e=[].concat("[90m[debug][0m[32m"+r+" ",e,"[0m")),"warn"===t&&(e=[].concat("[90m[warning][0m[1m"+r+" ",e,"[0m")),"alert"===t&&(e=[].concat("[90m[alert][0m[33m"+r+" ",e,"[0m")),"attention"===t&&(e=[].concat("[90m[attention][0m[36m"+r+" ",e,"[0m"));try{return void(window&&console.log.apply(null,e))}catch(t){}console.log.apply(null,e)},c=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];if(a()&&"off"!==o("error")&&"off"!==o("onerror")){e.length||(e[0]="");var n=0===e.filter(t=>"string"==typeof t||void 0===t).length,i=n?"%o":"";try{if(window)return e=[].concat("[31m[error][0m[31m"+i+" ",e,"[0m"),void console.error.apply(null,e)}catch(t){}e=[].concat("[41m[error][0m[31m"+i+" ",e,"[0m"),console.log.apply(null,e)}},u=(t.stack=function(t,e){if(void 0===e&&(e=!1),a()){var r=new Error(JSON.stringify(t)).stack.split("(");r.splice(1,1);var n=r[0].split(/\n/)[0].replace("Error","[STACK TRACE]");return r.splice(0,1),r.unshift(n),void(e?console.log(r):console.log.apply(null,r))}},t.errorTrace=function(t,e){if(void 0===e&&(e=!1),a()){var r=new Error(JSON.stringify(t)).stack.split("(");r.splice(1,1);var n=r[0].split(/\n/)[0].replace("Error","[ERROR]");return r.splice(0,1),r.unshift(n),void(e?console.error(r):console.error.apply(null,r))}},t.loop=function(t,e){if(void 0===t&&(t=0),"function"!=typeof e||"number"!=typeof t)return[];if(!t)return[];for(var r,n=[],i=0;i<Array(t).length;i++){r=e.apply(this,[i]);try{if(r&&Object.entries(r).length&&r.break)break}catch(t){}n.push(r)}return n},t=>!!t&&Array.prototype===t.__proto__),l=function(t,r){void 0===r&&(r=!0);var i=e=>r?typeof t:e||typeof t,o=e=>e.prototype===t.prototype;try{return"symbol"==typeof t?{type:i(),value:0,primitiveValue:Symbol("")}:void 0===t?{type:i(),value:0,primitiveValue:void 0}:"boolean"==typeof t?{type:i(),value:+t,primitiveValue:Boolean()}:"bigint"==typeof t&&"object"==typeof Object(t)?{type:i(),value:1,primitiveValue:BigInt("")}:null===t?{type:i("null"),value:0,primitiveValue:{}}:t.__proto__===Date.prototype||o(Date)?{type:i("date"),value:1,primitiveValue:new Date}:n===t.__proto__?{type:i(),value:t.length,primitiveValue:String()}:Array.prototype===t.__proto__||o(Array)?{type:i("array"),value:(t||[]).length,primitiveValue:[]}:Promise.prototype===(t||"").__proto__||o(Promise)?{type:i("promise"),value:1,primitiveValue:Function()}:Function.prototype===t.__proto__||o(Function)?{type:i(),value:1,primitiveValue:Function()}:Object.prototype===t.__proto__||o(Object)?{type:i(),value:Object.keys(t).length,primitiveValue:{}}:Error.prototype===t.__proto__||o(Error)?{type:i("error"),value:Object.keys(t).length,primitiveValue:Error()}:t.__proto__===e||o(Number)?isNaN(t)?{type:i("NaN"),value:0,primitiveValue:Number()}:{type:i(),value:t,primitiveValue:Number()}:0==0<=+t?{type:typeof t,value:+t,primitiveValue:void 0}:{type:typeof t,value:0,primitiveValue:void 0}}catch(t){return c(t),{}}},h=t=>Error.prototype===(t||"").__proto__,f=function(t){return void 0===t&&(t=null),void 0===t||!1===t&&"boolean"==typeof t||null===t||(n===t.__proto__?1>t.length:Array.prototype===t.__proto__?0===(t||[]).length:Promise.prototype!==(t||{}).__proto__&&"function"!=typeof t&&(Object.prototype===t.__proto__?0===Object.keys(t).length:Error.prototype!==t.__proto__&&(void 0!==t&&t.__proto__===e?!!isNaN(t)||0>=t:0==0<+t||!t&&!1)))},d=(t.isEmpty=t=>!h(t)&&!l(t).value,t.head=function(t){return void 0===t&&(t=[]),Array.prototype===(t||null).__proto__?t.flat().shift():[]},t.last=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?t[t.length-1]:null},t.timer=function(t,e){if(void 0===e&&(e=0),"function"!=typeof t)return null;e="number"==typeof e&&0<=e?e:0;var r=setTimeout(()=>{t(),clearTimeout(r)},e)},t.interval=function(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=0),"function"!=typeof t)return null;e="number"==typeof e&&0<=e?e:0,r="number"==typeof r&&0<=r?r:0;var n=0,i=setInterval(()=>{r<=n?clearInterval(i):t(),n+=e},e)},t.validID=function(t){return void 0===t&&(t=""),t?(t||"").toString().toLowerCase().replace(/\s/g,""):""},t.isNumber=t=>!(null==t||""===t)&&t.__proto__===e,t.objectSize=function(t){return void 0===t&&(t={}),t&&isNaN(+t)&&(Object.prototype===t.__proto__||Error.prototype===t.__proto__)?Object.keys(t).length:0},t.stringSize=function(t){return void 0===t&&(t=""),null!=t&&t.__proto__===n?t.length:0},t=>Promise.prototype===(t||{}).__proto__),p=t=>!("function"==typeof t||!isNaN(+t)||void 0===t||t.__proto__===[].__proto__||!((Object.prototype===t.__proto__||Error.prototype===t.__proto__)&&t instanceof Object||void 0!==t.__proto__&&void 0!==t.__proto__.__proto__&&t.__proto__.__proto__===Object.prototype&&t instanceof Object||t.prototype)),y=function(t){return void 0===t&&(t=[]),t.filter((t,e,r)=>r.indexOf(t)===e)},v=(t.selectiveArray=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=[{}]),!u(e))return[];if(!e.length)return[];if(!u(t))return e;if(!t.length)return e;t=y(t);for(var r,n=[],i=function t(e,r,n){var i;if(void 0===n&&(n=0),e&&u(e)&&e.length){try{if(void 0!==r[e[n]])return i=r[e[n]],e[++n]?t(e,i,n):i}catch(t){console.log(t.toString())}return i}},o=0;o<e.length;o++)if(r=e[o],p(r)){for(var a=void 0,s=[],c=0;c<t.length;c++)a=i((t[c]||"").split("."),r,0),s.push(a);t.length===s.length&&s.filter(t=>void 0===t).length===t.length&&(s=s.filter(t=>!!t)),s.length?n.push([].concat(s)):void 0!==a&&n.push(a)}else n.push([r]);return n},t=>!!t&&void 0!==t.prototype);t.hasPrototype=v,t.hasProto=t=>{try{return void 0!==t.__proto__}catch(t){return!1}},t.isString=t=>void 0!==t&&(""===t||n===t.__proto__),t.isFunction=t=>"function"==typeof t,t.copyBy=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=[]),!p(t))return{};var r=[].concat(e).reduce((e,r)=>(void 0!==t[r]&&(e[r]=t[r]),e),{});try{return JSON.parse(JSON.stringify(r))}catch(t){return{}}},t.copy=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return l(t).primitiveValue}},t.delay=function(t){return void 0===t&&(t=100),"number"==typeof t&&0<=t?new Promise(e=>{var r=setTimeout(()=>{clearTimeout(r),e(!0)},t)}):Promise.resolve(!0)},t.someKeyMatch=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||Object.prototype!==t.__proto__)return!1;if(!e||Object.prototype!==e.__proto__)return!1;var r=Object.keys(t),n=Object.keys(e);return r.length>=n.length?0<r.filter(t=>n.filter(e=>e===t).length).length:0<n.filter(t=>r.filter(e=>e===t).length).length},t.exactKeyMatch=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||Object.prototype!==t.__proto__)return!1;if(!e||Object.prototype!==e.__proto__)return!1;var r=Object.keys(t),n=Object.keys(e);return r.length>=n.length?r.filter(t=>n.filter(e=>e===t).length).length===r.length:n.filter(t=>r.filter(e=>e===t).length).length===n.length},t.trueVal=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?[].concat(t).filter(t=>!0!==f(t)):[]},t.trueValDeep=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?[].concat(t).map(t=>{var e=l(t,!1);return"array"===e.type&&0<e.value?t.map(t=>0<l(t,!1).value?t:null).filter(t=>!!t):"object"===e.type&&e.value?Object.entries(t).reduce((t,e)=>{var[r,n]=e;return 0<l(r,!1).value&&(t[r]=n),t},{}):0<e.value?t:null}).filter(t=>!!t):[]},t.trueProp=function(t){return void 0===t&&(t={}),t&&Object.prototype===t.__proto__?Object.assign({},Object.entries(t).reduce((t,e)=>{var[r,n]=e;return f(n)||(t[r]=n),t},{})):0},t.resolver=function(t,e,r){return void 0===e&&(e=5e3),void 0===r&&(r=50),"function"==typeof t?new Promise(n=>{var o=r||50,a=e,s=0,c=null,u=setInterval(function(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){function a(t){i(c,n,o,a,s,"next",t)}function s(t){i(c,n,o,a,s,"throw",t)}var c=t.apply(e,r);a(void 0)}))}}((function*(){if(s>=a)return n(void 0),clearInterval(u);var e=(()=>{try{return c||(c=t()),d(c)?c:t()}catch(t){return h(t)?{error:t}:p(t)?t.error?t:{error:t}:{error:t.toString()}}})();if(d(e))try{var r=yield e;return n(r),clearInterval(u)}catch(t){return h(t)&&n({error:t}),p(t)?t.error?n(t):n({error:t}):n({error:t.toString()}),clearInterval(u)}return void 0===e?void(s+=o):(n(e),clearInterval(u))})),o)}):Promise.reject("fn() must be callable")},t.flatten=function(t){return void 0===t&&(t=[]),u(t)?[].concat(...t):[]},t.flattenDeep=function(t){return void 0===t&&(t=[]),u(t)?function t(e,r){return void 0===r&&(r=1),0<r?e.reduce((e,n)=>e.concat(Array.isArray(n)?t(n,r-1):n),[]):e.slice()}(t,1/0):[]},t.chunks=(t,e)=>Array.from({length:Math.ceil(t.length/e)},(r,n)=>t.slice(n*e,n*e+e)),t.uniq=y,t.isPromise=d,t.debug=function(){if(a()&&"off"!==o("debug")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return s("debug",e)}},t.log=function(){if(a()&&"off"!==o("log")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return s("log",e)}},t.warn=function(){if(a()&&"off"!==o("warn")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return s("warn",e)}},t.onerror=c,t.error=c,t.alert=function(){if(a()&&"off"!==o("alert")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return s("alert",e)}},t.attention=function(){if(a()&&"off"!==o("attention")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return s("attention",e)}},t.isObject=p,t.isFalsy=f,t.isError=h,t.typeCheck=l,t.validDate=t=>{try{return!(t.__proto__!==Date.prototype||"Invalid Date"===t.toString())}catch(t){return!1}},t.isInstance=t=>!!t&&!u(t)&&!!(t.__proto__&&!v(t)&&t.__proto__.__proto__&&t.__proto__.__proto__===Object.prototype&&t instanceof Object),t.isClass=v,t.isArray=u,t.dupes=(t,e)=>{for(var r=[],n=parseInt(e);0<n;)n--,r.push(t);return r},t.notify=function(t,e){throw void 0===t&&(t=null),void 0===e&&(e=null),"no notify support for x-utils-es, use: x-utils"}},i=[e],void 0===(o="function"==typeof(n=a)?n.apply(e,i):n)||(t.exports=o)}).call(this,r(5))},function(t,e){t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new function(t,e){var r=this,n="[dispatcher]";this.uid=(t||"").toString()||(new Date).getTime(),this.debug=e,this.cbQueue={},this.dispatchInstance={},this.initListener=function(){return r.Dispatch(),r},this.next=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r.dispatchInstance[r.uid]?r.dispatchInstance[r.uid].next(t):r.debug&&console.log({message:"".concat(n," for uid not available"),uid:r.uid}),r},this.Dispatch=function(){if(r.dispatchInstance[r.uid])return r;var t=r;return r.dispatchInstance[r.uid]||(r.dispatchInstance[r.uid]=new function(){var e=this;this.uid=t.uid,this.data=null,this.next=function(r){"cb"!==(r||{}).type&&(e.data=r),"cb"!==(r||{}).type?e.data?"function"==typeof t.cbQueue[t.uid]&&t.cbQueue[t.uid].call(t,e.data,t.uid):e.debug&&console.log("".concat(n," no callback data")):"function"==typeof r.cb&&(t.cbQueue[t.uid]||(t.cbQueue[t.uid]=r.cb),e.data&&r.cb.call(t,e.data,t.uid))}}),r},this.isActive=function(){return!!r.dispatchInstance[r.uid]},this.del=function(){return delete r.cbQueue[r.uid],delete r.dispatchInstance[r.uid],!r.cbQueue[r.uid]&&r.dispatchInstance[r.uid],r},this.subscribe=function(t){return"function"==typeof t?(r.dispatchInstance[r.uid]||r.Dispatch(),r.dispatchInstance[r.uid]&&r.dispatchInstance[r.uid].next({type:"cb",cb:t}),r):(r.debug&&console.log("".concat(n,"[batchReady] cb must be set")),r)}}(t,e)}},function(t,e,r){t.exports=r(6)},function(t,e,r){window.Pocket=function(){return r(4).PocketModule()}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=u(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function u(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function h(){var t,e,r=(t=["[dispatcher] probe id:"," created"],e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}})));return h=function(){return r},r}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),t}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");var r,n;t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&(r=t,n=e,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(r,n))}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=b(t);if(e){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return g(this,r)}}function g(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}e.PocketModule=function(){var t=r(0),e=t.objectSize,n=t.log,i=t.onerror,u=t.warn,l=t.isArray,d=t.isObject,g=t.isPromise,b=t.validID,_=t.isString,m=r(2),k=r(7)(),j=r(8).Probe,w=function(t){y(r,t);var e=v(r);function r(t,n){return f(this,r),e.call(this,t,n)}return p(r,[{key:"$removeProject",value:function(t){return t=_(t)?t:"",t=this.lastProjectID(t),this.deletePocketSet(t),this}},{key:"$payload",value:function(t,e,r){var n=this,o=function(t){return n.d=t,n},a=void 0!==e?e:this.async;return a&&g(t)?o(t.then((function(t){return n.payload(t,!1,r)}),(function(t){return t}))):a||g(t)?(this.debug&&i("[pocket]","[payload] with opts.async=true, data must be a promise, or do not set async when not a promise"),o(!!a&&Promise.reject())):o(this.payload(t,!1,r))}},{key:"$project",value:function(){return this.$payload.apply(this,arguments)}},{key:"$ready",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n=function(t){return e.d=t,e.d&&!r&&e.d.catch((function(t){e.disableWarnings||u("[pocket]",t)})),e},o=this.lastProjectID(t,!1,null);if(!t&&o&&(t=o),"complete"===this.projectsCache[t]&&!r)return n(Promise.reject("[$ready] project: ".concat(t," already complete")));if(void 0!==this._ready_method_set[t]&&!r){if(!0===this._ready_method_set[t])return n(Promise.reject("[$ready] project: ".concat(t," already complete, cannot recall same $ready")));if(!1===this._ready_method_set[t])return n(Promise.reject("[$ready] project: ".concat(t," you already declared $ready somewhere else, this call is ignored")))}if(!o)throw"payloadID must be set";var a=this.$projectSetAsync(o).then((function(t){var r=t.projectID;return e.ready(r).then((function(t){return e.deleteWithDelay?setTimeout((function(){e.deletePocketSet(r)}),e.deleteWithDelay):e.deletePocketSet(r),e.projectsCache[r]="complete",e._ready_method_set[o]=!0,t}),Promise.reject)}),Promise.reject);return this._ready_method_set[o]=!1,n(a)}catch(t){this.disableWarnings||i("[pocket]",t)}}}]),r}(function(t){y(g,t);var r=v(g);function g(t,e){var i;return f(this,g),(i=r.call(this,t,e)).dispatcher&&i.dispatcher.initListener().subscribe((function(t,e){var r=t||{},o=r.probe,a=r.status;"error"===a&&i.debug&&n("[pocket]","[dispatcher] probe id:".concat(o.id," error")),"open"===a&&i.debug&&n("[pocket]"(h(),o.id)),"complete"===a&&i.debug&&n("[pocket]","[dispatcher] probe id:".concat(o.id," completed"))})),i}return p(g,[{key:"payload",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"new";this.d=null;var n=null;if(!d(e))return!1;var o=Object.keys(e);if(o.every((function(t){return-1===["id","tasks"].indexOf(t)})))return this.debug&&i("[pocket]","[$payload] id and tasks are required"),!1;if(!l(e.tasks))return this.debug&&i("[pocket]","[$payload] data.tasks must be an array"),!1;if(e.id=this.validProjectID(e.id),!e.id)return this.debug&&i("[pocket]","[$payload] data.id invalid"),!1;if(this.payloadData[e.id]&&(!r||"new"===r))return this._lastProjectID=e.id,!0;var a=void 0===this.payloadData[e.id];(this._lastFilterList[e.id]||[]).length&&(this._lastFilterList[e.id]=[]);var s,h=c(e.tasks.values());try{var f=function(){var i=s.value;if(!i.task)return t.debug&&u("[pocket]","[$payload] task must be set for your tasks"),"continue";if(!t.idRegexValid(i.task)||-1!==i.task.indexOf("::"))return t.debug&&u("[pocket]","[$payload] invalid taskName, failed idRegexValid validation"),"continue";var o="".concat(e.id,"::").concat(i.task);return"update"===r&&!a&&t.pocket[o]?(i.data&&(t.pocket[o].data=i.data),i.status&&(t.pocket[o].status=i.status),!i.status&&i.data&&"open"===t.pocket[o].status&&(t.pocket[o].status="updated"),i.ref&&(t.pocket[o].ref=i.ref),i.error&&(t.pocket[o].error=i.error),i.campaign&&(t.pocket[o].campaign=i.campaign),n=!0,t._lastProjectID=e.id,"continue"):(t.payloadData[e.id]||(t.payloadData[e.id]={value:[],status:"open",timestamp:(new Date).getTime()}),t.payloadData[e.id].value.filter((function(t){return-1!==t.task.indexOf(i.task)})).length?(t.debug&&!t.disableWarnings&&u("[pocket]",'the same task "'.concat(i.task,'" already exists on the payload, you must choose uniq')),"continue"):(t.payloadData[e.id].value.push(i),void(t.lastPocketTimestamp=t.payloadData[e.id].timestamp)))};for(h.s();!(s=h.n()).done;)f()}catch(t){h.e(t)}finally{h.f()}return"update"===r&&this.payloadData[e.id]&&!a?(this.projectsCache[e.id]="open",n):!!this.payloadData[e.id]&&(this.lastProjectID(e.id),this.projectsCache[e.id]="open",this.distributor().setDefer(e.id),this.projectSetDispatcher(e.id).initListener().next({projectID:e.id}),!0)}},{key:"$projectSetAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;return t=this.lastProjectID(t,!1,null),this._projectSetAsync[t]||(this._projectSetAsync[t]=m(),this.projectSetDispatcher(t).initListener().subscribe((function(t,r){e._projectSetAsync[r].resolve(t),this.del()}))),this._projectSetAsync[t].promise()}},{key:"probeStatusAsync",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=function(e){return t.d=e,t};return r((e=this.lastProbeID(e))?this.pocket[e].getStatusAsync:null)}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this._setUpdate(t,e,r,"update")}},{key:"_set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._setUpdate(t,null,e,"set")}},{key:"_get",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e){return t.d=e,r?t:t.d};return this.d=null,n((e=this.lastProbeID(e))?this.pocket[e]:null)}},{key:"$activeTasks",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=function(e){return t.d=e,t};if(r=this.lastProjectID(r),!e(this.pocket))return n([]);var i=Object.entries(this.pocket).reduce((function(e,n){var i=s(n,2),o=i[0],a=i[1];return 0===o.indexOf(r||"")&&r&&t.payloadData[r]?e.push(a.task):r||e.push(a.task),e}),[]);return n(i)}},{key:"ready",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.d=null,!this._ready[t])throw"ready[payloadID] is not set, maybe you called it before $payload()";return this._ready[t].promise()}},{key:"_setUpdate",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update",c=function(t){return e.d=t,e},l=this.lastProbeID(n);if(!l)return this.debug&&i("[pocket]","[$update] must specify id"),c(!1);if(!d(t))return this.debug&&u("[pocket]","[$update] dataFrom must be an Object"),c(!1);if(!this.pocket[l])return this.debug&&i("[pocket]","[$update] this.pocket with id:".concat(l," not found")),c(!1);var h=!1;this._lastProjectID=l,t=Object.entries(t).reduce((function(t,r){var n=s(r,2),i=n[0],o=n[1],c=e.probeProps.indexOf(i);return e.probeProps[c]===i&&t.push({inx:c,data:a({},i,o)}),t}),[]);for(var f=0;f<t.length;f++)if(void 0!==(t[f]||{}).data){var p=s(Object.entries(t[f].data)[0],2),y=p[0],v=p[1];void 0===this.pocket[l][y]?this.debug&&u("[pocket]","[$update] not a valid prop/value: { ".concat(y,":").concat(this.pocket[l][y]," }")):("data"===y&&(this.pocket[l][y]=!0===r?Object.assign({},this.pocket[l][y],v):v),"status"!==y&&"ref"!==y&&"error"!==y&&"campaign"!==y||(this.pocket[l][y]=v),h=!0)}return h&&"set"===o&&(this.clearStoreTransfers(l),this.$transfer_lastID===l&&(this.$transfer_lastID=""),this._$cached_data[l]&&delete this._$cached_data[l]),c(h)}},{key:"setDefer",value:function(t){var r=this;if(!(t=b(t)))throw"id must be set";if(this._ready[t]||(this._ready[t]=m()),!e(this.pocket)){var n="[setDefer] probe is empty, so nothing set, id:".concat(t);return this.debug&&i("[pocket]",n),this._ready[t].reject(n),null}var o=Object.values(this.pocket).filter((function(e){return-1!==e.id.indexOf(t)}));if(!o.length){var a="[setDefer] no pocketSet found for id:".concat(t," ");return this.debug&&i("[pocket]",a),this._ready[t].reject(a),null}try{return Promise.all(o.map((function(t){return t.sq.promise()}))).then((function(e){var n=e.map((function(t){return function(t){var e={};if(!d(t))return null;for(var n=0;n<r.probeProps.length;n++){var i=r.probeProps[n];void 0!==t[i]&&null!==t[i]&&(e[i]=t[i])}return e}(t.probe)})).filter((function(t){return!!t}));r._ready[t].resolve(n)}),(function(t){i("[pocket]","[setDefer] Promise.all",t)})),!0}catch(t){i("[pocket]","[setDefer]",t)}return!1}},{key:"distributor",value:function(){for(var t=0,e=Object.entries(this.payloadData);t<e.length;t++){var r=s(e[t],2),n=r[0],a=r[1];if(!(this.lastPocketTimestamp>a.timestamp)&&"complete"!==a.status&&"send"!==a.status&&"error"!==a.status){var u,l=c(a.value.values());try{for(l.s();!(u=l.n()).done;){var h=o({id:n},u.value);this.setProbe(h)||i("[pocket]","probe for id:".concat(n," already exists"))}}catch(t){l.e(t)}finally{l.f()}}}return this}},{key:"setProbe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.id||!t.task)throw"id and task both must be set";if(!b(t.id))throw"opts.id not valid";var e="".concat(t.id,"::").concat(t.task);if(this.pocket[e])return this.debug&&n("[pocket]","[setProbe] probe: ".concat(e," already set")),null;try{t.id=e;var r=null!==this.dispatcher?this._emit.bind(this):null,o=new this.Probe(t,{disableWarnings:this.disableWarnings,onChange:this._onChange,emitter:r,completeOnNull:this.completeOnNull},this.debug);this.pocket[e]=o}catch(t){return i("[pocket]",t),null}return this.pocket[e]}},{key:"_emit",value:function(t){if(!t)return null;if(!this.dispatcher)return null;try{return this.dispatcher.initListener().next(t),!0}catch(t){return i("[pocket]","[_emit] dispatcher did not emit"),null}}},{key:"deletePocketSet",value:function(t){if(t){if(Object.values(this.pocket).length)for(var e=0,r=Object.values(this.pocket);e<r.length;e++){var n=r[e];this._$cached_data[n.id]&&delete this._$cached_data[n.id],n.id.includes(t)&&delete this.pocket[n.id]}this.payloadData[t]&&delete this.payloadData[t],this._ready[t]&&delete this._ready[t],void 0!==this._projectSetDispatcher[t]&&delete this._projectSetDispatcher[t],this._projectSetAsync[t]&&delete this._projectSetAsync[t],this._lastFilterList[t]&&delete this._lastFilterList[t];try{this.architectConfig[t]&&delete this.architectConfig[t]}catch(t){}this.clearStoreTransfers(t)}}},{key:"Probe",get:function(){return j()}}]),g}(k)),O=r(9)(w);return r(10)(O)}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=function(){return new function(){const t={};let e=null;const r=new Promise((e,r)=>{t.resolve=e,t.reject=r});this.resolve=(r=null)=>(e||(t.resolve(r),e=!0),this),this.reject=(r=null)=>(e||(t.reject(r),e=!0),this),this.promise=()=>r}}},function(t,e,r){function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(){var t=r(0),e=t.objectSize,i=t.warn,s=t.onerror,c=t.validID,u=t.copy,l=t.log,h=t.isString;return function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;o(this,t),this.debug=n||!1,this.async=(e||{}).async||null,this._onChange=(e||{}).onChange||null,this.completeOnNull=(e||{}).completeOnNull||null,this.disableWarnings=(e||{}).disableWarnings,this.dispatcher=(e||{}).dispatcher?r(1)():null,this.pocket={},this.payloadData={},this.lastPocketTimestamp=0,this._lastProjectID=null,this._lastProbeID=null,this._$cached_data={},this.$transfer_lastID="",this._ready={},this._ready_method_set={},this.d=void 0,this._projectSet={},this._transferCached=[],this._projectSetDispatcher={},this._projectSetAsync={},this._lastFilterList={},this.projectsCache={},this.deleteWithDelay=(e||{}).deleteWithDelay||1e3}var f,d;return f=t,(d=[{key:"projectSetDispatcher",value:function(t){return t?(this._projectSetDispatcher[t]||this._projectSetDispatcher[t]||(this._projectSetDispatcher[t]=r(1)(t)),this._projectSetDispatcher[t]):(this.debug&&s("[projectSetDispatcher] projectID must be set"),null)}},{key:"projectProbeList",value:function(t){return t?Object.entries(this.pocket).filter((function(e){return 0===n(e,1)[0].indexOf(t)})).map((function(t){var e=n(t,2);return e[0],e[1]})):[]}},{key:"clearStoreTransfers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var r=!1;return this._transferCached.length&&this._transferCached.forEach((function(n,i){var o=(n||{}).fromProbeID;o&&-1!==o.indexOf(e)&&(t._transferCached.splice(i,1),r=!0,t.debug&&l("[pocket]","[clearStoreTransfers] transferCached for probeID: ".concat(o," has been removed")))})),r}}},{key:"storeTransfers",value:function(t,e){return this._transferCached.push({timestamp:(new Date).getTime(),fromProbeID:t,data:e}),this._transferCached}},{key:"accessLastValidTransfer",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!this._transferCached.length)return{};this._transferCached.sort((function(t,e){return t.timestamp-e.timestamp}));var n=u(this._transferCached),i=n.reduce((function(e,n,i){var o=n.timestamp,a=(new Date).getTime()+r;return a>o&&a-o-r<=r&&(e=n,t._transferCached.splice(i,1)),e}),{});return e(i)?i:{}}},{key:"selectByTask",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e=h(e)?e:"",!this.idRegexValid(e)&&e)return null;if(e.indexOf(":")>0&&!this.pocket[e])return this.debug&&i("[pocket]","[selectByTask] when using '::' prefix selector, it should come at 0 index"),null;if(e.split(":").length>3||2===e.split(":").length)return this.debug&&i("[pocket]","[selectByTask] wrong taskName :".concat(e,", allowed prefix is '::taskName'")),null;if(r&&this.lastProbeID(e,!0),this.pocket[e])return r&&this.lastProbeID(e),e;var n=function(e){var r=e.split("::")[1]||e;return(t._lastProbeID||"").indexOf(r)>0&&r?t._lastProbeID:t._lastProjectID&&r?t._lastProjectID+"::"+r:t._lastProbeID},o=n(e);return o?r&&this.lastProbeID(o):this.debug&&i("[pocket]","[selectByTask] newProbeID was not found from taskOrProbeID: ".concat(e)),o}},{key:"lastProjectID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"strict";return!t&&this._lastProjectID&&(t=this._lastProjectID),t&&(t=this.validProjectID(t,e)),t&&this.payloadData[t]&&(this._lastProjectID=t),(this.payloadData[t]||"strict"!==r)&&t?(t&&!this._lastProjectID&&(this._lastProjectID=t),t):null}},{key:"lastProbeID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t&&this._lastProbeID&&(t=this._lastProbeID),t&&(t=this.validProbe(t,e)),t&&this.pocket[t]&&(this._lastProbeID=t),t&&this.pocket[t]?t:null}},{key:"validProjectID",value:function(t){return(t=c(t))?(t||"").split(" ").length>1?null:this.idRegexValid(t)?t:null:null}},{key:"validProbe",value:function(t){return(t=c(t))?this.idRegexValid(t)?-1===t.indexOf("::")?null:t:void 0:null}},{key:"dataPropSelector",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data()",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{return t=Object.entries(a).reduce((function(t,e,r){var i=n(e,2),o=i[0];return i[1],void 0!==c[o]&&(t[o]=c[o]),t}),{}),e(t)||(t=void 0),e(t)+e(a)===2&&(t=Object.values(t).shift()),"data()"===r&&(this._$cached_data[o]=t),s?this:t}catch(e){return this.debug&&i("[pocket]","[$data] no dataProp found on probeID: ".concat(o)),"data()"===r&&(this._$cached_data[o]=t),s?this:t}}},{key:"idRegexValid",value:function(t){return!new RegExp(/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi,"gi").test(t)||null}},{key:"probeProps",get:function(){return["campaign","data","task","ref","error","id","status"]}}])&&a(f.prototype,d),t}()}},function(t,e,r){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}e.Probe=function(){var t=r(0),e=t.isString,o=t.isArray,a=t.warn,s=t.log,c=t.isNumber,u=t.onerror,l=t.last,h=t.copy,f=t.isObject,d=t.isFunction,p=r(2);return function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(n(this,t),this.debug=o||!1,(c(r.id)||r.id)&&(r.id=r.id.toString()),!r.task||!e(r.task))throw"task as string is required";this._id=null,this._error=[],this._ref=null,this._task=null,this._status=null,this._data=null,this._campaign=null,this._dataIndex=0,this._statusIndex=0,this._statusAsync=[],this.task=r.task,this.id=r.id,this.status="open",this._onChange=i.onChange||null,this._onchangeDispatch=null,this.emitter=i.emitter||null,this.completeOnNull=i.completeOnNull||null,this.disableWarnings=(i||{}).disableWarnings,r.ref!==this._ref&&(this.ref=r.ref),r.data!==this._data&&(this.data=r.data),r.campaign&&(this.campaign=r.campaign),this._completeAsync=p()}var y,v;return y=t,(v=[{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"complete"===this.status||"send"===this.status?(this.debug&&!this.disableWarnings&&a("[Probe][update] cannot update data on complete status"),this):!f(t)&&e?(this.debug&&a("[pocket]","[Probe][update] cannot update none object 'data' with option 'merge=true' set"),this):(f(t)&&e?this.data=Object.assign({},this.data,t):void 0!==t&&(this.data=t),this)}},{key:"all",value:function(){return{error:this.error,ref:this.ref,campaign:this.campaign,data:this.data,id:this.id,task:this.task,status:this.status}}},{key:"onChange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";if(!this._onChange)return this.debug&&a("[pocket]","[onChange] to use need to set opts.onChange=true"),this;if(!d(t))return this.debug&&a("[onChange] cb must be a function"),this;var r=["all","data","status","ref","error","campaign"];if(!r.includes(e))return this.debug&&a("[pocket]","[onChange] no watch available for ".concat(e)),this;var n=this;return this.onchangeDispatch?(this.onchangeDispatch.initListener().subscribe((function(r,i){r.changed&&"all"===e?t.bind(n)(h(n.all()),i):r.changed===e&&void 0!==n[e]&&t.bind(n)(h(n[e]),i)})),this):(this.debug&&a("[pocket]","[onChange] onchangeDispatch no longer active"),this)}},{key:"dispatchChange",value:function(t){return this._onChange&&this.onchangeDispatch?(this.onchangeDispatch.initListener().next({changed:t}),!0):null}},{key:"onComplete",value:function(t){var e=this;"complete"!==t&&"error"!==t||"send"===this._status||!(this._dataIndex>0||!0===this.completeOnNull)||(this.emitter&&setTimeout((function(){e.emitter({probe:e,status:t})})),this._status="send",this.sq.resolve({probe:this.all()}),setTimeout((function(){e.onchangeDispatch&&e.onchangeDispatch.del()})))}},{key:"onOpenStatus",value:function(t){var e=this;"open"===t&&this.emitter&&setTimeout((function(){e.emitter({probe:e,status:"open"})}))}},{key:"sq",get:function(){return this._sq||(this._sq=p()),this._sq}},{key:"id",set:function(t){if(this._id)this.debug&&a("[pocket]","cannot update already set id: ".concat(this._id));else{if(!t)throw"id is required";if(t.split(" ").length>1)throw"each id cannot have spaces";if(-1===t.indexOf("::"))throw"each id must be of format id::taskName";if(-1!==t.indexOf(":::"))throw"each id must be of format id::taskName";var e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your id is invalid, allowed chars: ".concat(e);if(-1===(t=t.replace(/ /gi,"_").toLowerCase()).indexOf(this._task))throw"wrong id setup, your id should make up the taks name, example: id='cocacola::drink'";this._id=t}},get:function(){return this._id}},{key:"error",set:function(t){t&&(!(t||[]).length&&o(t)||(this._error.push(t),this._error=this._error.filter((function(t){return!!t})),this.dispatchChange("error")))},get:function(){return this._error.length?this._error:null}},{key:"ref",get:function(){return this._ref},set:function(t){t&&(e(t)?"complete"!==this.status&&"send"!==this._campaign.status&&(this._ref=t,this.dispatchChange("ref")):a("[pocket]","[ref] must be a string"))}},{key:"campaign",get:function(){return this._campaign},set:function(t){void 0!==t&&(this._campaign?this.debug&&!this.disableWarnings&&a("[pocket]","cannot update already set campaign ".concat(this._campaign)):t&&(e(t)?(this._campaign=t,this.dispatchChange("campaign")):this.debug&&a("[pocket]","campaign must be a string",t)))}},{key:"task",set:function(t){if(void 0!==t)if(this._task)this.debug&&!this.disableWarnings&&a("[pocket]","cannot update already set task");else if(t)if(e(t)){if(-1!==t.indexOf("::"))throw"task seperator :: is restricted";if(t.split(" ").length>1)throw"task cannot have spaces, use seperators: _+";var r=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(r,"gi").test(t))throw"your task is invalid, allowed chars: ".concat(r);this._task=t.replace(/ /gi,"_").toLowerCase()}else this.debug&&a("[pocket]","task must be a string")},get:function(){return this._task}},{key:"data",set:function(t){if(void 0!==t){if("complete"===this.status||"send"===this.status)return this.debug&&!this.disableWarnings&&a("[pocket]","you cannot update data once the status is complete or send"),null;this._dataIndex++,"open"===this.status&&null!==this._data&&this._dataIndex>1&&(this.status="updated"),this._data=t,this.dispatchChange("data")}},get:function(){return this._data}},{key:"statusStackOrder",get:function(){return{open:{value:1,set:!1},updated:{value:2,set:!1},complete:{value:3,set:!1},send:{value:4,set:!1},error:{value:5,set:!1}}}},{key:"status",get:function(){return this._status},set:function(t){var e=this;!function(r){try{if(e.statusStackOrder[r].value>2&&!0===e.statusStackOrder[r].set)return!1}catch(t){u("statusStackOrder invalid status")}switch(r){case"open":if("updated"===e._status){e.debug&&a("[pocket]","cannot set status back to open once set to updated");break}e._status=r,e.statusStackOrder[r].set=!0,e.onOpenStatus(t),e.setStatusAsync=r,e.dispatchChange("status");break;case"updated":if("complete"===e._status){e.debug&&a("[pocket]","cannot update status to 'updated' then previously set to 'complete'");break}e._dataIndex>0&&(e._status=r,e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e.dispatchChange("status"),e.debug&&s("id:".concat(e.id,", data updated")));break;case"complete":if(null===e.data&&!0!==e.completeOnNull){e.debug&&a("[pocket]","[status] cannot complete status because data is null, to complete you set data prop to false");break}e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e._status=r,e.dispatchChange("status"),e.onComplete(t);break;case"send":if("complete"!==e._status){e.debug&&a("[pocket]","cannot update status to 'send' then previously not set to 'complete'");break}e._status=r,e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e._completeAsync.resolve({status:e._status,id:e.id}),e.dispatchChange("status");break;case"error":if("complete"===e._status)return;e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e.dispatchChange("status"),e.onComplete(t);break;default:e.debug&&a("[pocket]","id:".concat(e.id,",  you set invalid status: ").concat(r,", nothing changed"))}}(t)}},{key:"setStatusAsync",set:function(t){var e={timestamp:(new Date).getTime(),p:p()};this._statusAsync.push(e)},get:function(){var t=l(this._statusAsync.sort((function(t,e){return t.timestamp-e.timestamp})).map((function(t){return t.p})));return t.resolve(h(this.status)),t}},{key:"getStatusAsync",get:function(){return this.setStatusAsync.promise()}},{key:"completeAsync",get:function(){return this._completeAsync.promise()}},{key:"statusAsync",get:function(){return this.getStatusAsync}},{key:"onchangeDispatch",get:function(){return this._onChange?(this._onchangeDispatch||(this._onchangeDispatch=r(1)(this.id)),this._onchangeDispatch):(this.debug&&a("[pocket]","[onchangeDispatch] to use need to set opts.onChange=true"),null)}}])&&i(y.prototype,v),t}()}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=r(0),n=e.objectSize,u=e.isFunction,l=e.onerror,h=e.warn,f=e.log,d=e.isString;function p(){var t=this;this._architectVal=null,this.architect=Object.create(p.prototype,{value:{enumerable:!0,configurable:!0,get:function(){return t._architectVal},set:function(e){n(e)&&(t._architectVal=e,f("[pocket]","[architect] updated"))}}})}return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(g,t);var e,r,f,y,v=(f=g,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(f);if(y){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return s(this,t)});function g(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g),(r=v.call(this,t,e)).architectConfig={};var n=new p;return r.architectMod=n.architect,r}return e=g,(r=[{key:"setArchitect",value:function(t,e){return void 0===this.architectConfig[t]&&(this.architectConfig[t]=this.architectMod),this.architectConfig[t].value=Object.assign({},this.architectConfig[t].value,e),this}},{key:"getArchitect",value:function(t){return(this.architectConfig[t]||{}).value}},{key:"asset",value:function(t,e,r){if(!u(e))return this.debug&&h("[pocket]","[$asset] asCallback must be a function"),null;if("project"!==t&&"cache"!==t){var n=this.lastProjectID(r);return r=this.validProjectID(n||r),this.getArchitect(r)?void 0!==this.getArchitect(r)[t]?e.call(this,this.getArchitect(r)[t]):(this.debug&&h("[pocket]","[$asset] assetName for architect doesnt exist"),null):(this.debug&&h("[pocket]","[$asset] architectConfig for assetName doesnt exist"),null)}this.debug&&h("[pocket]","[$asset] 'project, cache' are  restricted")}},{key:"architect",value:function(t,e){if(!u(t))return this.debug&&l("[pocket]","[$architect] callback must be set"),this;var r=t.call(this);if(!n(r))return this.debug&&l("[pocket]","[architect] must return a valid object settings {project, asset}, at least 1 is required"),this;var o=(r.project||{}).id,a=this.lastProjectID(e);if(!(e=this.validProjectID(a||e||o)))return this.debug&&l("[pocket]","[$architect] if this is a new project, you must specify projectID"),this;var s,c,f,p=Object.entries(r).reduce((function(t,e){var r,n,o=(n=2,function(t){if(Array.isArray(t))return t}(r=e)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}(r,n)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],s=o[1];return-1!==["project","asset","cache"].indexOf(a)&&(t[a]=s),t}),{});for(var y in(this.getArchitect(e)||{}).cache?p.cache=this.getArchitect(e).cache:(p.cache||(p.cache={project:!1,asset:!1}),this.setArchitect(e,{cache:p.cache})),p){var v=p[y],g=!0===p.cache[y]&&("project"===y||"asset"===y);if("project"===y){try{if(g&&this.getArchitect(e)[y])continue}catch(t){}this.setArchitect(e,{project:this.$payload(v,v.async,v.type).d})}if("asset"===y){if(!d(v.name)||void 0===v.value)return this.debug&&h("[pocket]","[$architect] asset must include {value, name}"),this;if("project"===v.name||"cache"===v.name)return this.debug&&h("[pocket]",'[$architect] asset props, "project, cache" are reserved'),this;try{if(g&&this.getArchitect(e)[v.name])continue}catch(t){}this.setArchitect(e,(s={},c=v.name,f=v.value,c in s?Object.defineProperty(s,c,{value:f,enumerable:!0,configurable:!0,writable:!0}):s[c]=f,s))}}return this}}])&&o(e.prototype,r),g}(t)}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=r(0),n=e.copy,o=e.warn,l=e.isArray,h=e.onerror,f=e.objectSize,d=e.isString,p=e.uniq,y=e.isFunction;return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(_,t);var e,r,v,g,b=(v=_,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=u(v);if(g){var r=u(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)});function _(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,_),b.call(this,t,e)}return e=_,(r=[{key:"$architect",value:function(){return this.architect.apply(this,arguments)}},{key:"$asset",value:function(){return this.asset.apply(this,arguments)}},{key:"$exists",value:function(t){return!!this.selectByTask(t)}},{key:"$projectComplete",value:function(t){return this.projectsCache[t]?"complete"===this.projectsCache[t]:null}},{key:"$projectSet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.validProjectID(t),!!this.payloadData[t]}},{key:"$condition",value:function(t,e){if(!y(t))return this.debug&&o("[pocket]","[$condition] must provide callback"),this;var r="PocketSelf",n=null;if(0===(e=d(e)?e:"").indexOf("::")){if(e=this.selectByTask(e,!0),r="ProbeSelf",!(e=this.lastProbeID(e)))return this.debug&&o("[pocket]","[$condition] probeID not found"),this}else{if(!this.lastProjectID(e))return this.debug&&o("[pocket]","[$condition] projectID not found"),this;r="PocketSelf"}return"PocketSelf"===r&&(n=this),"ProbeSelf"===r&&(n=this.$get(e)),n?t.call(n,n)||this:(this.debug&&o("[pocket]","[$condition] no valid self value"),this)}},{key:"$probeStatusAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);return this.probeStatusAsync(e)}},{key:"$get",value:function(t,e){t=this.selectByTask(t,!0);var r=this.lastProbeID(t);return this._get(r,e)}},{key:"$getByRef",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object.assign(this.pocket).filter((function(e,r){var n=i(e,2);return n[0],n[1].ref===t}))}},{key:"$set",value:function(t,e){e=this.selectByTask(e,!0);var r=this.lastProbeID(e);return this._set(t,r)}},{key:"$probe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);if(this.pocket[e]){if("Probe"===this.pocket[e].constructor.name)return this.pocket[e];this.debug&&h("[pocket]","[$probe] probeID: ".concat(t," is not an instance of Probe{}"))}else this.debug&&o("[pocket]","[$probe] not found for probeID: ".concat(t))}},{key:"$update",value:function(t,e,r){r=this.selectByTask(r,!0);var n=this.lastProbeID(r);return this.update(t,e,n)}},{key:"$select",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=d(t)?t:"",this.lastProjectID(t),this}},{key:"$filter",value:function(t,e){var r=this;e=this.lastProjectID(e);var n=function(t){return r.d=(t||[]).filter((function(t){return void 0===t.isNONE})),r};if(!y(t))return n([]);if(!this.payloadData[e])return this.debug&&o("[pocket]","[$filter] no projectID found"),n(null);var i=[];return(this._lastFilterList[e]||[]).length?i=this._lastFilterList[e]:(this._lastFilterList[e]=[],i=this.projectProbeList(e)),i.forEach((function(n,i){if(!n.isNONE){var o=t.call(n,n);if(!o)return r._lastFilterList[e]=r._lastFilterList[e].filter((function(t){return t.id!==n.id})),void r._lastFilterList[e].push({id:n.id,isNONE:!0});void 0===o||!0!==o&&1!==o?r._lastFilterList[e].push({id:n.id,isNONE:!0}):r._lastFilterList[e].filter((function(t,e){return(t||{}).id===n.id})).length||r._lastFilterList[e].push(n)}})),n(this._lastFilterList[e])}},{key:"$compute",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r=this.lastProjectID(r);var n=function(t){return t&&delete e._lastFilterList[r],e.d=t,e};if(!y(t))return this.debug&&o("[pocket]","[$compute] cb must be a function"),n(null);if(!this.payloadData[r])return this.debug&&o("[pocket]","[$compute] no project found fo your/last id projectID:".concat(r)),n(null);var i=this._lastFilterList[r]||[];return i.length?(this._lastFilterList[r]=i=i.filter((function(t){return void 0===t.isNONE})).filter((function(t,e,r){var n=t.id;return 1===r.filter((function(t){return n===t.id})).length})),i.forEach((function(e){"complete"!==e.status&&"send"!==e.status&&t.call(e,e)})),n(this._lastFilterList[r])):(this.projectProbeList(r).forEach((function(e){"complete"!==e.status&&"send"!==e.status&&t.call(e,e)})),n(this.projectProbeList(r)))}},{key:"$list",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"self";if(e=this.lastProjectID(e),!this.payloadData[e])return[];var o=function(){return Object.entries(t.pocket).reduce((function(t,r,n){var o=i(r,2),a=(o[0],o[1]);return a.id.includes(e)&&t.push(a),t}),[])};return y(r)?(this.projectProbeList(e).forEach((function(t){r(t.all())})),"self"!==n&&n?"list"===n?o():void 0:this):o()}},{key:"$transfer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.selectByTask(t,!0),t=this.lastProbeID(t),this.pocket[t]?(this.storeTransfers(t,n(this.pocket[t].data)),this.$transfer_lastID=t,this):(this.debug&&o("[pocket]","[$transfer] no Probe{} found for this id fromProbeID:".concat(t)),this)}},{key:"$to",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(t=this.selectByTask(t,e),e&&(t=this.validProbe(t)),!t)return this.debug&&o("[pocket]","[$to] toProbeID is invalid"),this;if(!this.pocket[t])return this.debug&&o("[pocket]","[$to] no Probe{} found for this id toProbeID:".concat(t)),this;if(this.$transfer_lastID){var n=this.accessLastValidTransfer(r);if(f(n)){var i=n.fromProbeID,a=n.data;if(this.$transfer_lastID===i){if("complete"===this.pocket[t].status||"send"===this.pocket[t].status)return this.debug&&o("[pocket]","[$to] cannot transfer since toProbeID: ".concat(t," is already complete")),this.$transfer_lastID="",this;this.pocket[i].data=null,this.pocket[t].data=a}}else this.debug&&o("[pocket]","[$to] no last valid transfer found");this.$transfer_lastID=""}return this}},{key:"$of",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.selectByTask(t,!0),this}},{key:"$data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=this.selectByTask(e,!0),this.pocket[e]?(l(t)&&(t||[]).length&&(t=p(t).reduce((function(t,e){return void 0!==e&&(t[e.trim()]=!0),t}),{})),t&&f(t)?this.dataPropSelector("data()",e,t,r,n(this.pocket[e].data)):(this._$cached_data[e]=n(this.pocket[e].data),r?this:this._$cached_data[e])):r?this:void 0}},{key:"$cached",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e=this.selectByTask(e,!0),this.pocket[e]){var r=void 0!==this._$cached_data[e]&&null!==this._$cached_data[e];if(r)return d(t)&&(t||"").length&&(t=p(t.trim().replace(/ /gi,"").split(",")).reduce((function(t,e){return void 0!==e&&(t[e]=!0),t}),{})),!f(this._$cached_data[e])&&r?f(t)?void 0:this._$cached_data[e]:t&&f(t)?this.dataPropSelector("cached()",e,t,!1,this._$cached_data[e]):void 0===this._$cached_data[e]?void 0:this._$cached_data[e]}}},{key:"$campaign",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].campaign):null}},{key:"$ref",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].ref):null}},{key:"$status",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].status):null}},{key:"$task",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].task):null}},{key:"$error",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].error):null}},{key:"$all",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].all()):null}},{key:"$onChange",value:function(t,e,r){return this._onChange?(r=this.selectByTask(r,!0),this.pocket[r]?(this.pocket[r].onChange(t,e),this):null):(this.debug&&o("[pocket]","[$onChange] opts.onChange=true must be enabled to use this feature"),this)}},{key:"$projectID",get:function(){return this._lastProjectID}}])&&a(e.prototype,r),_}(t)}}]));
//# sourceMappingURL=pocket_browser.fd578dcd.js.map