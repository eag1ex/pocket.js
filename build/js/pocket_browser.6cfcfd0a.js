!function(t,e){for(var r in e)t[r]=e[r]}(window,function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}e.objectSize=function(t){return t&&Object.prototype===t.__proto__?Object.entries(t).length:0},e.last=function(t){return t&&Array.prototype===t.__proto__?t[t.length-1]:null},e.copyBy=function(t,e){return e.reduce((function(e,r,n){return void 0!==t[r]&&(e[r]=t[r]),e}),{})},e.validID=function(t){return t?(t||"").toString().toLowerCase():null},e.isNumber=function(t){return void 0!==t&&t.__proto__===Number.prototype},e.isPromise=function(t){return Promise.prototype===(t||{}).__proto__},e.uniq=function(t){return t.filter((function(t,e,r){return r.indexOf(t)===e}))},e.isObject=function(t){return!!t&&(Object.prototype===t.__proto__||t instanceof Object)},e.isArray=function(t){return!!t&&Array.prototype===t.__proto__},e.isString=function(t){return!!t&&String.prototype===t.__proto__},e.isFunction=function(t){return"function"==typeof t},e.copy=function(t){if(!t)return t;try{return JSON.parse(JSON.stringify(t))}catch(t){return t.toString()}},e.errorMessages=function(t){for(var e={},r=0,i=Object.entries(t);r<i.length;r++){var a=(c=i[r],u=2,function(t){if(Array.isArray(t))return t}(c)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(c,u)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(c,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],s=a[1];e[o]={message:s[0],code:o}}var c,u;return e},e.log=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e=[].concat("[Pocket]",e),console.log.apply(null,e)},e.warn=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e=[].concat("[warning]",e),console.warn.apply(null,e)},e.onerror=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e=[].concat("[error]",e),console.log("  "),console.error.apply(null,e),console.log("  ")}},function(t,e){t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new function(t,e){var r=this,n="[dispatcher]";this.uid=(t||"").toString()||(new Date).getTime(),this.debug=e,this.cbQueue={},this.dispatchInstance={},this.initListener=function(){return r.Dispatch(),r},this.next=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r.dispatchInstance[r.uid]?r.dispatchInstance[r.uid].next(t):r.debug&&console.log({message:"".concat(n," for uid not available"),uid:r.uid}),r},this.Dispatch=function(){if(r.dispatchInstance[r.uid])return r;var t=r;return r.dispatchInstance[r.uid]||(r.dispatchInstance[r.uid]=new function(){var e=this;this.uid=t.uid,this.data=null,this.next=function(r){"cb"!==(r||{}).type&&(e.data=r),"cb"!==(r||{}).type?e.data?"function"==typeof t.cbQueue[t.uid]&&t.cbQueue[t.uid].call(t,e.data,t.uid):e.debug&&console.log("".concat(n," no callback data")):"function"==typeof r.cb&&(t.cbQueue[t.uid]||(t.cbQueue[t.uid]=r.cb),e.data&&r.cb.call(t,e.data,t.uid))}}),r},this.isActive=function(){return!!r.dispatchInstance[r.uid]},this.del=function(){return delete r.cbQueue[r.uid],delete r.dispatchInstance[r.uid],!r.cbQueue[r.uid]&&r.dispatchInstance[r.uid],r},this.subscribe=function(t){return"function"==typeof t?(r.dispatchInstance[r.uid]||r.Dispatch(),r.dispatchInstance[r.uid]&&r.dispatchInstance[r.uid].next({type:"cb",cb:t}),r):(r.debug&&console.log("".concat(n,"[batchReady] cb must be set")),r)}}(t,e)}},function(t,e,r){t.exports=r(5)},function(t,e,r){window.Pocket=function(){return r(4).PocketModule()}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=u(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function u(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),t}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");var r,n;t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&(r=t,n=e,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(r,n))}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=b(t);if(e){var i=b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v(this,r)}}function v(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}e.PocketModule=function(){var t=r(0),e=t.objectSize,n=t.log,i=t.onerror,u=t.warn,l=t.isArray,d=t.isObject,v=t.isPromise,b=t.validID,g=t.isString,m=r(2),_=r(6)(),k=r(7).Probe,j=function(t){p(r,t);var e=y(r);function r(t,n){return h(this,r),e.call(this,t,n)}return f(r,[{key:"$removeProject",value:function(t){return t=g(t)?t:"",t=this.lastProjectID(t),this.deletePocketSet(t),this}},{key:"$payload",value:function(t,e,r){var n=this,a=function(t){return n.d=t,n},o=void 0!==e?e:this.async;return o&&v(t)?a(t.then((function(t){return n.payload(t,!1,r)}),(function(t){return t}))):o||v(t)?(this.debug&&i("[payload] with opts.async=true, data must be a promise, or do not set async when not a promise"),a(!!o&&Promise.reject())):a(this.payload(t,!1,r))}},{key:"$project",value:function(){return this.$payload.apply(this,arguments)}},{key:"$ready",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n=function(t){return e.d=t,e.d&&!r&&e.d.catch(u),e},a=this.lastProjectID(t,!1,null);if(!t&&a&&(t=a),"complete"===this.projectsCache[t]&&!r)return n(Promise.reject("[$ready] project: ".concat(t," already complete")));if(void 0!==this._ready_method_set[t]&&!r){if(!0===this._ready_method_set[t])return n(Promise.reject("[$ready] project: ".concat(t," already complete, cannot recall same $ready")));if(!1===this._ready_method_set[t])return n(Promise.reject("[$ready] project: ".concat(t," you already declared $ready somewhere else, this call is ignored")))}if(!a)throw"payloadID must be set";var o=this.$projectSetAsync(a).then((function(t){var r=t.projectID;return e.ready(r).then((function(t){return e.deleteWithDelay?setTimeout((function(){e.deletePocketSet(r)}),e.deleteWithDelay):e.deletePocketSet(r),e.projectsCache[r]="complete",e._ready_method_set[a]=!0,t}),Promise.reject)}),Promise.reject);return this._ready_method_set[a]=!1,n(o)}catch(t){this.disableWarnings||i(t)}}}]),r}(function(t){p(v,t);var r=y(v);function v(t,e){var i;return h(this,v),(i=r.call(this,t,e)).dispatcher&&i.dispatcher.initListener().subscribe((function(t,e){var r=t||{},a=r.probe,o=r.status;"error"===o&&i.debug&&n("[dispatcher] probe id:".concat(a.id," error")),"open"===o&&i.debug&&n("[dispatcher] probe id:".concat(a.id," created")),"complete"===o&&i.debug&&n("[dispatcher] probe id:".concat(a.id," completed"))})),i}return f(v,[{key:"payload",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"new";this.d=null;var n=null;if(!d(e))return!1;var a=Object.keys(e);if(a.every((function(t){return-1===["id","tasks"].indexOf(t)})))return this.debug&&i("[$payload] id and tasks are required"),!1;if(!l(e.tasks))return this.debug&&i("[$payload] data.tasks must be an array"),!1;if(e.id=this.validProjectID(e.id),!e.id)return this.debug&&i("[$payload] data.id invalid"),!1;if(this.payloadData[e.id]&&(!r||"new"===r))return this._lastProjectID=e.id,!0;var o=void 0===this.payloadData[e.id];(this._lastFilterList[e.id]||[]).length&&(this._lastFilterList[e.id]=[]);var s,h=c(e.tasks.values());try{var f=function(){var i=s.value;if(!i.task)return t.debug&&u("[$payload] task must be set for your tasks"),"continue";if(!t.idRegexValid(i.task)||-1!==i.task.indexOf("::"))return t.debug&&u("[$payload] invalid taskName, failed idRegexValid validation"),"continue";var a="".concat(e.id,"::").concat(i.task);return"update"===r&&!o&&t.pocket[a]?(i.data&&(t.pocket[a].data=i.data),i.status&&(t.pocket[a].status=i.status),!i.status&&i.data&&"open"===t.pocket[a].status&&(t.pocket[a].status="updated"),i.ref&&(t.pocket[a].ref=i.ref),i.error&&(t.pocket[a].error=i.error),i.campaign&&(t.pocket[a].campaign=i.campaign),n=!0,t._lastProjectID=e.id,"continue"):(t.payloadData[e.id]||(t.payloadData[e.id]={value:[],status:"open",timestamp:(new Date).getTime()}),t.payloadData[e.id].value.filter((function(t){return-1!==t.task.indexOf(i.task)})).length?(t.debug&&!t.disableWarnings&&u('the same task "'.concat(i.task,'" already exists on the payload, you must choose uniq')),"continue"):(t.payloadData[e.id].value.push(i),void(t.lastPocketTimestamp=t.payloadData[e.id].timestamp)))};for(h.s();!(s=h.n()).done;)f()}catch(t){h.e(t)}finally{h.f()}return"update"===r&&this.payloadData[e.id]&&!o?(this.projectsCache[e.id]="open",n):!!this.payloadData[e.id]&&(this.lastProjectID(e.id),this.projectsCache[e.id]="open",this.distributor().setDefer(e.id),this.projectSetDispatcher(e.id).initListener().next({projectID:e.id}),!0)}},{key:"$projectSetAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;return t=this.lastProjectID(t,!1,null),this._projectSetAsync[t]||(this._projectSetAsync[t]=m(),this.projectSetDispatcher(t).initListener().subscribe((function(t,r){e._projectSetAsync[r].resolve(t),this.del()}))),this._projectSetAsync[t].promise()}},{key:"probeStatusAsync",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=function(e){return t.d=e,t};return r((e=this.lastProbeID(e))?this.pocket[e].getStatusAsync:null)}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this._setUpdate(t,e,r,"update")}},{key:"_set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._setUpdate(t,null,e,"set")}},{key:"_get",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e){return t.d=e,r?t:t.d};return this.d=null,n((e=this.lastProbeID(e))?this.pocket[e]:null)}},{key:"$activeTasks",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=function(e){return t.d=e,t};if(r=this.lastProjectID(r),!e(this.pocket))return n([]);var i=Object.entries(this.pocket).reduce((function(e,n){var i=s(n,2),a=i[0],o=i[1];return 0===a.indexOf(r||"")&&r&&t.payloadData[r]?e.push(o.task):r||e.push(o.task),e}),[]);return n(i)}},{key:"ready",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.d=null,!this._ready[t])throw"ready[payloadID] is not set, maybe you called it before $payload()";return this._ready[t].promise()}},{key:"_setUpdate",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update",c=function(t){return e.d=t,e},l=this.lastProbeID(n);if(!l)return this.debug&&i("[$update] must specify id"),c(!1);if(!d(t))return this.debug&&u("[$update] dataFrom must be an Object"),c(!1);if(!this.pocket[l])return this.debug&&i("[$update] this.pocket with id:".concat(l," not found")),c(!1);var h=!1;this._lastProjectID=l,t=Object.entries(t).reduce((function(t,r){var n=s(r,2),i=n[0],a=n[1],c=e.probeProps.indexOf(i);return e.probeProps[c]===i&&t.push({inx:c,data:o({},i,a)}),t}),[]);for(var f=0;f<t.length;f++)if(void 0!==(t[f]||{}).data){var p=s(Object.entries(t[f].data)[0],2),y=p[0],v=p[1];void 0===this.pocket[l][y]?this.debug&&u("[$update] not a valid prop/value: { ".concat(y,":").concat(this.pocket[l][y]," }")):("data"===y&&(this.pocket[l][y]=!0===r?Object.assign({},this.pocket[l][y],v):v),"status"!==y&&"ref"!==y&&"error"!==y&&"campaign"!==y||(this.pocket[l][y]=v),h=!0)}return h&&"set"===a&&(this.clearStoreTransfers(l),this.$transfer_lastID===l&&(this.$transfer_lastID=""),this._$cached_data[l]&&delete this._$cached_data[l]),c(h)}},{key:"setDefer",value:function(t){var r=this;if(!(t=b(t)))throw"id must be set";if(this._ready[t]||(this._ready[t]=m()),!e(this.pocket)){var n="[setDefer] probe is empty, so nothing set, id:".concat(t);return this.debug&&i(n),this._ready[t].reject(n),null}var a=Object.values(this.pocket).filter((function(e){return-1!==e.id.indexOf(t)}));if(!a.length){var o="[setDefer] no pocketSet found for id:".concat(t," ");return this.debug&&i(o),this._ready[t].reject(o),null}try{return Promise.all(a.map((function(t){return t.sq.promise()}))).then((function(e){var n=e.map((function(t){return function(t){var e={};if(!d(t))return null;for(var n=0;n<r.probeProps.length;n++){var i=r.probeProps[n];void 0!==t[i]&&null!==t[i]&&(e[i]=t[i])}return e}(t.probe)})).filter((function(t){return!!t}));r._ready[t].resolve(n)}),(function(t){i("[setDefer] Promise.all",t)})),!0}catch(t){i("[setDefer]",t)}return!1}},{key:"distributor",value:function(){for(var t=0,e=Object.entries(this.payloadData);t<e.length;t++){var r=s(e[t],2),n=r[0],o=r[1];if(!(this.lastPocketTimestamp>o.timestamp)&&"complete"!==o.status&&"send"!==o.status&&"error"!==o.status){var u,l=c(o.value.values());try{for(l.s();!(u=l.n()).done;){var h=a({id:n},u.value);this.setProbe(h)||i("probe for id:".concat(n," already exists"))}}catch(t){l.e(t)}finally{l.f()}}}return this}},{key:"setProbe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.id||!t.task)throw"id and task both must be set";if(!b(t.id))throw"opts.id not valid";var e="".concat(t.id,"::").concat(t.task);if(this.pocket[e])return this.debug&&n("[setProbe] probe: ".concat(e," already set")),null;try{t.id=e;var r=null!==this.dispatcher?this._emit.bind(this):null,a=new this.Probe(t,{disableWarnings:this.disableWarnings,onChange:this._onChange,emitter:r,completeOnNull:this.completeOnNull},this.debug);this.pocket[e]=a}catch(t){return i(t),null}return this.pocket[e]}},{key:"_emit",value:function(t){if(!t)return null;if(!this.dispatcher)return null;try{return this.dispatcher.initListener().next(t),!0}catch(t){return i("[_emit] dispatcher did not emit"),null}}},{key:"deletePocketSet",value:function(t){if(t){if(Object.values(this.pocket).length)for(var e=0,r=Object.values(this.pocket);e<r.length;e++){var n=r[e];this._$cached_data[n.id]&&delete this._$cached_data[n.id],n.id.includes(t)&&delete this.pocket[n.id]}this.payloadData[t]&&delete this.payloadData[t],this._ready[t]&&delete this._ready[t],void 0!==this._projectSetDispatcher[t]&&delete this._projectSetDispatcher[t],this._projectSetAsync[t]&&delete this._projectSetAsync[t],this._lastFilterList[t]&&delete this._lastFilterList[t];try{this.architectConfig[t]&&delete this.architectConfig[t]}catch(t){}this.clearStoreTransfers(t)}}},{key:"Probe",get:function(){return k()}}]),v}(_)),D=r(8)(j);return r(9)(D)}},function(t,e){t.exports=function(){return new function(){const t={};let e=null;const r=new Promise((e,r)=>{t.resolve=e,t.reject=r});this.resolve=(r=null)=>(e||(t.resolve(r),e=!0),this),this.reject=(r=null)=>(e||(t.reject(r),e=!0),this),this.promise=()=>r}}},function(t,e,r){function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(){var t=r(0),e=t.objectSize,i=t.warn,s=t.onerror,c=t.validID,u=t.copy,l=t.log,h=t.isString;return function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;a(this,t),this.debug=n||!1,this.async=(e||{}).async||null,this._onChange=(e||{}).onChange||null,this.completeOnNull=(e||{}).completeOnNull||null,this.disableWarnings=(e||{}).disableWarnings,this.dispatcher=(e||{}).dispatcher?r(1)():null,this.pocket={},this.payloadData={},this.lastPocketTimestamp=0,this._lastProjectID=null,this._lastProbeID=null,this._$cached_data={},this.$transfer_lastID="",this._ready={},this._ready_method_set={},this.d=void 0,this._projectSet={},this._transferCached=[],this._projectSetDispatcher={},this._projectSetAsync={},this._lastFilterList={},this.projectsCache={},this.deleteWithDelay=(e||{}).deleteWithDelay||1e3}var d,f;return d=t,(f=[{key:"projectSetDispatcher",value:function(t){return t?(this._projectSetDispatcher[t]||this._projectSetDispatcher[t]||(this._projectSetDispatcher[t]=r(1)(t)),this._projectSetDispatcher[t]):(this.debug&&s("[projectSetDispatcher] projectID must be set"),null)}},{key:"projectProbeList",value:function(t){return t?Object.entries(this.pocket).filter((function(e){return 0===n(e,1)[0].indexOf(t)})).map((function(t){var e=n(t,2);return e[0],e[1]})):[]}},{key:"clearStoreTransfers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var r=!1;return this._transferCached.length&&this._transferCached.forEach((function(n,i){var a=(n||{}).fromProbeID;a&&-1!==a.indexOf(e)&&(t._transferCached.splice(i,1),r=!0,t.debug&&l("[clearStoreTransfers] transferCached for probeID: ".concat(a," has been removed")))})),r}}},{key:"storeTransfers",value:function(t,e){return this._transferCached.push({timestamp:(new Date).getTime(),fromProbeID:t,data:e}),this._transferCached}},{key:"accessLastValidTransfer",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!this._transferCached.length)return{};this._transferCached.sort((function(t,e){return t.timestamp-e.timestamp}));var n=u(this._transferCached),i=n.reduce((function(e,n,i){var a=n.timestamp,o=(new Date).getTime()+r;return o>a&&o-a-r<=r&&(e=n,t._transferCached.splice(i,1)),e}),{});return e(i)?i:{}}},{key:"selectByTask",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e=h(e)?e:"",!this.idRegexValid(e)&&e)return null;if(e.indexOf(":")>0&&!this.pocket[e])return this.debug&&i("[selectByTask] when using '::' prefix selector, it should come at 0 index"),null;if(e.split(":").length>3||2===e.split(":").length)return this.debug&&i("[selectByTask] wrong taskName :".concat(e,", allowed prefix is '::taskName'")),null;if(r&&this.lastProbeID(e,!0),this.pocket[e])return r&&this.lastProbeID(e),e;var n=function(e){var r=e.split("::")[1]||e;return(t._lastProbeID||"").indexOf(r)>0&&r?t._lastProbeID:t._lastProjectID&&r?t._lastProjectID+"::"+r:t._lastProbeID},a=n(e);return a?r&&this.lastProbeID(a):this.debug&&i("[selectByTask] newProbeID was not found from taskOrProbeID: ".concat(e)),a}},{key:"lastProjectID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"strict";return!t&&this._lastProjectID&&(t=this._lastProjectID),t&&(t=this.validProjectID(t,e)),t&&this.payloadData[t]&&(this._lastProjectID=t),(this.payloadData[t]||"strict"!==r)&&t?(t&&!this._lastProjectID&&(this._lastProjectID=t),t):null}},{key:"lastProbeID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t&&this._lastProbeID&&(t=this._lastProbeID),t&&(t=this.validProbe(t,e)),t&&this.pocket[t]&&(this._lastProbeID=t),t&&this.pocket[t]?t:null}},{key:"validProjectID",value:function(t){return(t=c(t))?(t||"").split(" ").length>1?null:this.idRegexValid(t)?t:null:null}},{key:"validProbe",value:function(t){return(t=c(t))?this.idRegexValid(t)?-1===t.indexOf("::")?null:t:void 0:null}},{key:"dataPropSelector",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data()",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{return t=Object.entries(o).reduce((function(t,e,r){var i=n(e,2),a=i[0];return i[1],void 0!==c[a]&&(t[a]=c[a]),t}),{}),e(t)||(t=void 0),e(t)+e(o)===2&&(t=Object.values(t).shift()),"data()"===r&&(this._$cached_data[a]=t),s?this:t}catch(e){return this.debug&&i("[$data] no dataProp found on probeID: ".concat(a)),"data()"===r&&(this._$cached_data[a]=t),s?this:t}}},{key:"idRegexValid",value:function(t){return!new RegExp(/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi,"gi").test(t)||null}},{key:"probeProps",get:function(){return["campaign","data","task","ref","error","id","status"]}}])&&o(d.prototype,f),t}()}},function(t,e,r){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}e.Probe=function(){var t=r(0),e=t.isString,a=t.isArray,o=t.warn,s=t.log,c=t.isNumber,u=t.onerror,l=t.last,h=t.copy,d=t.isObject,f=t.isFunction,p=r(2);return function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(n(this,t),this.debug=a||!1,(c(r.id)||r.id)&&(r.id=r.id.toString()),!r.task||!e(r.task))throw"task as string is required";this._id=null,this._error=[],this._ref=null,this._task=null,this._status=null,this._data=null,this._campaign=null,this._dataIndex=0,this._statusIndex=0,this._statusAsync=[],this.task=r.task,this.id=r.id,this.status="open",this._onChange=i.onChange||null,this._onchangeDispatch=null,this.emitter=i.emitter||null,this.completeOnNull=i.completeOnNull||null,this.disableWarnings=(i||{}).disableWarnings,r.ref!==this._ref&&(this.ref=r.ref),r.data!==this._data&&(this.data=r.data),r.campaign&&(this.campaign=r.campaign),this._completeAsync=p()}var y,v;return y=t,(v=[{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"complete"===this.status||"send"===this.status?(this.debug&&!this.disableWarnings&&o("[Probe][update] cannot update data on complete status"),this):!d(t)&&e?(this.debug&&o("[Probe][update] cannot update none object 'data' with option 'merge=true' set"),this):(d(t)&&e?this.data=Object.assign({},this.data,t):void 0!==t&&(this.data=t),this)}},{key:"all",value:function(){return{error:this.error,ref:this.ref,campaign:this.campaign,data:this.data,id:this.id,task:this.task,status:this.status}}},{key:"onChange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";if(!this._onChange)return this.debug&&o("[onChange] to use need to set opts.onChange=true"),this;if(!f(t))return this.debug&&o("[onChange] cb must be a function"),this;var r=["all","data","status","ref","error","campaign"];if(!r.includes(e))return this.debug&&o("[onChange] no watch available for ".concat(e)),this;var n=this;return this.onchangeDispatch?(this.onchangeDispatch.initListener().subscribe((function(r,i){r.changed&&"all"===e?t.bind(n)(h(n.all()),i):r.changed===e&&void 0!==n[e]&&t.bind(n)(h(n[e]),i)})),this):(this.debug&&o("[onChange] onchangeDispatch no longer active"),this)}},{key:"dispatchChange",value:function(t){return this._onChange&&this.onchangeDispatch?(this.onchangeDispatch.initListener().next({changed:t}),!0):null}},{key:"onComplete",value:function(t){var e=this;"complete"!==t&&"error"!==t||"send"===this._status||!(this._dataIndex>0||!0===this.completeOnNull)||(this.emitter&&setTimeout((function(){e.emitter({probe:e,status:t})})),this._status="send",this.sq.resolve({probe:this.all()}),setTimeout((function(){e.onchangeDispatch&&e.onchangeDispatch.del()})))}},{key:"onOpenStatus",value:function(t){var e=this;"open"===t&&this.emitter&&setTimeout((function(){e.emitter({probe:e,status:"open"})}))}},{key:"sq",get:function(){return this._sq||(this._sq=p()),this._sq}},{key:"id",set:function(t){if(this._id)this.debug&&o("cannot update already set id: ".concat(this._id));else{if(!t)throw"id is required";if(t.split(" ").length>1)throw"each id cannot have spaces";if(-1===t.indexOf("::"))throw"each id must be of format id::taskName";if(-1!==t.indexOf(":::"))throw"each id must be of format id::taskName";var e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your id is invalid, allowed chars: ".concat(e);if(-1===(t=t.replace(/ /gi,"_").toLowerCase()).indexOf(this._task))throw"wrong id setup, your id should make up the taks name, example: id='cocacola::drink'";this._id=t}},get:function(){return this._id}},{key:"error",set:function(t){t&&(!(t||[]).length&&a(t)||(this._error.push(t),this._error=this._error.filter((function(t){return!!t})),this.dispatchChange("error")))},get:function(){return this._error.length?this._error:null}},{key:"ref",get:function(){return this._ref},set:function(t){t&&(e(t)?"complete"!==this.status&&"send"!==this._campaign.status&&(this._ref=t,this.dispatchChange("ref")):o("[ref] must be a string"))}},{key:"campaign",get:function(){return this._campaign},set:function(t){void 0!==t&&(this._campaign?this.debug&&!this.disableWarnings&&o("cannot update already set campaign ".concat(this._campaign)):t&&(e(t)?(this._campaign=t,this.dispatchChange("campaign")):this.debug&&o("campaign must be a string",t)))}},{key:"task",set:function(t){if(void 0!==t)if(this._task)this.debug&&!this.disableWarnings&&o("cannot update already set task");else if(t)if(e(t)){if(-1!==t.indexOf("::"))throw"task seperator :: is restricted";if(t.split(" ").length>1)throw"task cannot have spaces, use seperators: _+";var r=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(r,"gi").test(t))throw"your task is invalid, allowed chars: ".concat(r);this._task=t.replace(/ /gi,"_").toLowerCase()}else this.debug&&o("task must be a string")},get:function(){return this._task}},{key:"data",set:function(t){if(void 0!==t){if("complete"===this.status||"send"===this.status)return this.debug&&!this.disableWarnings&&o("you cannot update data once the status is complete or send"),null;this._dataIndex++,"open"===this.status&&null!==this._data&&this._dataIndex>1&&(this.status="updated"),this._data=t,this.dispatchChange("data")}},get:function(){return this._data}},{key:"statusStackOrder",get:function(){return{open:{value:1,set:!1},updated:{value:2,set:!1},complete:{value:3,set:!1},send:{value:4,set:!1},error:{value:5,set:!1}}}},{key:"status",get:function(){return this._status},set:function(t){var e=this;!function(r){try{if(e.statusStackOrder[r].value>2&&!0===e.statusStackOrder[r].set)return!1}catch(t){u("statusStackOrder invalid status")}switch(r){case"open":if("updated"===e._status){e.debug&&o("cannot set status back to open once set to updated");break}e._status=r,e.statusStackOrder[r].set=!0,e.onOpenStatus(t),e.setStatusAsync=r,e.dispatchChange("status");break;case"updated":if("complete"===e._status){e.debug&&o("cannot update status to 'updated' then previously set to 'complete'");break}e._dataIndex>0&&(e._status=r,e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e.dispatchChange("status"),e.debug&&s("id:".concat(e.id,", data updated")));break;case"complete":if(null===e.data&&!0!==e.completeOnNull){e.debug&&o("[status] cannot complete status because data is null, to complete you set data prop to false");break}e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e._status=r,e.dispatchChange("status"),e.onComplete(t);break;case"send":if("complete"!==e._status){e.debug&&o("cannot update status to 'send' then previously not set to 'complete'");break}e._status=r,e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e._completeAsync.resolve({status:e._status,id:e.id}),e.dispatchChange("status");break;case"error":if("complete"===e._status)return;e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e.dispatchChange("status"),e.onComplete(t);break;default:e.debug&&o("id:".concat(e.id,",  you set invalid status: ").concat(r,", nothing changed"))}}(t)}},{key:"setStatusAsync",set:function(t){var e={timestamp:(new Date).getTime(),p:p()};this._statusAsync.push(e)},get:function(){var t=l(this._statusAsync.sort((function(t,e){return t.timestamp-e.timestamp})).map((function(t){return t.p})));return t.resolve(h(this.status)),t}},{key:"getStatusAsync",get:function(){return this.setStatusAsync.promise()}},{key:"completeAsync",get:function(){return this._completeAsync.promise()}},{key:"statusAsync",get:function(){return this.getStatusAsync}},{key:"onchangeDispatch",get:function(){return this._onChange?(this._onchangeDispatch||(this._onchangeDispatch=r(1)(this.id)),this._onchangeDispatch):(this.debug&&o("[onchangeDispatch] to use need to set opts.onChange=true"),null)}}])&&i(y.prototype,v),t}()}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=r(0),n=e.objectSize,u=e.isFunction,l=e.onerror,h=e.warn,d=e.log,f=e.isString;function p(){var t=this;this._architectVal=null,this.architect=Object.create(p.prototype,{value:{enumerable:!0,configurable:!0,get:function(){return t._architectVal},set:function(e){n(e)&&(t._architectVal=e,d("[architect] updated"))}}})}return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(b,t);var e,r,d,y,v=(d=b,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(d);if(y){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return s(this,t)});function b(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,b),(r=v.call(this,t,e)).architectConfig={};var n=new p;return r.architectMod=n.architect,r}return e=b,(r=[{key:"setArchitect",value:function(t,e){return void 0===this.architectConfig[t]&&(this.architectConfig[t]=this.architectMod),this.architectConfig[t].value=Object.assign({},this.architectConfig[t].value,e),this}},{key:"getArchitect",value:function(t){return(this.architectConfig[t]||{}).value}},{key:"asset",value:function(t,e,r){if(!u(e))return this.debug&&h("[$asset] asCallback must be a function"),null;if("project"!==t&&"cache"!==t){var n=this.lastProjectID(r);return r=this.validProjectID(n||r),this.getArchitect(r)?void 0!==this.getArchitect(r)[t]?e.call(this,this.getArchitect(r)[t]):(this.debug&&h("[$asset] assetName for architect doesnt exist"),null):(this.debug&&h("[$asset] architectConfig for assetName doesnt exist"),null)}this.debug&&h("[$asset] 'project, cache' are  restricted")}},{key:"architect",value:function(t,e){if(!u(t))return this.debug&&l("[$architect] callback must be set"),this;var r=t.call(this);if(!n(r))return this.debug&&l("[architect] must return a valid object settings {project, asset}, at least 1 is required"),this;var a=(r.project||{}).id,o=this.lastProjectID(e);if(!(e=this.validProjectID(o||e||a)))return this.debug&&l("[$architect] if this is a new project, you must specify projectID"),this;var s,c,d,p=Object.entries(r).reduce((function(t,e){var r,n,a=(n=2,function(t){if(Array.isArray(t))return t}(r=e)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(r,n)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],s=a[1];return-1!==["project","asset","cache"].indexOf(o)&&(t[o]=s),t}),{});for(var y in(this.getArchitect(e)||{}).cache?p.cache=this.getArchitect(e).cache:(p.cache||(p.cache={project:!1,asset:!1}),this.setArchitect(e,{cache:p.cache})),p){var v=p[y],b=!0===p.cache[y]&&("project"===y||"asset"===y);if("project"===y){try{if(b&&this.getArchitect(e)[y])continue}catch(t){}this.setArchitect(e,{project:this.$payload(v,v.async,v.type).d})}if("asset"===y){if(!f(v.name)||void 0===v.value)return this.debug&&h("[$architect] asset must include {value, name}"),this;if("project"===v.name||"cache"===v.name)return this.debug&&h('[$architect] asset props, "project, cache" are reserved'),this;try{if(b&&this.getArchitect(e)[v.name])continue}catch(t){}this.setArchitect(e,(s={},c=v.name,d=v.value,c in s?Object.defineProperty(s,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):s[c]=d,s))}}return this}}])&&a(e.prototype,r),b}(t)}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=r(0),n=e.copy,a=e.warn,l=e.isArray,h=e.onerror,d=e.objectSize,f=e.isString,p=e.uniq,y=e.isFunction;return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(m,t);var e,r,v,b,g=(v=m,b=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=u(v);if(b){var r=u(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)});function m(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,m),g.call(this,t,e)}return e=m,(r=[{key:"$architect",value:function(){return this.architect.apply(this,arguments)}},{key:"$asset",value:function(){return this.asset.apply(this,arguments)}},{key:"$exists",value:function(t){return!!this.selectByTask(t)}},{key:"$projectComplete",value:function(t){return this.projectsCache[t]?"complete"===this.projectsCache[t]:null}},{key:"$projectSet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.validProjectID(t),!!this.payloadData[t]}},{key:"$condition",value:function(t,e){if(!y(t))return this.debug&&a("[$condition] must provide callback"),this;var r="PocketSelf",n=null;if(0===(e=f(e)?e:"").indexOf("::")){if(e=this.selectByTask(e,!0),r="ProbeSelf",!(e=this.lastProbeID(e)))return this.debug&&a("[$condition] probeID not found"),this}else{if(!this.lastProjectID(e))return this.debug&&a("[$condition] projectID not found"),this;r="PocketSelf"}return"PocketSelf"===r&&(n=this),"ProbeSelf"===r&&(n=this.$get(e)),n?t.call(n,n)||this:(this.debug&&a("[$condition] no valid self value"),this)}},{key:"$probeStatusAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);return this.probeStatusAsync(e)}},{key:"$get",value:function(t,e){t=this.selectByTask(t,!0);var r=this.lastProbeID(t);return this._get(r,e)}},{key:"$getByRef",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object.assign(this.pocket).filter((function(e,r){var n=i(e,2);return n[0],n[1].ref===t}))}},{key:"$set",value:function(t,e){e=this.selectByTask(e,!0);var r=this.lastProbeID(e);return this._set(t,r)}},{key:"$probe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);if(this.pocket[e]){if("Probe"===this.pocket[e].constructor.name)return this.pocket[e];this.debug&&h("[$probe] probeID: ".concat(t," is not an instance of Probe{}"))}else this.debug&&a("[$probe] not found for probeID: ".concat(t))}},{key:"$update",value:function(t,e,r){r=this.selectByTask(r,!0);var n=this.lastProbeID(r);return this.update(t,e,n)}},{key:"$select",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=f(t)?t:"",this.lastProjectID(t),this}},{key:"$filter",value:function(t,e){var r=this;e=this.lastProjectID(e);var n=function(t){return r.d=(t||[]).filter((function(t){return void 0===t.isNONE})),r};if(!y(t))return n([]);if(!this.payloadData[e])return this.debug&&a("[$filter] no projectID found"),n(null);var i=[];return(this._lastFilterList[e]||[]).length?i=this._lastFilterList[e]:(this._lastFilterList[e]=[],i=this.projectProbeList(e)),i.forEach((function(n,i){if(!n.isNONE){var a=t.call(n,n);if(!a)return r._lastFilterList[e]=r._lastFilterList[e].filter((function(t){return t.id!==n.id})),void r._lastFilterList[e].push({id:n.id,isNONE:!0});void 0===a||!0!==a&&1!==a?r._lastFilterList[e].push({id:n.id,isNONE:!0}):r._lastFilterList[e].filter((function(t,e){return(t||{}).id===n.id})).length||r._lastFilterList[e].push(n)}})),n(this._lastFilterList[e])}},{key:"$compute",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r=this.lastProjectID(r);var n=function(t){return t&&delete e._lastFilterList[r],e.d=t,e};if(!y(t))return this.debug&&a("[$compute] cb must be a function"),n(null);if(!this.payloadData[r])return this.debug&&a("[$compute] no project found fo your/last id projectID:".concat(r)),n(null);var i=this._lastFilterList[r]||[];return i.length?(this._lastFilterList[r]=i=i.filter((function(t){return void 0===t.isNONE})).filter((function(t,e,r){var n=t.id;return 1===r.filter((function(t){return n===t.id})).length})),i.forEach((function(e){"complete"!==e.status&&"send"!==e.status&&t.call(e,e)})),n(this._lastFilterList[r])):(this.projectProbeList(r).forEach((function(e){"complete"!==e.status&&"send"!==e.status&&t.call(e,e)})),n(this.projectProbeList(r)))}},{key:"$list",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"self";if(e=this.lastProjectID(e),!this.payloadData[e])return[];var a=function(){return Object.entries(t.pocket).reduce((function(t,r,n){var a=i(r,2),o=(a[0],a[1]);return o.id.includes(e)&&t.push(o),t}),[])};return y(r)?(this.projectProbeList(e).forEach((function(t){r(t.all())})),"self"!==n&&n?"list"===n?a():void 0:this):a()}},{key:"$transfer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.selectByTask(t,!0),t=this.lastProbeID(t),this.pocket[t]?(this.storeTransfers(t,n(this.pocket[t].data)),this.$transfer_lastID=t,this):(this.debug&&a("[$transfer] no Probe{} found for this id fromProbeID:".concat(t)),this)}},{key:"$to",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(t=this.selectByTask(t,e),e&&(t=this.validProbe(t)),!t)return this.debug&&a("[$to] toProbeID is invalid"),this;if(!this.pocket[t])return this.debug&&a("[$to] no Probe{} found for this id toProbeID:".concat(t)),this;if(this.$transfer_lastID){var n=this.accessLastValidTransfer(r);if(d(n)){var i=n.fromProbeID,o=n.data;if(this.$transfer_lastID===i){if("complete"===this.pocket[t].status||"send"===this.pocket[t].status)return this.debug&&a("[$to] cannot transfer since toProbeID: ".concat(t," is already complete")),this.$transfer_lastID="",this;this.pocket[i].data=null,this.pocket[t].data=o}}else this.debug&&a("[$to] no last valid transfer found");this.$transfer_lastID=""}return this}},{key:"$of",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.selectByTask(t,!0),this}},{key:"$data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=this.selectByTask(e,!0),this.pocket[e]?(l(t)&&(t||[]).length&&(t=p(t).reduce((function(t,e){return void 0!==e&&(t[e.trim()]=!0),t}),{})),t&&d(t)?this.dataPropSelector("data()",e,t,r,n(this.pocket[e].data)):(this._$cached_data[e]=n(this.pocket[e].data),r?this:this._$cached_data[e])):r?this:void 0}},{key:"$cached",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e=this.selectByTask(e,!0),this.pocket[e]){var r=void 0!==this._$cached_data[e]&&null!==this._$cached_data[e];if(r)return f(t)&&(t||"").length&&(t=p(t.trim().replace(/ /gi,"").split(",")).reduce((function(t,e){return void 0!==e&&(t[e]=!0),t}),{})),!d(this._$cached_data[e])&&r?d(t)?void 0:this._$cached_data[e]:t&&d(t)?this.dataPropSelector("cached()",e,t,!1,this._$cached_data[e]):void 0===this._$cached_data[e]?void 0:this._$cached_data[e]}}},{key:"$campaign",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].campaign):null}},{key:"$ref",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].ref):null}},{key:"$status",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].status):null}},{key:"$task",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].task):null}},{key:"$error",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].error):null}},{key:"$all",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].all()):null}},{key:"$onChange",value:function(t,e,r){return this._onChange?(r=this.selectByTask(r,!0),this.pocket[r]?(this.pocket[r].onChange(t,e),this):null):(this.debug&&a("[$onChange] opts.onChange=true must be enabled to use this feature"),this)}},{key:"$projectID",get:function(){return this._lastProjectID}}])&&o(e.prototype,r),m}(t)}}]));
//# sourceMappingURL=pocket_browser.6cfcfd0a.js.map