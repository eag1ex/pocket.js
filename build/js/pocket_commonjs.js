module.exports=function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function n(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],i=!0,s=!1,n=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){s=!0,n=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return r}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=u(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,s=function(){};return{s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){a=!0,n=t},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw n}}}}function u(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function h(){var t,e,r=(t=["[dispatcher] probe id:"," created"],e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}})));return h=function(){return r},r}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),t}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");var r,i;t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&(r=t,i=e,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(r,i))}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=b(t);if(e){var s=b(this).constructor;r=Reflect.construct(i,arguments,s)}else r=i.apply(this,arguments);return _(this,r)}}function _(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}e.PocketModule=function(){var t=r(1),e=t.objectSize,i=t.log,s=t.onerror,u=t.warn,l=t.isArray,p=t.isObject,_=t.isPromise,b=t.validID,v=t.isString,m=r(3),k=r(5)(),j=r(7).Probe,D=function(t){g(r,t);var e=y(r);function r(t,i){return d(this,r),e.call(this,t,i)}return f(r,[{key:"$removeProject",value:function(t){return t=v(t)?t:"",t=this.lastProjectID(t),this.deletePocketSet(t),this}},{key:"$payload",value:function(t,e,r){var i=this,n=function(t){return i.d=t,i},o=void 0!==e?e:this.async;return o&&_(t)?n(t.then((function(t){return i.payload(t,!1,r)}),(function(t){return t}))):o||_(t)?(this.debug&&s("[pocket]","[payload] with opts.async=true, data must be a promise, or do not set async when not a promise"),n(!!o&&Promise.reject())):n(this.payload(t,!1,r))}},{key:"$project",value:function(){return this.$payload.apply(this,arguments)}},{key:"$ready",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var i=function(t){return e.d=t,e.d&&!r&&e.d.catch((function(t){e.disableWarnings||u("[pocket]",t)})),e},n=this.lastProjectID(t,!1,null);if(!t&&n&&(t=n),"complete"===this.projectsCache[t]&&!r)return i(Promise.reject("[$ready] project: ".concat(t," already complete")));if(void 0!==this._ready_method_set[t]&&!r){if(!0===this._ready_method_set[t])return i(Promise.reject("[$ready] project: ".concat(t," already complete, cannot recall same $ready")));if(!1===this._ready_method_set[t])return i(Promise.reject("[$ready] project: ".concat(t," you already declared $ready somewhere else, this call is ignored")))}if(!n)throw"payloadID must be set";var o=this.$projectSetAsync(n).then((function(t){var r=t.projectID;return e.ready(r).then((function(t){return e.deleteWithDelay?setTimeout((function(){e.deletePocketSet(r)}),e.deleteWithDelay):e.deletePocketSet(r),e.projectsCache[r]="complete",e._ready_method_set[n]=!0,t}),Promise.reject)}),Promise.reject);return this._ready_method_set[n]=!1,i(o)}catch(t){this.disableWarnings||s("[pocket]",t)}}}]),r}(function(t){g(_,t);var r=y(_);function _(t,e){var s;return d(this,_),(s=r.call(this,t,e)).dispatcher&&s.dispatcher.initListener().subscribe((function(t,e){var r=t||{},n=r.probe,o=r.status;"error"===o&&s.debug&&i("[pocket]","[dispatcher] probe id:".concat(n.id," error")),"open"===o&&s.debug&&i("[pocket]"(h(),n.id)),"complete"===o&&s.debug&&i("[pocket]","[dispatcher] probe id:".concat(n.id," completed"))})),s}return f(_,[{key:"payload",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"new";this.d=null;var i=null;if(!p(e))return!1;var n=Object.keys(e);if(n.every((function(t){return-1===["id","tasks"].indexOf(t)})))return this.debug&&s("[pocket]","[$payload] id and tasks are required"),!1;if(!l(e.tasks))return this.debug&&s("[pocket]","[$payload] data.tasks must be an array"),!1;if(e.id=this.validProjectID(e.id),!e.id)return this.debug&&s("[pocket]","[$payload] data.id invalid"),!1;if(this.payloadData[e.id]&&(!r||"new"===r))return this._lastProjectID=e.id,!0;var o=void 0===this.payloadData[e.id];(this._lastFilterList[e.id]||[]).length&&(this._lastFilterList[e.id]=[]);var a,h=c(e.tasks.values());try{var d=function(){var s=a.value;if(!s.task)return t.debug&&u("[pocket]","[$payload] task must be set for your tasks"),"continue";if(!t.idRegexValid(s.task)||-1!==s.task.indexOf("::"))return t.debug&&u("[pocket]","[$payload] invalid taskName, failed idRegexValid validation"),"continue";var n="".concat(e.id,"::").concat(s.task);return"update"===r&&!o&&t.pocket[n]?(s.data&&(t.pocket[n].data=s.data),s.status&&(t.pocket[n].status=s.status),!s.status&&s.data&&"open"===t.pocket[n].status&&(t.pocket[n].status="updated"),s.ref&&(t.pocket[n].ref=s.ref),s.error&&(t.pocket[n].error=s.error),s.campaign&&(t.pocket[n].campaign=s.campaign),i=!0,t._lastProjectID=e.id,"continue"):(t.payloadData[e.id]||(t.payloadData[e.id]={value:[],status:"open",timestamp:(new Date).getTime()}),t.payloadData[e.id].value.filter((function(t){return-1!==t.task.indexOf(s.task)})).length?(t.debug&&!t.disableWarnings&&u("[pocket]",'the same task "'.concat(s.task,'" already exists on the payload, you must choose uniq')),"continue"):(t.payloadData[e.id].value.push(s),void(t.lastPocketTimestamp=t.payloadData[e.id].timestamp)))};for(h.s();!(a=h.n()).done;)d()}catch(t){h.e(t)}finally{h.f()}return"update"===r&&this.payloadData[e.id]&&!o?(this.projectsCache[e.id]="open",i):!!this.payloadData[e.id]&&(this.lastProjectID(e.id),this.projectsCache[e.id]="open",this.distributor().setDefer(e.id),this.projectSetDispatcher(e.id).initListener().next({projectID:e.id}),!0)}},{key:"$projectSetAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;return t=this.lastProjectID(t,!1,null),this._projectSetAsync[t]||(this._projectSetAsync[t]=m(),this.projectSetDispatcher(t).initListener().subscribe((function(t,r){e._projectSetAsync[r].resolve(t),this.del()}))),this._projectSetAsync[t].promise()}},{key:"probeStatusAsync",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=function(e){return t.d=e,t};return r((e=this.lastProbeID(e))?this.pocket[e].getStatusAsync:null)}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this._setUpdate(t,e,r,"update")}},{key:"_set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._setUpdate(t,null,e,"set")}},{key:"_get",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=function(e){return t.d=e,r?t:t.d};return this.d=null,i((e=this.lastProbeID(e))?this.pocket[e]:null)}},{key:"$activeTasks",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=function(e){return t.d=e,t};if(r=this.lastProjectID(r),!e(this.pocket))return i([]);var s=Object.entries(this.pocket).reduce((function(e,i){var s=a(i,2),n=s[0],o=s[1];return 0===n.indexOf(r||"")&&r&&t.payloadData[r]?e.push(o.task):r||e.push(o.task),e}),[]);return i(s)}},{key:"ready",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.d=null,!this._ready[t])throw"ready[payloadID] is not set, maybe you called it before $payload()";return this._ready[t].promise()}},{key:"_setUpdate",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update",c=function(t){return e.d=t,e},l=this.lastProbeID(i);if(!l)return this.debug&&s("[pocket]","[$update] must specify id"),c(!1);if(!p(t))return this.debug&&u("[pocket]","[$update] dataFrom must be an Object"),c(!1);if(!this.pocket[l])return this.debug&&s("[pocket]","[$update] this.pocket with id:".concat(l," not found")),c(!1);var h=!1;this._lastProjectID=l,t=Object.entries(t).reduce((function(t,r){var i=a(r,2),s=i[0],n=i[1],c=e.probeProps.indexOf(s);return e.probeProps[c]===s&&t.push({inx:c,data:o({},s,n)}),t}),[]);for(var d=0;d<t.length;d++)if(void 0!==(t[d]||{}).data){var f=a(Object.entries(t[d].data)[0],2),g=f[0],y=f[1];void 0===this.pocket[l][g]?this.debug&&u("[pocket]","[$update] not a valid prop/value: { ".concat(g,":").concat(this.pocket[l][g]," }")):("data"===g&&(this.pocket[l][g]=!0===r?Object.assign({},this.pocket[l][g],y):y),"status"!==g&&"ref"!==g&&"error"!==g&&"campaign"!==g||(this.pocket[l][g]=y),h=!0)}return h&&"set"===n&&(this.clearStoreTransfers(l),this.$transfer_lastID===l&&(this.$transfer_lastID=""),this._$cached_data[l]&&delete this._$cached_data[l]),c(h)}},{key:"setDefer",value:function(t){var r=this;if(!(t=b(t)))throw"id must be set";if(this._ready[t]||(this._ready[t]=m()),!e(this.pocket)){var i="[setDefer] probe is empty, so nothing set, id:".concat(t);return this.debug&&s("[pocket]",i),this._ready[t].reject(i),null}var n=Object.values(this.pocket).filter((function(e){return-1!==e.id.indexOf(t)}));if(!n.length){var o="[setDefer] no pocketSet found for id:".concat(t," ");return this.debug&&s("[pocket]",o),this._ready[t].reject(o),null}try{return Promise.all(n.map((function(t){return t.sq.promise()}))).then((function(e){var i=e.map((function(t){return function(t){var e={};if(!p(t))return null;for(var i=0;i<r.probeProps.length;i++){var s=r.probeProps[i];void 0!==t[s]&&null!==t[s]&&(e[s]=t[s])}return e}(t.probe)})).filter((function(t){return!!t}));r._ready[t].resolve(i)}),(function(t){s("[pocket]","[setDefer] Promise.all",t)})),!0}catch(t){s("[pocket]","[setDefer]",t)}return!1}},{key:"distributor",value:function(){for(var t=0,e=Object.entries(this.payloadData);t<e.length;t++){var r=a(e[t],2),i=r[0],o=r[1];if(!(this.lastPocketTimestamp>o.timestamp)&&"complete"!==o.status&&"send"!==o.status&&"error"!==o.status){var u,l=c(o.value.values());try{for(l.s();!(u=l.n()).done;){var h=n({id:i},u.value);this.setProbe(h)||s("[pocket]","probe for id:".concat(i," already exists"))}}catch(t){l.e(t)}finally{l.f()}}}return this}},{key:"setProbe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.id||!t.task)throw"id and task both must be set";if(!b(t.id))throw"opts.id not valid";var e="".concat(t.id,"::").concat(t.task);if(this.pocket[e])return this.debug&&i("[pocket]","[setProbe] probe: ".concat(e," already set")),null;try{t.id=e;var r=null!==this.dispatcher?this._emit.bind(this):null,n=new this.Probe(t,{disableWarnings:this.disableWarnings,onChange:this._onChange,emitter:r,completeOnNull:this.completeOnNull},this.debug);this.pocket[e]=n}catch(t){return s("[pocket]",t),null}return this.pocket[e]}},{key:"_emit",value:function(t){if(!t)return null;if(!this.dispatcher)return null;try{return this.dispatcher.initListener().next(t),!0}catch(t){return s("[pocket]","[_emit] dispatcher did not emit"),null}}},{key:"deletePocketSet",value:function(t){if(t){if(Object.values(this.pocket).length)for(var e=0,r=Object.values(this.pocket);e<r.length;e++){var i=r[e];this._$cached_data[i.id]&&delete this._$cached_data[i.id],i.id.includes(t)&&delete this.pocket[i.id]}this.payloadData[t]&&delete this.payloadData[t],this._ready[t]&&delete this._ready[t],void 0!==this._projectSetDispatcher[t]&&delete this._projectSetDispatcher[t],this._projectSetAsync[t]&&delete this._projectSetAsync[t],this._lastFilterList[t]&&delete this._lastFilterList[t];try{this.architectConfig[t]&&delete this.architectConfig[t]}catch(t){}this.clearStoreTransfers(t)}}},{key:"Probe",get:function(){return j()}}]),_}(k)),P=r(8)(D);return r(9)(P)}},function(t,e,r){(function(r){var i,s,n,o;o=function(t){"use strict";var e=Number.prototype,i=String.prototype;function s(t,e,r,i,s,n,o){try{var a=t[n](o),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(i,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.disableLogging=()=>{try{if(window)return window.xUtilsConfig?window.xUtilsConfig.logging="off":window.xUtilsConfig={logging:"off"},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig.logging="off":r.xUtilsConfig={logging:"off"},!0}catch(t){}return!1},t.resetLogging=()=>{try{if(window)return window.xUtilsConfig?window.xUtilsConfig.logging="on":window.xUtilsConfig={logging:"on"},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig.logging="on":r.xUtilsConfig={logging:"on"},!0}catch(t){}return!1},t.loggerSetting=function(t,e){if(void 0===t&&(t="log"),void 0===e&&(e="off"),!["log","warn","onerror","error","alert","attention","debug"].includes(t)||!t)return!1;if(!["on","off"].includes(e)||!e)return!1;"onerror"===t&&(t="error");try{if(window)return window.xUtilsConfig?window.xUtilsConfig[t]=e:window.xUtilsConfig={[t]:e},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig[t]=e:r.xUtilsConfig={[t]:e},!0}catch(t){}return!1};var n=t=>{try{if(window)return window.xUtilsConfig&&window.xUtilsConfig[t]?window.xUtilsConfig[t]:"on"}catch(t){}try{return r.xUtilsConfig&&r.xUtilsConfig[t]?r.xUtilsConfig[t]:"on"}catch(t){}return"on"},o=()=>{try{if(window)return"on"===(window.xUtilsConfig||{}).logging||void 0===(window.xUtilsConfig||{}).logging}catch(t){}try{return"on"===(r.xUtilsConfig||{}).logging||void 0===(r.xUtilsConfig||{}).logging}catch(t){}return!0},a=function(t,e){void 0===t&&(t=""),e.length||(e[0]="");var r=0===e.filter(t=>"string"==typeof t||void 0===t).length?"%o":"";"log"===t&&(e=[].concat("[90m[log][0m[2m"+r+" ",e,"[0m")),"debug"===t&&(e=[].concat("[90m[debug][0m[32m"+r+" ",e,"[0m")),"warn"===t&&(e=[].concat("[90m[warning][0m[1m"+r+" ",e,"[0m")),"alert"===t&&(e=[].concat("[90m[alert][0m[33m"+r+" ",e,"[0m")),"attention"===t&&(e=[].concat("[90m[attention][0m[36m"+r+" ",e,"[0m"));try{return void(window&&console.log.apply(null,e))}catch(t){}console.log.apply(null,e)},c=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];if(o()&&"off"!==n("error")&&"off"!==n("onerror")){e.length||(e[0]="");var i=0===e.filter(t=>"string"==typeof t||void 0===t).length,s=i?"%o":"";try{if(window)return e=[].concat("[31m[error][0m[31m"+s+" ",e,"[0m"),void console.error.apply(null,e)}catch(t){}e=[].concat("[41m[error][0m[31m"+s+" ",e,"[0m"),console.log.apply(null,e)}},u=(t.stack=function(t,e){if(void 0===e&&(e=!1),o()){var r=new Error(JSON.stringify(t)).stack.split("(");r.splice(1,1);var i=r[0].split(/\n/)[0].replace("Error","[STACK TRACE]");return r.splice(0,1),r.unshift(i),void(e?console.log(r):console.log.apply(null,r))}},t.errorTrace=function(t,e){if(void 0===e&&(e=!1),o()){var r=new Error(JSON.stringify(t)).stack.split("(");r.splice(1,1);var i=r[0].split(/\n/)[0].replace("Error","[ERROR]");return r.splice(0,1),r.unshift(i),void(e?console.error(r):console.error.apply(null,r))}},t.loop=function(t,e){if(void 0===t&&(t=0),"function"!=typeof e||"number"!=typeof t)return[];if(!t)return[];for(var r,i=[],s=0;s<Array(t).length;s++){r=e.apply(this,[s]);try{if(r&&Object.entries(r).length&&r.break)break}catch(t){}i.push(r)}return i},t=>!!t&&Array.prototype===t.__proto__),l=function(t,r){void 0===r&&(r=!0);var s=e=>r?typeof t:e||typeof t,n=e=>e.prototype===t.prototype;try{return"symbol"==typeof t?{type:s(),value:0,primitiveValue:Symbol("")}:void 0===t?{type:s(),value:0,primitiveValue:void 0}:"boolean"==typeof t?{type:s(),value:+t,primitiveValue:Boolean()}:"bigint"==typeof t&&"object"==typeof Object(t)?{type:s(),value:1,primitiveValue:BigInt("")}:null===t?{type:s("null"),value:0,primitiveValue:{}}:t.__proto__===Date.prototype||n(Date)?{type:s("date"),value:1,primitiveValue:new Date}:i===t.__proto__?{type:s(),value:t.length,primitiveValue:String()}:Array.prototype===t.__proto__||n(Array)?{type:s("array"),value:(t||[]).length,primitiveValue:[]}:Promise.prototype===(t||"").__proto__||n(Promise)?{type:s("promise"),value:1,primitiveValue:Function()}:Function.prototype===t.__proto__||n(Function)?{type:s(),value:1,primitiveValue:Function()}:Object.prototype===t.__proto__||n(Object)?{type:s(),value:Object.keys(t).length,primitiveValue:{}}:Error.prototype===t.__proto__||n(Error)?{type:s("error"),value:Object.keys(t).length,primitiveValue:Error()}:t.__proto__===e||n(Number)?isNaN(t)?{type:s("NaN"),value:0,primitiveValue:Number()}:{type:s(),value:t,primitiveValue:Number()}:0==0<=+t?{type:typeof t,value:+t,primitiveValue:void 0}:{type:typeof t,value:0,primitiveValue:void 0}}catch(t){return c(t),{}}},h=t=>Error.prototype===(t||"").__proto__,d=function(t){return void 0===t&&(t=null),void 0===t||!1===t&&"boolean"==typeof t||null===t||(i===t.__proto__?1>t.length:Array.prototype===t.__proto__?0===(t||[]).length:Promise.prototype!==(t||{}).__proto__&&"function"!=typeof t&&(Object.prototype===t.__proto__?0===Object.keys(t).length:Error.prototype!==t.__proto__&&(void 0!==t&&t.__proto__===e?!!isNaN(t)||0>=t:0==0<+t||!t&&!1)))},p=(t.isEmpty=t=>!h(t)&&!l(t).value,t.head=function(t){return void 0===t&&(t=[]),Array.prototype===(t||null).__proto__?t.flat().shift():[]},t.last=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?t[t.length-1]:null},t.timer=function(t,e){if(void 0===e&&(e=0),"function"!=typeof t)return null;e="number"==typeof e&&0<=e?e:0;var r=setTimeout(()=>{t(),clearTimeout(r)},e)},t.interval=function(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=0),"function"!=typeof t)return null;e="number"==typeof e&&0<=e?e:0,r="number"==typeof r&&0<=r?r:0;var i=0,s=setInterval(()=>{r<=i?clearInterval(s):t(),i+=e},e)},t.validID=function(t){return void 0===t&&(t=""),t?(t||"").toString().toLowerCase().replace(/\s/g,""):""},t.isNumber=t=>!(null==t||""===t)&&t.__proto__===e,t.objectSize=function(t){return void 0===t&&(t={}),t&&isNaN(+t)&&(Object.prototype===t.__proto__||Error.prototype===t.__proto__)?Object.keys(t).length:0},t.stringSize=function(t){return void 0===t&&(t=""),null!=t&&t.__proto__===i?t.length:0},t=>Promise.prototype===(t||{}).__proto__),f=t=>!("function"==typeof t||!isNaN(+t)||void 0===t||t.__proto__===[].__proto__||!((Object.prototype===t.__proto__||Error.prototype===t.__proto__)&&t instanceof Object||void 0!==t.__proto__&&void 0!==t.__proto__.__proto__&&t.__proto__.__proto__===Object.prototype&&t instanceof Object||t.prototype)),g=function(t){return void 0===t&&(t=[]),t.filter((t,e,r)=>r.indexOf(t)===e)},y=(t.selectiveArray=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=[{}]),!u(e))return[];if(!e.length)return[];if(!u(t))return e;if(!t.length)return e;t=g(t);for(var r,i=[],s=function t(e,r,i){var s;if(void 0===i&&(i=0),e&&u(e)&&e.length){try{if(void 0!==r[e[i]])return s=r[e[i]],e[++i]?t(e,s,i):s}catch(t){console.log(t.toString())}return s}},n=0;n<e.length;n++)if(r=e[n],f(r)){for(var o=void 0,a=[],c=0;c<t.length;c++)o=s((t[c]||"").split("."),r,0),a.push(o);t.length===a.length&&a.filter(t=>void 0===t).length===t.length&&(a=a.filter(t=>!!t)),a.length?i.push([].concat(a)):void 0!==o&&i.push(o)}else i.push([r]);return i},t=>!!t&&void 0!==t.prototype);t.hasPrototype=y,t.hasProto=t=>{try{return void 0!==t.__proto__}catch(t){return!1}},t.isString=t=>void 0!==t&&(""===t||i===t.__proto__),t.isFunction=t=>"function"==typeof t,t.copyBy=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=[]),!f(t))return{};var r=[].concat(e).reduce((e,r)=>(void 0!==t[r]&&(e[r]=t[r]),e),{});try{return JSON.parse(JSON.stringify(r))}catch(t){return{}}},t.copy=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return l(t).primitiveValue}},t.delay=function(t){return void 0===t&&(t=100),"number"==typeof t&&0<=t?new Promise(e=>{var r=setTimeout(()=>{clearTimeout(r),e(!0)},t)}):Promise.resolve(!0)},t.someKeyMatch=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||Object.prototype!==t.__proto__)return!1;if(!e||Object.prototype!==e.__proto__)return!1;var r=Object.keys(t),i=Object.keys(e);return r.length>=i.length?0<r.filter(t=>i.filter(e=>e===t).length).length:0<i.filter(t=>r.filter(e=>e===t).length).length},t.exactKeyMatch=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!t||Object.prototype!==t.__proto__)return!1;if(!e||Object.prototype!==e.__proto__)return!1;var r=Object.keys(t),i=Object.keys(e);return r.length>=i.length?r.filter(t=>i.filter(e=>e===t).length).length===r.length:i.filter(t=>r.filter(e=>e===t).length).length===i.length},t.trueVal=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?[].concat(t).filter(t=>!0!==d(t)):[]},t.trueValDeep=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?[].concat(t).map(t=>{var e=l(t,!1);return"array"===e.type&&0<e.value?t.map(t=>0<l(t,!1).value?t:null).filter(t=>!!t):"object"===e.type&&e.value?Object.entries(t).reduce((t,e)=>{var[r,i]=e;return 0<l(r,!1).value&&(t[r]=i),t},{}):0<e.value?t:null}).filter(t=>!!t):[]},t.trueProp=function(t){return void 0===t&&(t={}),t&&Object.prototype===t.__proto__?Object.assign({},Object.entries(t).reduce((t,e)=>{var[r,i]=e;return d(i)||(t[r]=i),t},{})):0},t.resolver=function(t,e,r){return void 0===e&&(e=5e3),void 0===r&&(r=50),"function"==typeof t?new Promise(i=>{var n=r||50,o=e,a=0,c=null,u=setInterval(function(t){return function(){var e=this,r=arguments;return new Promise((function(i,n){function o(t){s(c,i,n,o,a,"next",t)}function a(t){s(c,i,n,o,a,"throw",t)}var c=t.apply(e,r);o(void 0)}))}}((function*(){if(a>=o)return i(void 0),clearInterval(u);var e=(()=>{try{return c||(c=t()),p(c)?c:t()}catch(t){return h(t)?{error:t}:f(t)?t.error?t:{error:t}:{error:t.toString()}}})();if(p(e))try{var r=yield e;return i(r),clearInterval(u)}catch(t){return h(t)&&i({error:t}),f(t)?t.error?i(t):i({error:t}):i({error:t.toString()}),clearInterval(u)}return void 0===e?void(a+=n):(i(e),clearInterval(u))})),n)}):Promise.reject("fn() must be callable")},t.flatten=function(t){return void 0===t&&(t=[]),u(t)?[].concat(...t):[]},t.flattenDeep=function(t){return void 0===t&&(t=[]),u(t)?function t(e,r){return void 0===r&&(r=1),0<r?e.reduce((e,i)=>e.concat(Array.isArray(i)?t(i,r-1):i),[]):e.slice()}(t,1/0):[]},t.chunks=(t,e)=>Array.from({length:Math.ceil(t.length/e)},(r,i)=>t.slice(i*e,i*e+e)),t.uniq=g,t.isPromise=p,t.debug=function(){if(o()&&"off"!==n("debug")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return a("debug",e)}},t.log=function(){if(o()&&"off"!==n("log")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return a("log",e)}},t.warn=function(){if(o()&&"off"!==n("warn")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return a("warn",e)}},t.onerror=c,t.error=c,t.alert=function(){if(o()&&"off"!==n("alert")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return a("alert",e)}},t.attention=function(){if(o()&&"off"!==n("attention")){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return a("attention",e)}},t.isObject=f,t.isFalsy=d,t.isError=h,t.typeCheck=l,t.validDate=t=>{try{return!(t.__proto__!==Date.prototype||"Invalid Date"===t.toString())}catch(t){return!1}},t.isInstance=t=>!!t&&!u(t)&&!!(t.__proto__&&!y(t)&&t.__proto__.__proto__&&t.__proto__.__proto__===Object.prototype&&t instanceof Object),t.isClass=y,t.isArray=u,t.dupes=(t,e)=>{for(var r=[],i=parseInt(e);0<i;)i--,r.push(t);return r},t.notify=function(t,e){throw void 0===t&&(t=null),void 0===e&&(e=null),"no notify support for x-utils-es, use: x-utils"}},s=[e],void 0===(n="function"==typeof(i=o)?i.apply(e,s):i)||(t.exports=n)}).call(this,r(2))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){t.exports=r(4)},function(t,e){t.exports=function(){return new function(){const t={};let e=null;const r=new Promise((e,r)=>{t.resolve=e,t.reject=r});this.resolve=(r=null)=>(e||(t.resolve(r),e=!0),this),this.reject=(r=null)=>(e||(t.reject(r),e=!0),this),this.promise=()=>r}}},function(t,e,r){t.exports=()=>{const{objectSize:t,warn:e,onerror:i,validID:s,copy:n,log:o,isString:a}=r(1);return class{constructor(t={},e){this.debug=e||!1,this.async=(t||{}).async||null,this._onChange=(t||{}).onChange||null,this.completeOnNull=(t||{}).completeOnNull||null,this.disableWarnings=(t||{}).disableWarnings,this.dispatcher=(t||{}).dispatcher?r(6)():null,this.pocket={},this.payloadData={},this.lastPocketTimestamp=0,this._lastProjectID=null,this._lastProbeID=null,this._$cached_data={},this.$transfer_lastID="",this._ready={},this._ready_method_set={},this.d=void 0,this._projectSet={},this._transferCached=[],this._projectSetDispatcher={},this._projectSetAsync={},this._lastFilterList={},this.projectsCache={},this.deleteWithDelay=(t||{}).deleteWithDelay||1e3}projectSetDispatcher(t){return t?(this._projectSetDispatcher[t]||this._projectSetDispatcher[t]||(this._projectSetDispatcher[t]=r(6)(t)),this._projectSetDispatcher[t]):(this.debug&&i("[projectSetDispatcher] projectID must be set"),null)}projectProbeList(t){return t?Object.entries(this.pocket).filter(([e])=>0===e.indexOf(t)).map(([t,e])=>e):[]}clearStoreTransfers(t=""){if(!t)return;let e=!1;return this._transferCached.length&&this._transferCached.forEach((r,i)=>{const{fromProbeID:s}=r||{};s&&-1!==s.indexOf(t)&&(this._transferCached.splice(i,1),e=!0,this.debug&&o("[pocket]",`[clearStoreTransfers] transferCached for probeID: ${s} has been removed`))}),e}storeTransfers(t,e){return this._transferCached.push({timestamp:(new Date).getTime(),fromProbeID:t,data:e}),this._transferCached}accessLastValidTransfer(e=100){if(!this._transferCached.length)return{};this._transferCached.sort((t,e)=>t.timestamp-e.timestamp);const r=n(this._transferCached).reduce((t,r,i)=>{const{timestamp:s}=r,n=(new Date).getTime()+e;return n>s&&n-s-e<=e&&(t=r,this._transferCached.splice(i,1)),t},{});return t(r)?r:{}}selectByTask(t="",r=null){if(t=a(t)?t:"",!this.idRegexValid(t)&&t)return null;if(t.indexOf(":")>0&&!this.pocket[t])return this.debug&&e("[pocket]","[selectByTask] when using '::' prefix selector, it should come at 0 index"),null;if(t.split(":").length>3||2===t.split(":").length)return this.debug&&e("[pocket]",`[selectByTask] wrong taskName :${t}, allowed prefix is '::taskName'`),null;if(r&&this.lastProbeID(t,!0),this.pocket[t])return r&&this.lastProbeID(t),t;const i=(t=>{const e=t.split("::")[1]||t;return(this._lastProbeID||"").indexOf(e)>0&&e?this._lastProbeID:this._lastProjectID&&e?this._lastProjectID+"::"+e:this._lastProbeID})(t);return i?r&&this.lastProbeID(i):this.debug&&e("[pocket]","[selectByTask] newProbeID was not found from taskOrProbeID: "+t),i}lastProjectID(t="",e=null,r="strict"){return!t&&this._lastProjectID&&(t=this._lastProjectID),t&&(t=this.validProjectID(t,e)),t&&this.payloadData[t]&&(this._lastProjectID=t),(this.payloadData[t]||"strict"!==r)&&t?(t&&!this._lastProjectID&&(this._lastProjectID=t),t):null}lastProbeID(t="",e=null){return!t&&this._lastProbeID&&(t=this._lastProbeID),t&&(t=this.validProbe(t,e)),t&&this.pocket[t]&&(this._lastProbeID=t),t&&this.pocket[t]?t:null}validProjectID(t,e=null){return(t=s(t))?(t||"").split(" ").length>1?null:this.idRegexValid(t)?t:null:null}validProbe(t,e=null){return(t=s(t))?this.idRegexValid(t)?-1===t.indexOf("::")?null:t:void 0:null}dataPropSelector(r="data()",i="",s={},n=!1,o={}){let a;try{return a=Object.entries(s).reduce((t,[e,r],i)=>(void 0!==o[e]&&(t[e]=o[e]),t),{}),t(a)||(a=void 0),t(a)+t(s)===2&&(a=Object.values(a).shift()),"data()"===r&&(this._$cached_data[i]=a),n?this:a}catch(t){return this.debug&&e("[pocket]","[$data] no dataProp found on probeID: "+i),"data()"===r&&(this._$cached_data[i]=a),n?this:a}}idRegexValid(t){return!new RegExp(/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi,"gi").test(t)||null}get probeProps(){return["campaign","data","task","ref","error","id","status"]}}}},function(t,e){t.exports=function(t,e=null){return new function(t,e){const r="[dispatcher]";this.uid=(t||"").toString()||(new Date).getTime(),this.debug=e,this.cbQueue={},this.dispatchInstance={},this.initListener=()=>(this.Dispatch(),this),this.next=(t=null)=>(this.dispatchInstance[this.uid]?this.dispatchInstance[this.uid].next(t):this.debug&&console.log({message:r+" for uid not available",uid:this.uid}),this),this.Dispatch=()=>{if(this.dispatchInstance[this.uid])return this;const t=this;return this.dispatchInstance[this.uid]||(this.dispatchInstance[this.uid]=new function(){this.uid=t.uid,this.data=null,this.next=e=>{"cb"!==(e||{}).type&&(this.data=e),"cb"!==(e||{}).type?this.data?"function"==typeof t.cbQueue[t.uid]&&t.cbQueue[t.uid].call(t,this.data,t.uid):this.debug&&console.log(r+" no callback data"):"function"==typeof e.cb&&(t.cbQueue[t.uid]||(t.cbQueue[t.uid]=e.cb),this.data&&e.cb.call(t,this.data,t.uid))}}),this},this.isActive=()=>!!this.dispatchInstance[this.uid],this.del=()=>(delete this.cbQueue[this.uid],delete this.dispatchInstance[this.uid],!this.cbQueue[this.uid]&&this.dispatchInstance[this.uid],this),this.subscribe=t=>"function"==typeof t?(this.dispatchInstance[this.uid]||this.Dispatch(),this.dispatchInstance[this.uid]&&this.dispatchInstance[this.uid].next({type:"cb",cb:t}),this):(this.debug&&console.log(r+"[batchReady] cb must be set"),this)}(t,e)}},function(t,e,r){e.Probe=()=>{const{isString:t,isArray:e,warn:i,log:s,isNumber:n,onerror:o,last:a,copy:c,isObject:u,isFunction:l}=r(1),h=r(3);return class{constructor(e={},r={},i){if(this.debug=i||!1,(n(e.id)||e.id)&&(e.id=e.id.toString()),!e.task||!t(e.task))throw"task as string is required";this._id=null,this._error=[],this._ref=null,this._task=null,this._status=null,this._data=null,this._campaign=null,this._dataIndex=0,this._statusIndex=0,this._statusAsync=[],this.task=e.task,this.id=e.id,this.status="open",this._onChange=r.onChange||null,this._onchangeDispatch=null,this.emitter=r.emitter||null,this.completeOnNull=r.completeOnNull||null,this.disableWarnings=(r||{}).disableWarnings,e.ref!==this._ref&&(this.ref=e.ref),e.data!==this._data&&(this.data=e.data),e.campaign&&(this.campaign=e.campaign),this._completeAsync=h()}get sq(){return this._sq||(this._sq=h()),this._sq}set id(t){if(this._id)return void(this.debug&&i("[pocket]","cannot update already set id: "+this._id));if(!t)throw"id is required";if(t.split(" ").length>1)throw"each id cannot have spaces";if(-1===t.indexOf("::"))throw"each id must be of format id::taskName";if(-1!==t.indexOf(":::"))throw"each id must be of format id::taskName";const e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your id is invalid, allowed chars: "+e;if(-1===(t=t.replace(/ /gi,"_").toLowerCase()).indexOf(this._task))throw"wrong id setup, your id should make up the taks name, example: id='cocacola::drink'";this._id=t}get id(){return this._id}set error(t){t&&(!(t||[]).length&&e(t)||(this._error.push(t),this._error=this._error.filter(t=>!!t),this.dispatchChange("error")))}get error(){return this._error.length?this._error:null}get ref(){return this._ref}set ref(e){e&&(t(e)?"complete"!==this.status&&"send"!==this.status&&(this._ref=e,this.dispatchChange("ref")):i("[pocket]","[ref] must be a string"))}get campaign(){return this._campaign}set campaign(e){void 0!==e&&(this._campaign?this.debug&&!this.disableWarnings&&i("[pocket]","cannot update already set campaign "+this._campaign):e&&(t(e)?(this._campaign=e,this.dispatchChange("campaign")):this.debug&&i("[pocket]","campaign must be a string",e)))}set task(e){if(void 0===e)return;if(this._task)return void(this.debug&&!this.disableWarnings&&i("[pocket]","cannot update already set task"));if(!e)return;if(!t(e))return void(this.debug&&i("[pocket]","task must be a string"));if(-1!==e.indexOf("::"))throw"task seperator :: is restricted";if(e.split(" ").length>1)throw"task cannot have spaces, use seperators: _+";const r=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(r,"gi").test(e))throw"your task is invalid, allowed chars: "+r;this._task=e.replace(/ /gi,"_").toLowerCase()}get task(){return this._task}set data(t){if(void 0!==t)return"complete"===this.status||"send"===this.status?(this.debug&&!this.disableWarnings&&i("[pocket]","you cannot update data once the status is complete or send"),null):(this._dataIndex++,"open"===this.status&&null!==this._data&&this._dataIndex>1&&(this.status="updated"),this._data=t,void this.dispatchChange("data"))}get data(){return this._data}update(t,e=null){return"complete"===this.status||"send"===this.status?(this.debug&&!this.disableWarnings&&i("[Probe][update] cannot update data on complete status"),this):!u(t)&&e?(this.debug&&i("[pocket]","[Probe][update] cannot update none object 'data' with option 'merge=true' set"),this):(u(t)&&e?this.data=Object.assign({},this.data,t):void 0!==t&&(this.data=t),this)}get statusStackOrder(){return{open:{value:1,set:!1},updated:{value:2,set:!1},complete:{value:3,set:!1},send:{value:4,set:!1},error:{value:5,set:!1}}}get status(){return this._status}set status(t){(e=>{try{if(this.statusStackOrder[e].value>2&&!0===this.statusStackOrder[e].set)return!1}catch(t){o("statusStackOrder invalid status")}switch(e){case"open":if("updated"===this._status){this.debug&&i("[pocket]","cannot set status back to open once set to updated");break}this._status=e,this.statusStackOrder[e].set=!0,this.onOpenStatus(t),this.setStatusAsync=e,this.dispatchChange("status");break;case"updated":if("complete"===this._status){this.debug&&i("[pocket]","cannot update status to 'updated' then previously set to 'complete'");break}this._dataIndex>0&&(this._status=e,this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this.dispatchChange("status"),this.debug&&s(`id:${this.id}, data updated`));break;case"complete":if(null===this.data&&!0!==this.completeOnNull){this.debug&&i("[pocket]","[status] cannot complete status because data is null, to complete you set data prop to false");break}this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this._status=e,this.dispatchChange("status"),this.onComplete(t);break;case"send":if("complete"!==this._status){this.debug&&i("[pocket]","cannot update status to 'send' then previously not set to 'complete'");break}this._status=e,this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this._completeAsync.resolve({status:this._status,id:this.id}),this.dispatchChange("status");break;case"error":if("complete"===this._status)return;this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this.dispatchChange("status"),this.onComplete(t);break;default:this.debug&&i("[pocket]",`id:${this.id},  you set invalid status: ${e}, nothing changed`)}})(t)}set setStatusAsync(t){const e={timestamp:(new Date).getTime(),p:h()};this._statusAsync.push(e)}get setStatusAsync(){const t=a(this._statusAsync.sort((t,e)=>t.timestamp-e.timestamp).map(t=>t.p));return t.resolve(c(this.status)),t}get getStatusAsync(){return this.setStatusAsync.promise()}get completeAsync(){return this._completeAsync.promise()}get statusAsync(){return this.getStatusAsync}all(){return{error:this.error,ref:this.ref,campaign:this.campaign,data:this.data,id:this.id,task:this.task,status:this.status}}onChange(t,e="all"){if(!this._onChange)return this.debug&&i("[pocket]","[onChange] to use need to set opts.onChange=true"),this;if(!l(t))return this.debug&&i("[onChange] cb must be a function"),this;if(!["all","data","status","ref","error","campaign"].includes(e))return this.debug&&i("[pocket]","[onChange] no watch available for "+e),this;const r=this;return this.onchangeDispatch?(this.onchangeDispatch.initListener().subscribe((function(i,s){i.changed&&"all"===e?t.bind(r)(c(r.all()),s):i.changed===e&&void 0!==r[e]&&t.bind(r)(c(r[e]),s)})),this):(this.debug&&i("[pocket]","[onChange] onchangeDispatch no longer active"),this)}dispatchChange(t){return this._onChange&&this.onchangeDispatch?(this.onchangeDispatch.initListener().next({changed:t}),!0):null}get onchangeDispatch(){return this._onChange?(this._onchangeDispatch||(this._onchangeDispatch=r(6)(this.id)),this._onchangeDispatch):(this.debug&&i("[pocket]","[onchangeDispatch] to use need to set opts.onChange=true"),null)}onComplete(t){"complete"!==t&&"error"!==t||"send"===this._status||!(this._dataIndex>0||!0===this.completeOnNull)||(this.emitter&&setTimeout(()=>{this.emitter({probe:this,status:t})}),this._status="send",this.sq.resolve({probe:this.all()}),setTimeout(()=>{this.onchangeDispatch&&this.onchangeDispatch.del()}))}onOpenStatus(t){"open"===t&&this.emitter&&setTimeout(()=>{this.emitter({probe:this,status:"open"})})}}}},function(t,e,r){t.exports=t=>{const{objectSize:e,isFunction:i,onerror:s,warn:n,log:o,isString:a}=r(1);function c(){this._architectVal=null,this.architect=Object.create(c.prototype,{value:{enumerable:!0,configurable:!0,get:()=>this._architectVal,set:t=>{e(t)&&(this._architectVal=t,o("[pocket]","[architect] updated"))}}})}return class extends t{constructor(t,e){super(t,e),this.architectConfig={};const r=new c;this.architectMod=r.architect}setArchitect(t,e){return void 0===this.architectConfig[t]&&(this.architectConfig[t]=this.architectMod),this.architectConfig[t].value=Object.assign({},this.architectConfig[t].value,e),this}getArchitect(t){return(this.architectConfig[t]||{}).value}asset(t,e,r){if(!i(e))return this.debug&&n("[pocket]","[$asset] asCallback must be a function"),null;if("project"===t||"cache"===t)return void(this.debug&&n("[pocket]","[$asset] 'project, cache' are  restricted"));const s=this.lastProjectID(r);return r=this.validProjectID(s||r),this.getArchitect(r)?void 0!==this.getArchitect(r)[t]?e.call(this,this.getArchitect(r)[t]):(this.debug&&n("[pocket]","[$asset] assetName for architect doesnt exist"),null):(this.debug&&n("[pocket]","[$asset] architectConfig for assetName doesnt exist"),null)}architect(t,r){if(!i(t))return this.debug&&s("[pocket]","[$architect] callback must be set"),this;const o=t.call(this);if(!e(o))return this.debug&&s("[pocket]","[architect] must return a valid object settings {project, asset}, at least 1 is required"),this;const c=(o.project||{}).id,u=this.lastProjectID(r);if(!(r=this.validProjectID(u||r||c)))return this.debug&&s("[pocket]","[$architect] if this is a new project, you must specify projectID"),this;const l=Object.entries(o).reduce((t,[e,r])=>(-1!==["project","asset","cache"].indexOf(e)&&(t[e]=r),t),{});if((this.getArchitect(r)||{}).cache)l.cache=this.getArchitect(r).cache;else{const t={project:!1,asset:!1};l.cache||(l.cache=t),this.setArchitect(r,{cache:l.cache})}for(let t in l){const e=l[t],i=!0===l.cache[t]&&("project"===t||"asset"===t);if("project"===t){try{if(i&&this.getArchitect(r)[t])continue}catch(t){}this.setArchitect(r,{project:this.$payload(e,e.async,e.type).d})}if("asset"===t){if(!a(e.name)||void 0===e.value)return this.debug&&n("[pocket]","[$architect] asset must include {value, name}"),this;if("project"===e.name||"cache"===e.name)return this.debug&&n("[pocket]",'[$architect] asset props, "project, cache" are reserved'),this;try{if(i&&this.getArchitect(r)[e.name])continue}catch(t){}this.setArchitect(r,{[e.name]:e.value})}}return this}}}},function(t,e,r){t.exports=t=>{const{copy:e,warn:i,isArray:s,onerror:n,objectSize:o,isString:a,uniq:c,isFunction:u}=r(1);return class extends t{constructor(t,e){super(t,e)}$architect(...t){return this.architect(...t)}$asset(...t){return this.asset(...t)}$exists(t){return!!this.selectByTask(t)}$projectComplete(t){return this.projectsCache[t]?"complete"===this.projectsCache[t]:null}$projectSet(t=""){return t=this.validProjectID(t),!!this.payloadData[t]}$condition(t,e){if(!u(t))return this.debug&&i("[pocket]","[$condition] must provide callback"),this;let r="PocketSelf",s=null;if(0===(e=a(e)?e:"").indexOf("::")){if(e=this.selectByTask(e,!0),r="ProbeSelf",!(e=this.lastProbeID(e)))return this.debug&&i("[pocket]","[$condition] probeID not found"),this}else{if(!this.lastProjectID(e))return this.debug&&i("[pocket]","[$condition] projectID not found"),this;r="PocketSelf"}if("PocketSelf"===r&&(s=this),"ProbeSelf"===r&&(s=this.$get(e)),!s)return this.debug&&i("[pocket]","[$condition] no valid self value"),this;return t.call(s,s)||this}get $projectID(){return this._lastProjectID}$probeStatusAsync(t=""){t=this.selectByTask(t,!0);let e=this.lastProbeID(t);return this.probeStatusAsync(e)}$get(t,e){t=this.selectByTask(t,!0);let r=this.lastProbeID(t);return this._get(r,e)}$getByRef(t=""){return Object.assign(this.pocket).filter(([e,r],i)=>r.ref===t)}$set(t,e){e=this.selectByTask(e,!0);let r=this.lastProbeID(e);return this._set(t,r)}$probe(t=""){t=this.selectByTask(t,!0);let e=this.lastProbeID(t);if(this.pocket[e]){if("Probe"===this.pocket[e].constructor.name)return this.pocket[e];this.debug&&n("[pocket]",`[$probe] probeID: ${t} is not an instance of Probe{}`)}else this.debug&&i("[pocket]","[$probe] not found for probeID: "+t)}$update(t,e,r){r=this.selectByTask(r,!0);let i=this.lastProbeID(r);return this.update(t,e,i)}$select(t=""){return t=a(t)?t:"",this.lastProjectID(t),this}$filter(t,e){e=this.lastProjectID(e);const r=t=>(this.d=(t||[]).filter(t=>void 0===t.isNONE),this);if(!u(t))return r([]);if(!this.payloadData[e])return this.debug&&i("[pocket]","[$filter] no projectID found"),r(null);let s=[];return(this._lastFilterList[e]||[]).length?s=this._lastFilterList[e]:(this._lastFilterList[e]=[],s=this.projectProbeList(e)),s.forEach((r,i)=>{if(r.isNONE)return;const s=t.call(r,r);if(!s)return this._lastFilterList[e]=this._lastFilterList[e].filter(t=>t.id!==r.id),void this._lastFilterList[e].push({id:r.id,isNONE:!0});void 0===s||!0!==s&&1!==s?this._lastFilterList[e].push({id:r.id,isNONE:!0}):this._lastFilterList[e].filter((t,e)=>(t||{}).id===r.id).length||this._lastFilterList[e].push(r)}),r(this._lastFilterList[e])}$compute(t,e=""){e=this.lastProjectID(e);const r=t=>(t&&delete this._lastFilterList[e],this.d=t,this);if(!u(t))return this.debug&&i("[pocket]","[$compute] cb must be a function"),r(null);if(!this.payloadData[e])return this.debug&&i("[pocket]","[$compute] no project found fo your/last id projectID:"+e),r(null);let s=this._lastFilterList[e]||[];return s.length?(this._lastFilterList[e]=s=s.filter(t=>void 0===t.isNONE).filter(({id:t},e,r)=>1===r.filter(e=>t===e.id).length),s.forEach(e=>{"complete"!==e.status&&"send"!==e.status&&t.call(e,e)}),r(this._lastFilterList[e])):(this.projectProbeList(e).forEach(e=>{"complete"!==e.status&&"send"!==e.status&&t.call(e,e)}),r(this.projectProbeList(e)))}$list(t="",e=null,r="self"){if(t=this.lastProjectID(t),!this.payloadData[t])return[];const i=()=>Object.entries(this.pocket).reduce((e,[r,i],s)=>(i.id.includes(t)&&e.push(i),e),[]);return u(e)?(this.projectProbeList(t).forEach(t=>{e(t.all())}),"self"!==r&&r?"list"===r?i():void 0:this):i()}$transfer(t=""){return t=this.selectByTask(t,!0),t=this.lastProbeID(t),this.pocket[t]?(this.storeTransfers(t,e(this.pocket[t].data)),this.$transfer_lastID=t,this):(this.debug&&i("[pocket]","[$transfer] no Probe{} found for this id fromProbeID:"+t),this)}$to(t="",e=!0,r=100){if(t=this.selectByTask(t,e),e&&(t=this.validProbe(t)),!t)return this.debug&&i("[pocket]","[$to] toProbeID is invalid"),this;if(!this.pocket[t])return this.debug&&i("[pocket]","[$to] no Probe{} found for this id toProbeID:"+t),this;if(this.$transfer_lastID){const e=this.accessLastValidTransfer(r);if(o(e)){const{fromProbeID:r,data:s}=e;if(this.$transfer_lastID===r){if("complete"===this.pocket[t].status||"send"===this.pocket[t].status)return this.debug&&i("[pocket]",`[$to] cannot transfer since toProbeID: ${t} is already complete`),this.$transfer_lastID="",this;this.pocket[r].data=null,this.pocket[t].data=s}}else this.debug&&i("[pocket]","[$to] no last valid transfer found");this.$transfer_lastID=""}return this}$of(t=""){return this.selectByTask(t,!0),this}$data(t=null,r="",i=!1){return r=this.selectByTask(r,!0),this.pocket[r]?(s(t)&&(t||[]).length&&(t=c(t).reduce((t,e)=>(void 0!==e&&(t[e.trim()]=!0),t),{})),t&&o(t)?this.dataPropSelector("data()",r,t,i,e(this.pocket[r].data)):(this._$cached_data[r]=e(this.pocket[r].data),i?this:this._$cached_data[r])):i?this:void 0}$cached(t={},e=""){if(e=this.selectByTask(e,!0),!this.pocket[e])return;const r=void 0!==this._$cached_data[e]&&null!==this._$cached_data[e];return r?(a(t)&&(t||"").length&&(t=c(t.trim().replace(/ /gi,"").split(",")).reduce((t,e)=>(void 0!==e&&(t[e]=!0),t),{})),!o(this._$cached_data[e])&&r?o(t)?void 0:this._$cached_data[e]:t&&o(t)?this.dataPropSelector("cached()",e,t,!1,this._$cached_data[e]):void 0===this._$cached_data[e]?void 0:this._$cached_data[e]):void 0}$campaign(t){return t=this.selectByTask(t,!0),this.pocket[t]?e(this.pocket[t].campaign):null}$ref(t){return t=this.selectByTask(t,!0),this.pocket[t]?e(this.pocket[t].ref):null}$status(t){return t=this.selectByTask(t,!0),this.pocket[t]?e(this.pocket[t].status):null}$task(t){return t=this.selectByTask(t,!0),this.pocket[t]?e(this.pocket[t].task):null}$error(t){return t=this.selectByTask(t,!0),this.pocket[t]?e(this.pocket[t].error):null}$all(t){return t=this.selectByTask(t,!0),this.pocket[t]?e(this.pocket[t].all()):null}$onChange(t,e,r){return this._onChange?(r=this.selectByTask(r,!0),this.pocket[r]?(this.pocket[r].onChange(t,e),this):null):(this.debug&&i("[pocket]","[$onChange] opts.onChange=true must be enabled to use this feature"),this)}}}}]);