module.exports=function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var a=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(a,t);var e,i,r=(e=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=n(e);if(i){var s=n(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return o(this,t)});function a(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),r.call(this,t,e)}return a}(i(1));t.exports=a},function(t,e,i){i(2);const{$computeCallBack:r}=i(7),{copy:s,warn:o,isArray:n,onerror:a,objectSize:c,isString:u,uniq:h,isFunction:l}=(i(9),i(3)),{validProbe:d,validProjectID:p}=i(10),f=i(11);t.exports=class extends f{constructor(t,e){super(t,e)}$architect(t,e){return super.architect(t,e)}$asset(t,e,i){return super.asset(t,e,i)}$exists(t){return!!this.selectByTask(t)}$projectComplete(t){return this.projectsCache[t]?"complete"===this.projectsCache[t]:null}$projectSet(t=""){return t=p(t),!!this.payloadData[t]}$condition(t,e){if(!l(t))return this.debug&&o("[pocket]","[$condition] must provide callback"),this;let i="PocketSelf",r=null;if(0===(e=u(e)?e:"").indexOf("::")){if(e=this.selectByTask(e,!0),i="ProbeSelf",!(e=this.lastProbeID(e)))return this.debug&&o("[pocket]","[$condition] probeID not found"),this}else{if(!this.lastProjectID(e))return this.debug&&o("[pocket]","[$condition] projectID not found"),this;i="PocketSelf"}if("PocketSelf"===i&&(r=this),"ProbeSelf"===i&&(r=this.$get(e)),!r)return this.debug&&o("[pocket]","[$condition] no valid self value"),this;return t.call(r,r)||this}get $projectID(){return this._lastProjectID}$probeStatusAsync(t=""){t=this.selectByTask(t,!0);let e=this.lastProbeID(t);return super.probeStatusAsync(e)}$get(t,e){t=this.selectByTask(t,!0);let i=this.lastProbeID(t);return super._get(i,e)}$getByRef(t=""){return Object.assign(this.pocket).filter(([e,i],r)=>i.ref===t)}$set(t,e){e=this.selectByTask(e,!0);let i=this.lastProbeID(e);return super._set(t,i)}$probe(t=""){t=this.selectByTask(t,!0);let e=this.lastProbeID(t);if(this.pocket[e]){if("Probe"===this.pocket[e].constructor.name)return this.pocket[e];this.debug&&a("[pocket]",`[$probe] probeID: ${t} is not an instance of Probe{}`)}else this.debug&&o("[pocket]","[$probe] not found for probeID: "+t)}$update(t,e,i){i=this.selectByTask(i,!0);let r=this.lastProbeID(i);return super.update(t,e,r)}$select(t){return t=u(t)?t:"",this.lastProjectID(t),this}$filter(t,e){const i=this;e=this.lastProjectID(e);const r=t=>(this.d=(t||[]).filter(t=>void 0===t.isNONE),i);if(!l(t))return r([]);if(!this.payloadData[e])return this.debug&&o("[pocket]","[$filter] no projectID found"),r(null);let s=[];return(this._lastFilterList[e]||[]).length?s=this._lastFilterList[e]:(this._lastFilterList[e]=[],s=this.projectProbeList(e)),s.forEach((i,r)=>{if(i.isNONE)return;const s=t.call(i,i);if(!s)return this._lastFilterList[e]=this._lastFilterList[e].filter(t=>t.id!==i.id),void this._lastFilterList[e].push({id:i.id,isNONE:!0});void 0===s||!0!==s&&1!==s?this._lastFilterList[e].push({id:i.id,isNONE:!0}):this._lastFilterList[e].filter((t,e)=>(t||{}).id===i.id).length||this._lastFilterList[e].push(i)}),r(this._lastFilterList[e])}$compute(t,e=""){e=this.lastProjectID(e);const i=t=>(t&&delete this._lastFilterList[e],this.d=t,this);if(!l(t))return this.debug&&o("[pocket]","[$compute] cb must be a function"),i(null);if(!this.payloadData[e])return this.debug&&o("[pocket]","[$compute] no project found fo your/last id projectID:"+e),i(null);let r=this._lastFilterList[e]||[];return r.length?(this._lastFilterList[e]=r=r.filter(t=>void 0===t.isNONE).filter(({id:t},e,i)=>1===i.filter(e=>t===e.id).length),r.forEach(e=>{"complete"!==e.status&&"send"!==e.status&&t.call(e,e)}),i(this._lastFilterList[e])):(this.projectProbeList(e).forEach(e=>{"complete"!==e.status&&"send"!==e.status&&t.call(e,e)}),i(this.projectProbeList(e)))}$list(t="",e=null,i="self"){if(t=this.lastProjectID(t),!this.payloadData[t])return[];const r=()=>Object.entries(this.pocket).reduce((e,[i,r],s)=>(r.id.includes(t)&&e.push(r),e),[]);return l(e)?(this.projectProbeList(t).forEach(t=>{e(t.all())}),"self"!==i&&i?"list"===i?r():void 0:this):r()}$transfer(t=""){return t=this.selectByTask(t,!0),t=this.lastProbeID(t),this.pocket[t]?(this.storeTransfers(t,s(this.pocket[t].data)),this.$transfer_lastID=t,this):(this.debug&&o("[pocket]","[$transfer] no Probe{} found for this id fromProbeID:"+t),this)}$to(t="",e=!0,i=100){if(t=this.selectByTask(t,e),e&&(t=d(t)),!t)return this.debug&&o("[pocket]","[$to] toProbeID is invalid"),this;if(!this.pocket[t])return this.debug&&o("[pocket]","[$to] no Probe{} found for this id toProbeID:"+t),this;if(this.$transfer_lastID){const e=this.accessLastValidTransfer(i);if(c(e)){const{fromProbeID:i,data:r}=e;if(this.$transfer_lastID===i){if("complete"===this.pocket[t].status||"send"===this.pocket[t].status)return this.debug&&o("[pocket]",`[$to] cannot transfer since toProbeID: ${t} is already complete`),this.$transfer_lastID="",this;this.pocket[i].data=null,this.pocket[t].data=r}}else this.debug&&o("[pocket]","[$to] no last valid transfer found");this.$transfer_lastID=""}return this}$of(t=""){return this.selectByTask(t,!0),this}$data(t,e="",i=!1){return e=this.selectByTask(e,!0),this.pocket[e]?(n(t)&&(t||[]).length&&(t=h(t).reduce((t,e)=>(void 0!==e&&(t[e.trim()]=!0),t),{})),t&&c(t)?this.dataPropSelector("data()",e,t,i,s(this.pocket[e].data)):(this._$cached_data[e]=s(this.pocket[e].data),i?this:this._$cached_data[e])):i?this:void 0}$cached(t={},e=""){if(e=this.selectByTask(e,!0),!this.pocket[e])return;const i=void 0!==this._$cached_data[e]&&null!==this._$cached_data[e];return i?(u(t)&&(t||"").length&&(t=h(t.trim().replace(/ /gi,"").split(",")).reduce((t,e)=>(void 0!==e&&(t[e]=!0),t),{})),!c(this._$cached_data[e])&&i?c(t)?void 0:this._$cached_data[e]:t&&c(t)?this.dataPropSelector("cached()",e,t,!1,this._$cached_data[e]):void 0===this._$cached_data[e]?void 0:this._$cached_data[e]):void 0}$campaign(t){return t=this.selectByTask(t,!0),this.pocket[t]?s(this.pocket[t].campaign):null}$ref(t){if(t=this.selectByTask(t,!0),this.pocket[t])return s(this.pocket[t].ref)}$status(t){if(t=this.selectByTask(t,!0),this.pocket[t])return s(this.pocket[t].status)}$task(t){if(t=this.selectByTask(t,!0),this.pocket[t])return s(this.pocket[t].task)}$error(t){if(t=this.selectByTask(t,!0),this.pocket[t])return s(this.pocket[t].error)}$all(t){if(t=this.selectByTask(t,!0),this.pocket[t])return s(this.pocket[t].all())}$onChange(t,e,i){return this._onChange?(i=this.selectByTask(i,!0),this.pocket[i]?(this.pocket[i].onChange(t,e),this):null):(this.debug&&o("[pocket]","[$onChange] opts.onChange=true must be enabled to use this feature"),this)}$onProbeComplete(t,e){if(!this._onChange)return this.debug&&o("[pocket]","[$onChange] opts.onChange=true must be enabled to use this feature"),this;if(e){if(e=this.selectByTask(e,!0),!this.pocket[e])return;return this.pocket[e].onChange(t,"status:complete"),this}{let e=this.lastProjectID();return this.projectProbeList(e).forEach(e=>{e.onChange(t,"status:complete")}),this}}}},function(t,e,i){const{isString:r,sq:s,isArray:o,warn:n,log:a,isNumber:c,onerror:u,last:h,copy:l,isObject:d,isFunction:p,dispatcher:f}=i(3),g=i(6);t.exports=class extends g{constructor(t,e={},i){if(super(t,e,i),this.debug=i||!1,(c(t.id)||t.id)&&(t.id=t.id.toString()),!t.task||!r(t.task))throw"task as string is required";this._id=null,this._error=[],this._ref=null,this._task=null,this._status=null,this._data=null,this._campaign=null,this._dataIndex=0,this._statusIndex=0,this._statusAsync=[],this.task=t.task,this.id=t.id,this.status="open",this._sealed=!1,this._onChange=e.onChange||null,this._onchangeDispatch=void 0,this.emitter=e.emitter||null,this.withDataBank=e.withDataBank||!1,this.completeOnNull=e.completeOnNull||null,this.disableWarnings=(e||{}).disableWarnings,t.ref!==this._ref&&(this.ref=t.ref),t.data!==this._data&&(this.data=t.data),t.campaign&&(this.campaign=t.campaign),this._completeAsync=s()}get sq(){return this._sq||(this._sq=s()),this._sq}set id(t){if(this._id)return void(this.debug&&n("[pocket]","cannot update already set id: "+this._id));if(!t)throw"id is required";if(t.split(" ").length>1)throw"each id cannot have spaces";if(-1===t.indexOf("::"))throw"each id must be of format id::taskName";if(-1!==t.indexOf(":::"))throw"each id must be of format id::taskName";const e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your id is invalid, allowed chars: "+e;if(-1===(t=t.replace(/ /gi,"_").toLowerCase()).indexOf(this._task))throw"wrong id setup, your id should make up the taks name, example: id='cocacola::drink'";this._id=t}get id(){return this._id}set error(t){t&&(this._error.push(o(t)?t.toString():t),this._error=this._error.filter(t=>!!t),this.dispatchChange("error"))}get error(){if(this._error.length)return this._error}get ref(){return this._ref}set ref(t){t&&(r(t)?"complete"!==this.status&&"send"!==this.status&&(this._ref=t,this.dispatchChange("ref")):n("[pocket]","[ref] must be a string"))}get campaign(){return this._campaign}set campaign(t){void 0!==t&&(this._campaign?this.debug&&!this.disableWarnings&&n("[pocket]","cannot update already set campaign "+this._campaign):t&&(r(t)?(this._campaign=t,this.dispatchChange("campaign")):this.debug&&n("[pocket]","campaign must be a string",t)))}set task(t){if(void 0===t)return;if(this._task)return void(this.debug&&!this.disableWarnings&&n("[pocket]","cannot update already set task"));if(!t)return;if(!r(t))return void(this.debug&&n("[pocket]","task must be a string"));if(-1!==t.indexOf("::"))throw"task seperator :: is restricted";if(t.split(" ").length>1)throw"task cannot have spaces, use seperators: _+";const e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your task is invalid, allowed chars: "+e;this._task=t.replace(/ /gi,"_").toLowerCase()}get task(){return this._task}set data(t){void 0!==t&&("complete"===this.status||"send"===this.status?this.debug&&!this.disableWarnings&&n("[pocket]","you cannot update data once the status is complete or send"):(this._dataIndex++,"open"===this.status&&null!==this._data&&this._dataIndex>1&&(this.status="updated"),this._data=t,this.withDataBank&&(this.dataBank=t),this.dispatchChange("data")))}get data(){return this._data}update(t,e=null){return"complete"===this.status||"send"===this.status?(this.debug&&!this.disableWarnings&&n("[Probe][update] cannot update data on complete status"),this):!d(t)&&e?(this.debug&&n("[pocket]","[Probe][update] cannot update none object 'data' with option 'merge=true' set"),this):(d(t)&&e?this.data=Object.assign({},this.data,t):void 0!==t&&(this.data=t),this)}get statusStackOrder(){return{open:{value:1,set:!1},updated:{value:2,set:!1},complete:{value:3,set:!1},send:{value:4,set:!1},error:{value:5,set:!1}}}get status(){return this._status}set status(t){(e=>{try{if(this.statusStackOrder[e].value>2&&!0===this.statusStackOrder[e].set)return!1}catch(t){u("statusStackOrder invalid status")}switch(e){case"open":if("updated"===this._status){this.debug&&n("[pocket]","cannot set status back to open once set to updated");break}this._status=e,this.statusStackOrder[e].set=!0,this.onOpenStatus(t),this.setStatusAsync=e,this.dispatchChange("status");break;case"updated":if("complete"===this._status){this.debug&&n("[pocket]","cannot update status to 'updated' then previously set to 'complete'");break}this._dataIndex>0&&(this._status=e,this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this.dispatchChange("status"),this.debug&&a(`id:${this.id}, data updated`));break;case"complete":if(null===this.data&&!0!==this.completeOnNull){this.debug&&n("[pocket]","[status] cannot complete status because data is null, to complete you set data prop to false");break}this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this._status=e,this.dispatchChange("status"),this.onComplete(t);break;case"send":if("complete"!==this._status){this.debug&&n("[pocket]","cannot update status to 'send' then previously not set to 'complete'");break}this._status=e,this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this._completeAsync.resolve({status:this._status,id:this.id}),this.dispatchChange("status");break;case"error":if("complete"===this._status)return;this.statusStackOrder[e].set=!0,this.setStatusAsync=e,this.dispatchChange("status"),this.onComplete(t);break;default:this.debug&&n("[pocket]",`id:${this.id},  you set invalid status: ${e}, nothing changed`)}})(t)}set setStatusAsync(t){const e={timestamp:(new Date).getTime(),p:s()};this._statusAsync.push(e)}get setStatusAsync(){const t=h(this._statusAsync.sort((t,e)=>t.timestamp-e.timestamp).map(t=>t.p));return t.resolve(l(this.status)),t}get getStatusAsync(){return this.setStatusAsync.promise}get completeAsync(){return this._completeAsync.promise}get statusAsync(){return this.getStatusAsync}all(){const t={error:this.error,ref:this.ref,campaign:this.campaign,data:this.data,id:this.id,task:this.task,status:this.status};return this.withDataBank&&(t.dataBank=l(this.dataBank)),t}onChange(t,e="all"){if(!this._onChange)return this.debug&&n("[pocket]","[onChange] to use need to set opts.onChange=true"),this;if(!p(t))return this.debug&&n("[onChange] cb must be a function"),this;let i=["all","data","status","ref","error","campaign"];if(i=[].concat(i,["status:complete"]),!i.includes(e))return this.debug&&n("[pocket]","[onChange] no watch available for "+e),this;let r=i.indexOf("status:complete");i.splice(r,1);const s=this;return this.onchangeDispatch?(this.onchangeDispatch.subscribe((function(i,r){if(i.changed&&"all"===e)t.bind(s)(s,r);else{if("status:complete"===e){if("status"===i.changed&&("send"===s.status||"complete"===s.status&&!s._sealed)){let e={...l(s.all()),status:"complete"};t.bind(s)(e,r),s._sealed=!0}return this}i.changed===e&&void 0!==s[e]&&t.bind(s)(l(s[e]),r)}})),this):(this.debug&&n("[pocket]","[onChange] onchangeDispatch no longer active"),this)}dispatchChange(t){return!!this._onChange&&!!this.onchangeDispatch&&(this.onchangeDispatch.next({changed:t}),!0)}get onchangeDispatch(){return this._onChange?(this._onchangeDispatch||(this._onchangeDispatch=f(this.id)),this._onchangeDispatch):(this.debug&&n("[pocket]","[onchangeDispatch] to use need to set opts.onChange=true"),null)}onComplete(t){return"complete"!==t&&"error"!==t||"send"===this._status||!(this._dataIndex>0||!0===this.completeOnNull)||(this.emitter&&setTimeout(()=>{this.emitter({probe:this,status:t})}),this._status="send",this.sq.resolve({probe:this.all()}),setTimeout(()=>{this.onchangeDispatch&&this.onchangeDispatch.del()})),this}onOpenStatus(t){return"open"===t&&this.emitter&&setTimeout(()=>{this.emitter({probe:this,status:"open"})}),this}}},function(t,e,i){(function(i,r){var s,o,n,a;a=function(t,e){"use strict";var s=Number.prototype,o=String.prototype;function n(t,e,i,r,s,o,n){try{var a=t[o](n),c=a.value}catch(t){return void i(t)}a.done?e(c):Promise.resolve(c).then(r,s)}function a(t){return function(){var e=this,i=arguments;return new Promise((function(r,s){function o(t){n(c,r,s,o,a,"next",t)}function a(t){n(c,r,s,o,a,"throw",t)}var c=t.apply(e,i);o(void 0)}))}}Object.defineProperty(e,"__esModule",{value:!0});var c=()=>{try{if("test"===(i.env||{}).NODE_ENV)return!1;if(window)return!0}catch(t){return!1}},u=function(t){void 0===t&&(t="");try{if(c())return window.xUtilsConfig||(window.xUtilsConfig={}),window.xUtilsConfig?"off"===window.xUtilsConfig.logging?"off":(window.xUtilsConfig[t]?window.xUtilsConfig[t]:"on").toString():"on"}catch(t){}try{return r.xUtilsConfig||(r.xUtilsConfig={}),r.xUtilsConfig?"off"===r.xUtilsConfig.logging?"off":(r.xUtilsConfig[t]?r.xUtilsConfig[t]:"on").toString():"on"}catch(t){}return"on"},h=()=>{try{if(c())return"on"===(window.xUtilsConfig||{}).logging||void 0===(window.xUtilsConfig||{}).logging}catch(t){}try{return"on"===(r.xUtilsConfig||{}).logging||void 0===(r.xUtilsConfig||{}).logging}catch(t){}return!0},l=function(t){if(void 0===t&&(t=void 0),"function"!=typeof t)return!1;try{var e=t();return!0===e||0<e}catch(t){return!1}},d=function(t,e){void 0===t&&(t=""),e.length||(e[0]="");var i=0===e.filter(t=>"string"==typeof t||void 0===t).length?"%o":"";"log"===t&&(e=[].concat("[90m[log][0m[2m"+i+" ",e,"[0m")),"debug"===t&&(e=[].concat("[90m[debug][0m[32m"+i+" ",e,"[0m")),"warn"===t&&(e=[].concat("[90m[warning][0m[1m"+i+" ",e,"[0m")),"alert"===t&&(e=[].concat("[90m[alert][0m[33m"+i+" ",e,"[0m")),"attention"===t&&(e=[].concat("[90m[attention][0m[36m"+i+" ",e,"[0m"));try{return void(window&&console.log.apply(null,e))}catch(t){}console.log.apply(null,e)},p=function(){if(h()&&"off"!==u("log")){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return d("log",e)}},f=function(){if(h()&&"off"!==u("warn")){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return d("warn",e)}},g=function(){if(h()&&"off"!==u("alert")){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return d("alert",e)}},y=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];if(h()&&"off"!==u("error")&&"off"!==u("onerror")){e.length||(e[0]="");var r=0===e.filter(t=>"string"==typeof t||void 0===t).length,s=r?"%o":"";try{if(c())return e=[].concat("[31m[error][0m[31m"+s+" ",e,"[0m"),void console.error.apply(null,e)}catch(t){}e=[].concat("[41m[error][0m[31m"+s+" ",e,"[0m"),console.error.apply(null,e)}},v=y,_=function(t){return void 0===t&&(t=void 0),"function"==typeof t},b=t=>"bigint"==typeof t,m=function(t,e){return void 0===t&&(t=void 0),void 0===e&&(e=void 0),(!_(e)||l(e))&&!b(t)&&!!t&&Array.prototype===t.__proto__},k=function(t,e){void 0===e&&(e=!0);var i=i=>e?typeof t:i||typeof t,r=e=>e.prototype===t.prototype;try{return"symbol"==typeof t?{type:i(),value:0,primitiveValue:Symbol("")}:void 0===t?{type:i(),value:0,primitiveValue:void 0}:"boolean"==typeof t?{type:i(),value:+t,primitiveValue:Boolean()}:"bigint"==typeof t&&"object"==typeof Object(t)?{type:i(),value:1,primitiveValue:BigInt("")}:null===t?{type:i("null"),value:0,primitiveValue:{}}:t.__proto__===Date.prototype||r(Date)?{type:i("date"),value:1,primitiveValue:new Date}:o===t.__proto__?{type:i(),value:t.length,primitiveValue:String()}:Array.prototype===t.__proto__||r(Array)?{type:i("array"),value:(t||[]).length,primitiveValue:[]}:Promise.prototype===(t||"").__proto__||r(Promise)?{type:i("promise"),value:1,primitiveValue:Function}:Function.prototype===t.__proto__||r(Function)?{type:i(),value:1,primitiveValue:Function}:Object.prototype===t.__proto__||r(Object)?{type:i(),value:Object.keys(t).length,primitiveValue:{}}:Error.prototype===t.__proto__||r(Error)?{type:i("error"),value:Object.keys(t).length,primitiveValue:Error()}:t.__proto__===s||r(Number)?isNaN(t)?{type:i("NaN"),value:0,primitiveValue:Number()}:{type:i(),value:t,primitiveValue:Number()}:0==0<=+t?{type:typeof t,value:+t,primitiveValue:void 0}:{type:typeof t,value:0,primitiveValue:void 0}}catch(t){return v(t),{}}},j=t=>Error.prototype===(t||"").__proto__,D=t=>{if(void 0===t)return!1;if(null===t)return!1;if(!0===t||!1===t)return!0;try{if(t instanceof Boolean)return!0}catch(t){}return!1},P=t=>null===t,w=t=>void 0===t,O=t=>{if(b(t))return!1;try{if(t instanceof Number)return!0}catch(t){}return!(null==t||""===t)&&t.__proto__===s},x=function(t){void 0===t&&(t=void 0);try{if(1==(void 0!==t.promise&&"function"==typeof t.resolve&&"function"==typeof t.reject&&"function"==typeof t.fulfill&&"function"==typeof t.notify))return!0}catch(t){}return!1},$=t=>{try{return"SimpleQ"===t.entity}catch(t){return!1}},C=t=>{if(x(t))return!0;try{if(t instanceof Promise)return!0}catch(t){}return!1},S=function(t,e){if(void 0===t&&(t=void 0),void 0===e&&(e=void 0),_(e)&&!l(e))return!1;if(b(t))return!1;if(isNaN(t)&&"number"==typeof t)return!1;if("function"==typeof t)return!1;if(!isNaN(+t)||void 0===t)return!1;if(t.__proto__===[].__proto__)return!1;if((Object.prototype===t.__proto__||Error.prototype===t.__proto__)&&t instanceof Object)return!0;if(void 0!==t.__proto__)try{return t instanceof Object}catch(t){return!1}return!!t.prototype},I=function(t){var e;return void 0===t&&(t=[]),(e=t.filter((t,e,i)=>i.indexOf(t)===e))instanceof Array?e:[]},A=function(t,e){return void 0===t&&(t={}),void 0===e&&(e=void 0),(!_(e)||l(e))&&!!t&&void 0!==t.prototype},T=function(t){void 0===t&&(t=/\\/);try{return t instanceof RegExp}catch(t){return!1}},L=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=void 0),_(e)&&!l(e))return!1;if(!t)return!1;if(m(t))return!1;if(t.__proto__&&!A(t))try{return t.__proto__ instanceof Object}catch(t){return!1}return!1},N=function(t){return void 0===t&&(t={}),t&&isNaN(+t)&&(L(t)||Object.prototype===t.__proto__||Error.prototype===t.__proto__)?Object.keys(t).length:0},E=function(t){return void 0===t&&(t=void 0),null==t||!1===t&&"boolean"==typeof t||(!0!==t||"boolean"!=typeof t)&&!("number"==typeof t&&0<t)&&(o===t.__proto__?1>t.length:Array.prototype===t.__proto__?0===(t||[]).length:Promise.prototype!==(t||{}).__proto__&&"function"!=typeof t&&(Object.prototype===t.__proto__||L(t)?0===Object.keys(t).length:Error.prototype!==t.__proto__&&(void 0!==t&&t.__proto__===s?!!isNaN(t)||0>=t:0==0<+t||!t&&!1)))},B=function(t,e){return void 0===t&&(t=void 0),void 0===e&&(e=void 0),(!_(e)||l(e))&&null!=t&&"boolean"!=typeof t&&(""===t||o===t.__proto__)},F=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return k(t).primitiveValue}};e.disableLogging=()=>{try{if(c())return window.xUtilsConfig?window.xUtilsConfig.logging="off":window.xUtilsConfig={logging:"off"},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig.logging="off":r.xUtilsConfig={logging:"off"},!0}catch(t){return!1}},e.resetLogging=()=>{try{if(c())return window.xUtilsConfig?window.xUtilsConfig.logging="on":window.xUtilsConfig={logging:"on"},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig.logging="on":r.xUtilsConfig={logging:"on"},!0}catch(t){return!1}},e.loggerSetting=function(t,e){if(void 0===t&&(t="log"),void 0===e&&(e="off"),!["log","warn","onerror","error","alert","attention","debug","stack","errorTrace"].includes(t)||!t)return!1;if(!["on","off"].includes(e)||!e)return!1;"onerror"===t&&(t="error");try{if(c())return window.xUtilsConfig?window.xUtilsConfig[t]=e:window.xUtilsConfig={[t]:e},!0}catch(t){}try{return r.xUtilsConfig?r.xUtilsConfig[t]=e:r.xUtilsConfig={[t]:e},!0}catch(t){return!1}},e.checkLoggerSetting=u,e.stack=function(t,e){if(void 0===e&&(e=!1),h()&&"off"!==u("stack")){var i=new Error(JSON.stringify(t)).stack.split("(");i.splice(1,1);var r=i[0].split(/\n/)[0].replace("Error","[STACK TRACE]");return i.splice(0,1),i.unshift(r),void(e?console.log(i):console.log.apply(null,i))}},e.errorTrace=function(t,e){if(void 0===e&&(e=!1),h()&&"off"!==u("errorTrace")){var i=new Error(JSON.stringify(t)).stack.split("(");i.splice(1,1);var r=i[0].split(/\n/)[0].replace("Error","[ERROR]");return i.splice(0,1),i.unshift(r),void(e?console.error(i):console.error.apply(null,i))}},e.loop=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=function(t){void 0===t&&(t=0)}),"function"!=typeof e||"number"!=typeof t)return[];for(var i,r=[],s=0;s<Array(t).length;s++){i=e.apply(this,[s]);try{if(i&&Object.entries(i).length&&i.break)break}catch(t){}r.push(i)}return r},e.isFalse=t=>{if(null===t)return!0;if(void 0===t)return!0;if("number"==typeof t&&1>t)return!0;if("boolean"==typeof t&&!1===t)return!0;try{if(t instanceof Boolean)return!1===t.valueOf()}catch(t){}return!1},e.isTrue=t=>{if(null===t)return!1;if(void 0===t)return!1;if("number"==typeof t&&0<t)return!0;if("boolean"==typeof t&&!0===t)return!0;try{if(t instanceof Boolean)return!0===t.valueOf()}catch(t){}return!1},e.isBoolean=D,e.isNull=P,e.isUndefined=w,e.isEmpty=t=>!j(t)&&!k(t).value,e.head=function(t){return void 0===t&&(t=[]),Array.prototype===(t||null).__proto__?t.flat().shift():void 0},e.last=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?t[t.length-1]:void 0},e.timer=function(t,e){if(void 0===t&&(t=()=>{}),void 0===e&&(e=0),"function"==typeof t){e="number"==typeof e&&0<=e?e:0;var i=setTimeout(()=>{t(),clearTimeout(i)},e)}},e.interval=function(t,e,i){if(void 0===t&&(t=()=>{}),void 0===e&&(e=0),void 0===i&&(i=0),"function"!=typeof t)return null;e="number"==typeof e&&0<=e?e:0,i="number"==typeof i&&0<=i?i:0;var r=0,s=setInterval(()=>(t(),i<=r?clearInterval(s):void(r+=e)),e)},e.sq=()=>{class t extends Promise{constructor(e){void 0===e&&(e=function(t,e){void 0===t&&(t=()=>{}),void 0===e&&(e=()=>{})}),t._promise=super(e)}resolve(e){var i=t._resolve;return i instanceof Function?i(e):y("[SimpleQ][resolve]","not callable"),this}reject(e){var i=t._reject;return i instanceof Function?i(e):y("[SimpleQ][reject]","not callable"),this}get promise(){var e=t._promise;return e instanceof Promise?e:void 0}}var e=new t((e,i)=>{t._resolve=e,t._reject=i});if(e.__proto__.entity="SimpleQ",e instanceof Promise&&e instanceof t)return e;throw"sq() not a valid Promise ?"},e.validID=function(t){return void 0===t&&(t=""),t?(t||"").toString().toLowerCase().replace(/\s/g,""):""},e.isBigInt=b,e.isNumber=O,e.stringSize=function(t){return void 0===t&&(t=""),null!=t&&t.__proto__===o?t.length:0},e.cancelPromise=t=>{var{defer:e={},checkEvery:i=500,maxWait:r=9500,cbErr:s=(t=>{var{error:e,defer:i,id:r}=t}),message:o="taken too long to respond",logging:n=!1,id:a}=t;if(!C(e)&&!x(e)||"function"!=typeof s||!r)return y("[cancelPromise]","{defer,maxWait,cbErr} must be provided"),Promise.reject("{defer,maxWait,cbErr} must be provided");var c,u=i||500;r=r||1;var h=0,l=setInterval(()=>{if(c)return clearInterval(l);if(h>r){var t={error:o+", time: "+h,defer:e,id:a};try{s.apply(t,[t]),e.reject(o+", time: "+h)}catch(t){y("[cancelPromise]",t)}return clearInterval(l)}n&&(a?p("-- processing: ",a):g("-- processing ")),h=u+h},u),d=t=>t.then(t=>(c=!0,t),t=>(c=!0,Promise.reject(t)));return $(e)||C(e)&&!x(e)?d(e):x(e)?d(e.promise):Promise.reject("[cancelPromise], Supplied {defer} is not a promise")},e.shuffle=function(t){var e=Math.floor;if(void 0===t&&(t=[]),!m(t))return[];for(var i=t.length-1;0<i;i--){var r=e(Math.random()*i),s=t[i];t[i]=t[r],t[r]=s}return t},e.selectiveArray=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=[]),!m(e))return[];if(!e.length)return[];if(!m(t))return e;if(!t.length)return e;t=I(t);for(var i,r=[],s=function t(e,i,r){var s;if(void 0===r&&(r=0),e&&m(e)&&e.length){try{if(void 0!==i[e[r]])return s=i[e[r]],e[++r]?t(e,s,r):s}catch(t){console.log(t.toString())}return s}},o=0;o<e.length;o++)if(i=e[o],S(i)){for(var n,a=void 0,c=[],u=0;u<t.length;u++){n=(t[u]||"").split(".");try{a=s(n,i,0),c.push(a)}catch(t){}}t.length===c.length&&c.filter(t=>void 0===t).length===t.length&&(c=c.filter(t=>!!t)),c.length?r.push([].concat(c)):void 0!==a&&r.push(a)}else r.push([i]);return r},e.hasPrototype=A,e.hasProto=function(t,e){if(void 0===e&&(e=void 0),_(e)&&!l(e))return!1;try{return void 0!==t.__proto__}catch(t){return!1}},e.objectSize=N,e.isString=B,e.isFunction=_,e.copyBy=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=[]),!S(t))return{};var i=[].concat(e).reduce((e,i)=>(void 0!==t[i]&&(e[i]=t[i]),e),{});try{return JSON.parse(JSON.stringify(i))}catch(t){return{}}},e.copyDeep=t=>{if(m(t))return t.map(t=>F(t));if(S(t))return Object.entries(t).reduce((t,e)=>{var[i,r]=e;return t[i]=S(r)?Object.assign({},F(r)):r,t},{});try{return JSON.parse(JSON.stringify(t))}catch(e){return k(t).primitiveValue}},e.delay=function(t){return void 0===t&&(t=100),"number"==typeof t&&0<=t?new Promise(e=>{var i=setTimeout(()=>{clearTimeout(i),e(!0)},t)}):Promise.resolve(!0)},e.someKeyMatch=function(t,e,i){if(void 0===t&&(t={}),void 0===e&&(e={}),void 0===i&&(i=void 0),_(i)&&!l(i))return!1;if(!t||Object.prototype!==t.__proto__)return!1;if(!e||Object.prototype!==e.__proto__)return!1;var r=Object.keys(t),s=Object.keys(e);return r.length>=s.length?0<r.filter(t=>s.filter(e=>e===t).length).length:0<s.filter(t=>r.filter(e=>e===t).length).length},e.exactKeyMatch=function(t,e,i){if(void 0===t&&(t={}),void 0===e&&(e={}),void 0===i&&(i=void 0),_(i)&&!l(i))return!1;if(!t||Object.prototype!==t.__proto__)return!1;if(!e||Object.prototype!==e.__proto__)return!1;var r=Object.keys(t),s=Object.keys(e);return r.length>=s.length?r.filter(t=>s.filter(e=>e===t).length).length===r.length:s.filter(t=>r.filter(e=>e===t).length).length===s.length},e.trueVal=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__?[].concat(t).filter(t=>!0!==E(t)):[]},e.trueValDeep=function(t){return void 0===t&&(t=[]),t&&Array.prototype===t.__proto__&&t.length?[].concat(t).map(t=>{var e=k(t,!1);return"array"===e.type&&0<e.value?t.map(t=>0<k(t,!1).value?t:null).filter(t=>!!t):"object"===e.type&&e.value?Object.entries(t).reduce((t,e)=>{var[i,r]=e;return 0<k(i,!1).value&&(t[i]=r),t},{}):0<e.value?t:null}).filter(t=>!!t):[]},e.trueProp=function(t){return void 0===t&&(t={}),t&&Object.prototype===t.__proto__?Object.entries(t).reduce((t,e)=>{var[i,r]=e;return E(r)||(t[i]=r),t},{}):{}},e.resolver=function(t,e,i){return void 0===t&&(t=()=>{}),void 0===e&&(e=5e3),void 0===i&&(i=50),"function"==typeof t?new Promise(r=>{var s,o=i||50,n=e,c=0,u=(s=a((function*(){try{return yield t()}catch(t){return j(t)?{error:t}:S(t)&&t.error?t:{error:t}}})),function(){return s.apply(this,arguments)}),h=setInterval(a((function*(){var t=u();if(t.catch(t=>t),c>=n)return(t||{}).resolve&&t.resolve(void 0),r(void 0),clearInterval(h);c+=o;try{c+=o;var e=yield t;if(e)return r(e),clearInterval(h)}catch(t){return j(t)&&r(t),S(t)&&t.error?r(t):r({error:t}),clearInterval(h)}})),o)}):Promise.reject("fn() must be callable")},e.flatten=function(t){return void 0===t&&(t=[]),m(t)?[].concat(...t):[]},e.flattenDeep=function(t){void 0===t&&(t=[]);var e=[];if(!m(t))return e;try{return(e=function t(e,i){return void 0===i&&(i=1),0<i?e.reduce((e,r)=>e.concat(Array.isArray(r)?t(r,i-1):r),[]):e.slice()}(t,1/0)||[])instanceof Array?e:[]}catch(t){return[]}},e.chunks=function(t,e){var i=Math.ceil;return void 0===t&&(t=[]),void 0===e&&(e=0),Array.from({length:i(t.length/e)},(i,r)=>t.slice(r*e,r*e+e))},e.dupes=function(t,e){void 0===e&&(e=0);for(var i=[],r=parseInt(e);0<r;)r--,i.push(t);return i},e.uniqBy=function(t,e){void 0===t&&(t=[]),void 0===e&&(e="");var i={},r=[];if(!e)return[];if(!(t||[]).length)return[];for(var s=function(s){var o=t[s];return w(o)||P(o)?(r.push(o),"continue"):S(o)&&o[e]?Object.entries(i).filter(t=>{var[r]=t;return o[e]===i[r]}).length?"continue":void(o[e]!==i[e+":"+s]&&(i[e+":"+s]=o[e],r.push(o))):(r.push(o),"continue")},o=0;o<t.length;o++)s(o);return r},e.arrayWith=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=""),!m(t))return[];try{var i=t.map(t=>(t=>S(t)?-1===Object.keys(t).indexOf(e)?void 0:t:void 0)(t)).filter(t=>!!t);return i instanceof Array?i:[]}catch(t){return[]}},e.exFromArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);try{if(!(t instanceof Array))return[]}catch(t){return[]}if(!(e=[].concat(e)).length)return t;try{var i=t.map(t=>function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=[]),!S(t))return t;var i=Object.entries(t).reduce((t,i)=>{var[r,s]=i;return-1===e.indexOf(r)&&(t[r]=s),t},{});return E(i)?void 0:i}(t,e));return i instanceof Array?i:[]}catch(t){return[]}},e.copy=F,e.uniq=I,e.isPromise=C,e.isQPromise=x,e.debug=function(){if(h()&&"off"!==u("debug")){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return d("debug",e)}},e.log=p,e.warn=f,e.onerror=y,e.error=v,e.alert=g,e.attention=function(){if(h()&&"off"!==u("attention")){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return d("attention",e)}},e.isObject=S,e.isFalsy=E,e.isError=j,e.typeCheck=k,e.validDate=function(t,e){if(void 0===e&&(e=void 0),_(e)&&!l(e))return!1;try{return t.__proto__===Date.prototype&&"Invalid Date"!==t.toString()}catch(t){return!1}},e.isInstance=L,e.isClass=A,e.isArray=m,e.pickFromArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);var i=[];try{if(!(t instanceof Array))return i}catch(t){return[]}if(m(e)||(e=[].concat(e)),!e.length)return t;var r=[void 0,null,!1];if(!(e=e.filter(t=>!E(t)||r.filter(e=>e===t||(O(t)&&!isNaN(t)).length))).length)return t;var s=(t,e)=>{if(m(t)&&_(e)){if("object"===e.name.toLowerCase())return!1;if("array"===e.name.toLowerCase())return!0}if(S(t)&&_(e)){if("array"===e.name.toLowerCase())return!1;if("object"===e.name.toLowerCase())return!0}try{return(e.name||"").toLowerCase()===typeof t}catch(t){}};try{return(i=t.reduce((t,i)=>((t=>{for(var i,r,o=0;o<e.length;o++){if(r=e[o],S(r)&&S(t)){var n=Object.entries(r),a=n.filter(e=>{var[i,r]=e;return!(t[i]!==r)||(void 0===t[i]?void 0:s(t[i],r))});if((a=a.length===n.length&&Object.entries(t).length>=a.length)&&N(t)>=N(r)){i=!0;break}}if(m(r)&&m(t)){var c=r.filter(e=>t.filter(t=>t===e||s(t,e)).length);if(c=c.length===r.length&&t.length>=c.length){i=!0;break}}else{if(r===t){i=!0;break}if(O(t)||D(t)||B(t)||m(t)||S(t)||_(t)){if(s(t,r)){i=!0;break}}else if(s(t,r)){i=!0;break}}}return i})(i)&&t.push(i),t),[]))instanceof Array?i:[]}catch(t){return[]}},e.dispatcher=function(t,e){return void 0===t&&(t=void 0),void 0===e&&(e=!1),new function(t,e){var i=this,r="[dispatcher]";this.uid=((t||"").toString()||(new Date).getTime()).toString(),this.debug=e,this.cbQueue={},this.dispatchInstance={},this._isActive=null,this._onComplete_cb=null,this.index=0,this.data=null,this.onComplete=t=>(this._onComplete_cb=t,this),this.initListener=()=>(this.Dispatch(),this._isActive=!0,this),this.next=function(t){return void 0===t&&(t=null),!1!==i._isActive&&i.initListener(),i.dispatchInstance[i.uid]?i.dispatchInstance[i.uid].next(t):i.debug&&p({message:r+" for uid not available",uid:i.uid}),i},this.Dispatch=()=>{if(this.dispatchInstance[this.uid])return this;var t=this;return this.dispatchInstance[this.uid]||(this.dispatchInstance[this.uid]=new function(){this.uid=t.uid,this.data=null,this.next=e=>("cb"!==(e||{}).type&&(this.data=e),"cb"===(e||{}).type?void("function"==typeof e.cb&&(!t.cbQueue[t.uid]&&(t.cbQueue[t.uid]=e.cb),this.data&&(t.index++,t.data=this.data,e.cb.call(t,this.data,t.uid,t.index)))):void(this.data?"function"==typeof t.cbQueue[t.uid]&&(t.index++,t.data=this.data,t.cbQueue[t.uid].call(t,this.data,t.uid,t.index)):t.debug&&f(r+" no callback data")))}),this},this.isActive=()=>this._isActive,this.del=()=>(delete this.cbQueue[this.uid],delete this.dispatchInstance[this.uid],this._isActive=!1,"function"==typeof this._onComplete_cb&&this._onComplete_cb(this.uid),this),this.subscribe=t=>"function"==typeof t?(this.dispatchInstance[this.uid]||this.Dispatch(),this.dispatchInstance[this.uid]&&this.dispatchInstance[this.uid].next({type:"cb",cb:t}),this):(this.debug&&f(r+"[subscribe] cb must be set"),this),this.init=this.initListener,this.sub=this.subscribe,this.emit=this.next,this.delete=this.del,this.unsubscribe=this.del}(t,e)},e.isSQ=$,e.withHoc=function(t){void 0===t&&(t=()=>{});for(var e=arguments.length,i=Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var s=i,o=function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var o=()=>s?[].concat(i,s):i;if(t instanceof Function)try{return t(...o())}catch(t){y("[HOC]",t)}else{if(C(t))return(t.promise?t.promise:t).then(t=>_(t)?t(...o()):Promise.reject("DEFERRED_NOT_CALLABLE"),t=>_(t)?Promise.reject(t(...o())):Promise.reject("DEFERRED_NOT_CALLABLE"));y("[HOC]","item() must be callable function")}};return o},e.isDate=t=>{try{return t instanceof Date}catch(t){return!1}},e.xrequire=function(e,i){if(void 0===e&&(e=""),void 0===i&&(i=""),!c()){var r=function(){};return(r.prototype=Object.create(t.constructor.prototype)).constructor=t.constructor,r.prototype.require=function(t,e){try{return this.constructor._load(t,this)}catch(t){if("ERR_NO_THROW"===e)return;if("MODULE_NOT_FOUND"===t.code)throw t}},r.prototype instanceof t.constructor?r.prototype.require(e,i):void 0}},e.asJson=t=>{try{return JSON.stringify(t,null,2)}catch(t){return"[asJson], "+t.toString()}},e.truthFul=function(t){return void 0===t&&(t={}),S(t)?Object.entries(t).reduce((t,e)=>{var[i,r]=e;return void 0!==r&&(t[i]=r),t},{}):{}},e.inIndex=function(t,e){void 0===t&&(t=""),void 0===e&&(e=[]);var i=0;return m(e)&&e.length?"string"!=typeof t?i:t?i=e.filter((e,i)=>((t,e,i)=>{try{return new RegExp(t).test(e)}catch(t){return y("[inIndex]","wrong pattern/expression at index:"+i),!1}})(e,t,i)).length:i:i},e.isRegExp=T,e.matched=function(t,e){void 0===t&&(t=""),void 0===e&&(e=/\\/);var i=!1;return B(t)&&T(e)?"string"!=typeof t?i:t?i=((t,e)=>{try{return new RegExp(t).test(e)}catch(t){return y("[matched]",t.toString()),!1}})(e,t):i:i}},o=[t,e],void 0===(n="function"==typeof(s=a)?s.apply(e,o):s)||(t.exports=n)}).call(this,i(4),i(5))},function(t,e){var i,r,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:n}catch(t){r=n}}();var c,u=[],h=!1,l=-1;function d(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&p())}function p(){if(!h){var t=a(d);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===n||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new f(t,e)),1!==u.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){const{uniqBy:r,isArray:s}=i(3);t.exports=class{constructor(t,e,i){this._dataBank=[],this.debug=i}set dataBank(t){if(s(t)){if(t.filter(t=>t.data_id).length)return}else if((t||{}).data_id)return;this._dataBank.push({data:t,data_id:(new Date).getTime().toString()}),this._dataBank=this._dataBank.filter(t=>void 0!==t.data)}get dataBank(){return r(this._dataBank||[],"data_id")}}},function(t,e,i){i(8),i(0),i(2),e.$computeCallBack=function(t,e){},e.readyOutput=t=>t,e.asPocket=t=>t,e.asProbe=t=>t},function(t,e){t.exports=function(){this.data=void 0,this.task="",this.id="",this.status="",this.error=void 0}},function(t,e){t.exports=function({data:t,status:e,ref:i,error:r,campaign:s}){this.data=t,this.status=e,this.ref=i,this.error=r,this.campaign=s,Object.entries(this).forEach(([t,e])=>{void 0===e&&delete this[t]})}},function(t,e,i){const{validID:r}=i(3);e.errorMessages=t=>{const e={};for(let[i,r]of Object.entries(t))e[i]={message:r[0],code:i};return e};const s=(t="")=>!new RegExp(/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi,"gi").test(t);e.validProjectID=(t="")=>{if(t&&!((t||"").split(" ").length>1)&&s(t))return t},e.validProbe=(t="")=>{if((t=r(t))&&s(t)&&-1!==t.indexOf("::"))return t},e.idRegexValid=s},function(t,e,i){const{validProjectID:r}=i(10),{objectSize:s,isFunction:o,onerror:n,warn:a,isString:c}=i(3),u=i(12),h=i(13);t.exports=class extends h{constructor(t,e){super(t,e),this.architectConfig={};const i=new u;this.architectMod=i.architect}setArchitect(t,e){return void 0===this.architectConfig[t]&&(this.architectConfig[t]=this.architectMod),this.architectConfig[t].value=Object.assign({},this.architectConfig[t].value,e),this}getArchitect(t){return(this.architectConfig[t]||{}).value}asset(t,e,i){if(!o(e))return this.debug&&a("[pocket]","[$asset] asCallback must be a function"),null;if("project"===t||"cache"===t)return void(this.debug&&a("[pocket]","[$asset] 'project, cache' are  restricted"));const s=this.lastProjectID(i);return i=r(s||i),this.getArchitect(i)?void 0!==this.getArchitect(i)[t]?e.call(this,this.getArchitect(i)[t]):(this.debug&&a("[pocket]","[$asset] assetName for architect doesnt exist"),null):(this.debug&&a("[pocket]","[$asset] architectConfig for assetName doesnt exist"),null)}architect(t,e){if(!o(t))return this.debug&&n("[pocket]","[$architect] callback must be set"),this;const i=t.call(this);if(!s(i))return this.debug&&n("[pocket]","[architect] must return a valid object settings {project, asset}, at least 1 is required"),this;const u=(i.project||{}).id,h=this.lastProjectID(e);if(!(e=r(h||e||u)))return this.debug&&n("[pocket]","[$architect] if this is a new project, you must specify projectID"),this;const l=Object.entries(i).reduce((t,[e,i])=>(-1!==["project","asset","cache"].indexOf(e)&&(t[e]=i),t),{});if((this.getArchitect(e)||{}).cache)l.cache=this.getArchitect(e).cache;else{const t={project:!1,asset:!1};l.cache||(l.cache=t),this.setArchitect(e,{cache:l.cache})}for(let t in l){const i=l[t],r=!0===l.cache[t]&&("project"===t||"asset"===t);if("project"===t){try{if(r&&this.getArchitect(e)[t])continue}catch(t){}this.setArchitect(e,{project:this.$payload(i,i.async,i.type).d})}if("asset"===t){if(!c(i.name)||void 0===i.value)return this.debug&&a("[pocket]","[$architect] asset must include {value, name}"),this;if("project"===i.name||"cache"===i.name)return this.debug&&a("[pocket]",'[$architect] asset props, "project, cache" are reserved'),this;try{if(r&&this.getArchitect(e)[i.name])continue}catch(t){}this.setArchitect(e,{[i.name]:i.value})}}return this}}},function(t,e,i){const{objectSize:r,log:s}=i(3);t.exports=function t(){this._architectVal=null,this.architect=Object.create(t.prototype,{value:{enumerable:!0,configurable:!0,get:()=>this._architectVal,set:t=>{r(t)&&(this._architectVal=t,s("[pocket]","[architect] updated"))}}})}},function(t,e,i){i(2),i(14);const{onerror:r,warn:s,isPromise:o,validID:n,isString:a}=i(3),c=i(16);t.exports=class extends c{constructor(t,e){super(t,e),this.$project=this.$payload}deletePocketSet(t){if(t){if(Object.values(this.pocket).length)for(let e of Object.values(this.pocket))this._$cached_data[e.id]&&delete this._$cached_data[e.id],e.id.includes(t)&&delete this.pocket[e.id];this.payloadData[t]&&delete this.payloadData[t],this._ready[t]&&delete this._ready[t],void 0!==this._projectSetDispatcher[t]&&delete this._projectSetDispatcher[t],this._projectSetAsync[t]&&delete this._projectSetAsync[t],this._lastFilterList[t]&&delete this._lastFilterList[t];try{this.architectConfig[t]&&delete this.architectConfig[t]}catch(t){}this.clearStoreTransfers(t)}}$removeProject(t){return t=a(t)?t:"",t=this.lastProjectID(t),this.deletePocketSet(t),this}$payload(t,e,i){const s=t=>(this.d=t,this),n=void 0!==e?e:this.async;return n&&o(t)?s(t.then(t=>this.payload(t,!1,i),t=>t)):n||o(t)?(this.debug&&r("[pocket]","[payload] with opts.async=true, data must be a promise, or do not set async when not a promise"),s(!!n&&Promise.reject())):s(this.payload(t,!1,i))}$ready(t,e=!1){try{const i=t=>(this.d=t,this.d&&!e&&this.d.catch(t=>{this.disableWarnings||s("[pocket]",t)}),this);let r=this.lastProjectID(t,!1,null);if(!t&&r&&(t=r),"complete"===this.projectsCache[t]&&!e)return i(Promise.reject(`[$ready] project: ${t} already complete`));if(void 0!==this._ready_method_set[t]&&!e){if(!0===this._ready_method_set[t])return i(Promise.reject(`[$ready] project: ${t} already complete, cannot recall same $ready, ALLOW_MULTIPLE_FALSE`));if(!1===this._ready_method_set[t])return i(Promise.reject(`[$ready] project: ${t} you already declared $ready somewhere else, this call is ignored, ALLOW_MULTIPLE_FALSE`))}if(!r)throw"payloadID must be set";const o=this.$projectSetAsync(r).then(({projectID:t})=>this.ready(t).then(e=>(this.deleteWithDelay?setTimeout(()=>{this.deletePocketSet(t)},this.deleteWithDelay):this.deletePocketSet(t),this.projectsCache[t]="complete",this._ready_method_set[r]=!0,e),Promise.reject),Promise.reject);return this._ready_method_set[r]=!1,i(o)}catch(t){this.disableWarnings||r("[pocket]",t)}}}},function(t,e,i){const r=i(15),{validProjectID:s}=i(10),{isArray:o,isString:n}=i(3);t.exports=function({id:t="",tasks:e=[]}){if(!t||!n(t)||!s(t))throw"ProjectPayloadModel/invalid id provided";if(!o(e)||!(e||[]).length)throw"ProjectPayloadModel/invalid tasks[] provided";this.id=t,this.tasks=e.map(t=>new r(t))}},function(t,e){t.exports=function({id:t,ref:e,task:i,campaign:r,data:s}){this.id=t,this.ref=e,this.task=i,this.campaign=r,this.data=s,Object.entries(this).forEach(([t,e])=>{void 0===e&&delete this[t]})}},function(t,e,i){const r=i(14),s=i(9),{idRegexValid:o}=(i(2),i(10)),{sq:n,objectSize:a,log:c,onerror:u,warn:h,isObject:l,validID:d}=i(3),p=i(17);t.exports=class extends p{constructor(t,e){super(t,e),this.dispatcher&&this.dispatcher.subscribe((t,e)=>{const{probe:i,status:r}=t||{};"error"===r&&this.debug&&c("[pocket]",`[dispatcher] probe id:${i.id} error`),"open"===r&&this.debug&&c("[pocket]",`[dispatcher] probe id:${i.id} created`),"complete"===r&&this.debug&&c("[pocket]",`[dispatcher] probe id:${i.id} completed`)})}payload(t,e,i="new"){try{t=new r(t)}catch(t){return u("[payload]",t),!1}this.d=null;let s=null;if(this.payloadData[t.id]&&(!i||"new"===i))return this._lastProjectID=t.id,!0;let n=void 0===this.payloadData[t.id];(this._lastFilterList[t.id]||[]).length&&(this._lastFilterList[t.id]=[]);for(let e of t.tasks){if(!e.task){this.debug&&h("[pocket]","[$payload] task must be set for your tasks");continue}if(!o(e.task)||-1!==e.task.indexOf("::")){this.debug&&h("[pocket]","[$payload] invalid taskName, failed idRegexValid validation");continue}const r=`${t.id}::${e.task}`;"update"!==i||n||!this.pocket[r]?(this.payloadData[t.id]||(this.payloadData[t.id]={value:[],status:"open",timestamp:(new Date).getTime()}),this.payloadData[t.id].value.filter(t=>-1!==t.task.indexOf(e.task)).length?this.debug&&!this.disableWarnings&&h("[pocket]",`the same task "${e.task}" already exists on the payload, you must choose uniq`):(this.payloadData[t.id].value.push(e),this.lastPocketTimestamp=this.payloadData[t.id].timestamp)):(e.data&&(this.pocket[r].data=e.data),e.status&&(this.pocket[r].status=e.status),!e.status&&e.data&&"open"===this.pocket[r].status&&(this.pocket[r].status="updated"),e.ref&&(this.pocket[r].ref=e.ref),e.error&&(this.pocket[r].error=e.error),e.campaign&&(this.pocket[r].campaign=e.campaign),s=!0,this._lastProjectID=t.id)}return"update"===i&&this.payloadData[t.id]&&!n?(this.projectsCache[t.id]="open",s):!!this.payloadData[t.id]&&(this.lastProjectID(t.id),this.projectsCache[t.id]="open",this.distributor().setDefer(t.id),this.projectSetDispatcher(t.id).next({projectID:t.id}),!0)}$projectSetAsync(t=""){const e=this;return t=this.lastProjectID(t,!1,null),this._projectSetAsync[t]||(this._projectSetAsync[t]=n(),this.projectSetDispatcher(t).subscribe((function(t,i){e._projectSetAsync[i].resolve(t),this.del()}))),this._projectSetAsync[t].promise}probeStatusAsync(t=""){return(t=>(this.d=t,this))((t=this.lastProbeID(t))?this.pocket[t].getStatusAsync:null)}update(t,e=null,i){return this._setUpdate(t,e,i,"update")}_set(t,e){return this._setUpdate(t,null,e,"set")}_get(t="",e){return this.d=null,(t=>(this.d=t,e?this:this.d))((t=this.lastProbeID(t))?this.pocket[t]:null)}$activeTasks(t=""){const e=t=>(this.d=t,this);return t=this.lastProjectID(t),a(this.pocket)?e(Object.entries(this.pocket).reduce((e,[i,r])=>(0===i.indexOf(t||"")&&t&&this.payloadData[t]?e.push(r.task):t||e.push(r.task),e),[])):e([])}ready(t=""){if(this.d=null,!this._ready[t])throw"ready[payloadID] is not set, maybe you called it before $payload()";return this._ready[t].promise}_setUpdate(t,e=null,i="",r="update"){t=new s(t);const o=t=>(this.d=t,this);let n=this.lastProbeID(i);if(!n)return this.debug&&u("[pocket]","[$update] must specify id"),o(!1);if(!a(t))return this.debug&&h("[pocket]","[$update] dataFrom{} must not be empty"),o(!1);if(!this.pocket[n])return this.debug&&u("[pocket]",`[$update] this.pocket with id:${n} not found`),o(!1);let c=!1;this._lastProjectID=n;let l=Object.entries(t).reduce((t,[e,i])=>{const r=this.probeProps.indexOf(e);return this.probeProps[r]===e&&t.push({inx:r,data:{[e]:i}}),t},[]);for(let t=0;t<l.length;t++){if(void 0===(l[t]||{}).data)continue;const[i,r]=Object.entries(l[t].data)[0];void 0===this.pocket[n][i]?this.debug&&h("[pocket]",`[$update] not a valid prop/value: { ${i}:${this.pocket[n][i]} }`):("data"===i&&(this.pocket[n][i]=!0===e?Object.assign({},this.pocket[n][i],r):r),"status"!==i&&"ref"!==i&&"error"!==i&&"campaign"!==i||(this.pocket[n][i]=r),c=!0)}return c&&"set"===r&&(this.clearStoreTransfers(n),this.$transfer_lastID===n&&(this.$transfer_lastID=""),this._$cached_data[n]&&delete this._$cached_data[n]),o(c)}setDefer(t){if(!(t=d(t)))throw"id must be set";if(this._ready[t]||(this._ready[t]=n()),!a(this.pocket)){const e="[setDefer] probe is empty, so nothing set, id:"+t;return this.debug&&u("[pocket]",e),void this._ready[t].reject(e)}const e=Object.values(this.pocket).filter(e=>-1!==e.id.indexOf(t));if(!e.length){const e=`[setDefer] no pocketSet found for id:${t} `;return this.debug&&u("[pocket]",e),void this._ready[t].reject(e)}try{const i=t=>{const e={};if(!l(t))return null;for(let i=0;i<this.probeProps.length;i++){const r=this.probeProps[i];void 0!==t[r]&&null!==t[r]&&(e[r]=t[r])}return e};return Promise.all(e.map(t=>t.sq.promise)).then(e=>{const r=e.map(t=>i(t.probe)).filter(t=>!!t);this._ready[t].resolve(r)},t=>{u("[pocket]","[setDefer] Promise.all",t)}),!0}catch(t){u("[pocket]","[setDefer]",t)}return!1}distributor(){for(let[t,e]of Object.entries(this.payloadData))if(!(this.lastPocketTimestamp>e.timestamp)&&"complete"!==e.status&&"send"!==e.status&&"error"!==e.status)for(let i of e.value.values()){const e={id:t,...i};this.setProbe(e)||u("[pocket]",`probe for id:${t} already exists`)}return this}setProbe(t={}){if(!t.id||!t.task)throw"id and task both must be set";if(!d(t.id))throw"props.id not valid";const e=`${t.id}::${t.task}`;if(this.pocket[e])return this.debug&&c("[pocket]",`[setProbe] probe: ${e} already set`),null;try{t.id=e;const i=null!==this.dispatcher?this._emit.bind(this):null;let r={withDataBank:this.withDataBank,disableWarnings:this.disableWarnings,onChange:this._onChange,emitter:i,completeOnNull:this.completeOnNull};const s=new(0,this.Probe)(t,r,this.debug);this.pocket[e]=s}catch(t){return u("[pocket]",t),null}return this.pocket[e]}_emit(t){if(!t)return null;if(!this.dispatcher)return!1;try{return this.dispatcher.next(t),!0}catch(t){return u("[pocket]","[_emit] dispatcher did not emit"),!1}}}},function(t,e,i){const{objectSize:r,warn:s,onerror:o,dispatcher:n,validID:a,copy:c,log:u,isString:h}=i(3),l=i(18),{validProbe:d,validProjectID:p,idRegexValid:f}=i(10);t.exports=class extends l{constructor(t,e){super(),this.debug=e||!1,this.async=(t||{}).async||null,this._onChange=(t||{}).onChange||null,this.completeOnNull=(t||{}).completeOnNull||null,this.disableWarnings=(t||{}).disableWarnings,this.withDataBank=(t||{}).withDataBank||!1,this.dispatcher=(t||{}).dispatcher?n():void 0,this.pocket={},this.payloadData={},this.lastPocketTimestamp=0,this._lastProjectID=null,this._lastProbeID=null,this._$cached_data={},this.$transfer_lastID="",this._ready={},this._ready_method_set={},this.d=void 0,this._projectSet={},this._transferCached=[],this._projectSetDispatcher={},this._projectSetAsync={},this._lastFilterList={},this.projectsCache={},this.deleteWithDelay=(t||{}).deleteWithDelay||1e3}projectSetDispatcher(t){return t?(this._projectSetDispatcher[t]||this._projectSetDispatcher[t]||(this._projectSetDispatcher[t]=n(t)),this._projectSetDispatcher[t]):(this.debug&&o("[projectSetDispatcher] projectID must be set"),null)}projectProbeList(t){return t?Object.entries(this.pocket).filter(([e])=>0===e.indexOf(t)).map(([t,e])=>e):[]}clearStoreTransfers(t=""){if(!t)return;let e=!1;return this._transferCached.length&&this._transferCached.forEach((i,r)=>{const{fromProbeID:s}=i||{};s&&-1!==s.indexOf(t)&&(this._transferCached.splice(r,1),e=!0,this.debug&&u("[pocket]",`[clearStoreTransfers] transferCached for probeID: ${s} has been removed`))}),e}storeTransfers(t,e){return this._transferCached.push({timestamp:(new Date).getTime(),fromProbeID:t,data:e}),this._transferCached}accessLastValidTransfer(t=100){if(!this._transferCached.length)return{};this._transferCached.sort((t,e)=>t.timestamp-e.timestamp);const e=c(this._transferCached).reduce((e,i,r)=>{const{timestamp:s}=i,o=(new Date).getTime()+t;return o>s&&o-s-t<=t&&(e=i,this._transferCached.splice(r,1)),e},{});return r(e)?e:{}}selectByTask(t="",e=null){if(t=h(t)?t:"",!f(t)&&t)return null;if(t.indexOf(":")>0&&!this.pocket[t])return this.debug&&s("[pocket]","[selectByTask] when using '::' prefix selector, it should come at 0 index"),null;if(t.split(":").length>3||2===t.split(":").length)return this.debug&&s("[pocket]",`[selectByTask] wrong taskName :${t}, allowed prefix is '::taskName'`),null;if(e&&this.lastProbeID(t,!0),this.pocket[t])return e&&this.lastProbeID(t),t;const i=(t=>{const e=t.split("::")[1]||t;return(this._lastProbeID||"").indexOf(e)>0&&e?this._lastProbeID:this._lastProjectID&&e?this._lastProjectID+"::"+e:this._lastProbeID})(t);return i?e&&this.lastProbeID(i):this.debug&&s("[pocket]","[selectByTask] newProbeID was not found from taskOrProbeID: "+t),i}lastProjectID(t="",e=null,i="strict"){return!t&&this._lastProjectID&&(t=this._lastProjectID),t&&(t=p(t)),t&&this.payloadData[t]&&(this._lastProjectID=t),(this.payloadData[t]||"strict"!==i)&&t?(t&&!this._lastProjectID&&(this._lastProjectID=t),t):null}lastProbeID(t="",e=null){return!t&&this._lastProbeID&&(t=this._lastProbeID),t&&(t=d(t)),t&&this.pocket[t]&&(this._lastProbeID=t),t&&this.pocket[t]?t:null}dataPropSelector(t="data()",e="",i={},o=!1,n={}){let a;try{return a=Object.entries(i).reduce((t,[e,i],r)=>(void 0!==n[e]&&(t[e]=n[e]),t),{}),r(a)||(a=void 0),r(a)+r(i)===2&&(a=Object.values(a).shift()),"data()"===t&&(this._$cached_data[e]=a),o?this:a}catch(i){return this.debug&&s("[pocket]","[$data] no dataProp found on probeID: "+e),"data()"===t&&(this._$cached_data[e]=a),o?this:a}}get probeProps(){return["campaign","data","task","ref","error","id","status"]}}},function(t,e,i){t.exports=class{get Probe(){return i(2)}}}]);