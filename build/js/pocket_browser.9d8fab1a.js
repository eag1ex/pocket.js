!function(t,e){for(var r in e)t[r]=e[r]}(window,function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}e.uniq=function(t){return t.filter((function(t,e,r){return r.indexOf(t)===e}))},e.objectSize=function(t){return t&&Object.prototype===t.__proto__?Object.entries(t).length:0},e.last=function(t){return t&&Array.prototype===t.__proto__?t[t.length-1]:null},e.copyBy=function(t,e){return e.reduce((function(e,r,n){return void 0!==t[r]&&(e[r]=t[r]),e}),{})},e.validID=function(t){return t?(t||"").toString().toLowerCase():null},e.isNumber=function(t){return void 0!==t&&t.__proto__===Number.prototype},e.isPromise=function(t){return Promise.prototype===(t||{}).__proto__},e.uniq=function(t){return t.filter((function(t,e,r){return r.indexOf(t)===e}))},e.isObject=function(t){return!!t&&(Object.prototype===t.__proto__||t instanceof Object)},e.isArray=function(t){return!!t&&Array.prototype===t.__proto__},e.isString=function(t){return!!t&&String.prototype===t.__proto__},e.isFunction=function(t){return"function"==typeof t},e.copy=function(t){if(!t)return t;try{return JSON.parse(JSON.stringify(t))}catch(t){return t.toString()}},e.errorMessages=function(t){for(var e={},r=0,i=Object.entries(t);r<i.length;r++){var a=(c=i[r],u=2,function(t){if(Array.isArray(t))return t}(c)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(c,u)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(c,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],s=a[1];e[o]={message:s[0],code:o}}var c,u;return e},e.log=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e=[].concat("[Pocket]",e),console.log.apply(null,e)},e.warn=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e=[].concat("[warning]",e),console.warn.apply(null,e)},e.onerror=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e=[].concat("[error]",e),console.log("  "),console.error.apply(null,e),console.log("  ")}},function(t,e,r){t.exports=r(5)},function(t,e){t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new function(){var r=this,n="[dispatcher]";this.uid=(t||"").toString()||(new Date).getTime(),this.debug=e,this.cbQueue={},this.dispatchInstance={},this.initListener=function(){return r.Dispatch(),r},this.next=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r.dispatchInstance[r.uid]?r.dispatchInstance[r.uid].next(t):r.debug&&console.log({message:"".concat(n," for uid not available"),uid:r.uid}),r},this.Dispatch=function(){if(r.dispatchInstance[r.uid])return r;var t=r;return r.dispatchInstance[r.uid]||(r.dispatchInstance[r.uid]=new function(){var e=this;this.uid=t.uid,this.data=null,this.next=function(r){"cb"!==(r||{}).type&&(e.data=r),"cb"!==(r||{}).type?e.data?"function"==typeof t.cbQueue[t.uid]&&t.cbQueue[t.uid].call(t,e.data,t.uid):e.debug&&console.log("".concat(n," no callback data")):"function"==typeof r.cb&&(t.cbQueue[t.uid]||(t.cbQueue[t.uid]=r.cb),e.data&&r.cb.call(t,e.data,t.uid))}}),r},this.del=function(){return delete r.cbQueue[r.uid],delete r.dispatchInstance[r.uid],!r.cbQueue[r.uid]&&r.dispatchInstance[r.uid],r},this.subscribe=function(t){return"function"==typeof t?(r.dispatchInstance[r.uid]||r.Dispatch(),r.dispatchInstance[r.uid]&&r.dispatchInstance[r.uid].next({type:"cb",cb:t}),r):(r.debug&&console.log("".concat(n,"[batchReady] cb must be set")),r)}}(t,e)}},function(t,e,r){window.Pocket=function(){return r(4).PocketModule()}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e,r){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=l(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function l(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,r){return e&&f(t.prototype,e),r&&f(t,r),t}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");var r,n;t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&(r=t,n=e,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(r,n))}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g(t);if(e){var i=g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return b(this,r)}}function b(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}e.PocketModule=function(){var t=r(0),e=t.objectSize,n=t.log,a=t.onerror,l=t.warn,h=t.isArray,f=t.isObject,b=t.isPromise,m=t.validID,k=t.isString,_=r(1),j=r(6)(),P=r(8).Probe,D=function(t){y(r,t);var e=v(r);function r(t,n){return d(this,r),e.call(this,t,n)}return p(r,[{key:"$removeProject",value:function(t){return t=k(t)?t:"",t=this.lastProjectID(t),this.deletePocketSet(t),this}},{key:"$payload",value:function(t,e,n){var o=this,s=function(t){return o.d=t,o},c=void 0!==e?e:this.async;return c&&b(t)?s(t.then((function(t){return i(g(r.prototype),"$payload",o).call(o,t,!1,n)}),(function(t){return t}))):c||b(t)?(this.debug&&a("[payload] with opts.async=true, data must be a promise, or do not set async when not a promise"),s(!!c&&Promise.reject())):s(i(g(r.prototype),"$payload",this).call(this,t,!1,n))}},{key:"$project",value:function(){return this.$payload.apply(this,arguments)}},{key:"$ready",value:function(t){var e,n=this;return this._$ready_resolved?Promise.reject("$ready already resolved"):(this._$ready_resolved=!1,e=this.$projectSetAsync(t).then((function(t){var e=t.projectID;return i(g(r.prototype),"$ready",n).call(n,e).then((function(t){return n.deletePocketSet(e),n._$ready_resolved=!0,t}),(function(t){return Promise.reject(t)}))}),(function(t){return Promise.reject(t)})),n.d=e,n)}}]),r}(function(t){y(i,t);var r=v(i);function i(t,e){var a;return d(this,i),(a=r.call(this,t,e)).dispatcher&&a.dispatcher.initListener().subscribe((function(t,e){var r=t||{},i=r.probe,o=r.status;"error"===o&&a.debug&&n("[dispatcher] probe id:".concat(i.id," error")),"open"===o&&a.debug&&n("[dispatcher] probe id:".concat(i.id," created")),"complete"===o&&a.debug&&n("[dispatcher] probe id:".concat(i.id," completed"))})),a}return p(i,[{key:"$payload",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"new";this.d=null;var n=null;if(!f(e))return!1;var i=Object.keys(e);if(i.every((function(t){return-1===["id","tasks"].indexOf(t)})))return this.debug&&a("[$payload] id and tasks are required"),!1;if(!h(e.tasks))return this.debug&&a("[$payload] data.tasks must be an array"),!1;if(e.id=this.validProjectID(e.id),!e.id)return this.debug&&a("[$payload] data.id invalid"),!1;if(this.payloadData[e.id]&&(!r||"new"===r))return!0;var o,s=void 0===this.payloadData[e.id],c=u(e.tasks.values());try{var d=function(){var i=o.value;return i.task?t.idRegexValid(i.task)&&-1===i.task.indexOf("::")?"update"!==r||s?(t.payloadData[e.id]||(t.payloadData[e.id]={value:[],status:"open",timestamp:(new Date).getTime()}),t.payloadData[e.id].value.filter((function(t){return-1!==t.task.indexOf(i.task)})).length?(t.debug&&l('the same task "'.concat(i.task,'" already exists on the payload, you must choose uniq')),"continue"):(t.payloadData[e.id].value.push(i),void(t.lastPocketTimestamp=t.payloadData[e.id].timestamp))):(i.data&&t.$update({data:i.data},!1,"::".concat(i.task)),i.status&&t.$update({status:i.status},!1,"::".concat(i.task)),i.ref&&t.$update({ref:i.ref},!1,"::".concat(i.task)),i.error&&t.$update({error:i.error},!1,"::".concat(i.task)),t.$status("::".concat(i.task))&&(n=!0),"continue"):(t.debug&&l("[$payload] invalid taskName, failed idRegexValid validation"),"continue"):(t.debug&&l("[$payload] task must be set for your tasks"),"continue")};for(c.s();!(o=c.n()).done;)d()}catch(t){c.e(t)}finally{c.f()}return"update"===r&&this.payloadData[e.id]&&!s?n:!!this.payloadData[e.id]&&(this.lastProjectID(e.id),this.distributor().setDefer(e.id),this.projectSetDispatcher(e.id).initListener().next({projectID:e.id}),!0)}},{key:"$projectSetAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;return this._projectSetAsync[t]||(this._projectSetAsync[t]=_(),this.projectSetDispatcher(t).initListener().subscribe((function(t,r){e._projectSetAsync[r].resolve(t),this.del()}))),this._projectSetAsync[t].promise()}},{key:"$projectSet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.validProjectID(t),!!this.payloadData[t]}},{key:"$probeStatusAsync",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=function(e){return t.d=e,t};return r((e=this.lastProbeID(e))?this.pocket[e].getStatusAsync:null)}},{key:"$get",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e){return t.d=e,r?t:t.d};return this.d=null,n((e=this.lastProbeID(e))?this.pocket[e]:null)}},{key:"$update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this._setUpdate(t,e,r,"update")}},{key:"$set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._setUpdate(t,null,e,"set")}},{key:"$activeTasks",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=function(e){return t.d=e,t};if(r=this.lastProjectID(r),!e(this.pocket))return n([]);var i=Object.entries(this.pocket).reduce((function(e,n){var i=c(n,2),a=i[0],o=i[1];return 0===a.indexOf(r||"")&&r&&t.payloadData[r]?e.push(o.task):r||e.push(o.task),e}),[]);return n(i)}},{key:"$ready",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.d=null,!(t=this.lastProjectID(t)))throw"payloadID must be set";if(!this._ready[t])throw"ready[payloadID] is not set, maybe you called it before $payload()";return this._ready[t].promise()}},{key:"_setUpdate",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update",o=function(t){return e.d=t,e},u=this.lastProbeID(n);if(!u)return this.debug&&a("[$update] must specify id"),o(!1);if(!f(t))return this.debug&&l("[$update] dataFrom must be an "),o(!1);if(!this.pocket[u])return this.debug&&a("[$update] this.pocket with id:".concat(u," not found")),o(!1);var h=!1;t=Object.entries(t).reduce((function(t,r){var n=c(r,2),i=n[0],a=n[1],o=e.probeProps.indexOf(i);return e.probeProps[o]===i&&t.push({inx:o,data:s({},i,a)}),t}),[]);for(var d=0;d<t.length;d++)if(void 0!==(t[d]||{}).data){var p=c(Object.entries(t[d].data)[0],2),y=p[0],v=p[1];void 0===this.pocket[u][y]?this.debug&&l("[$update] not a valid prop/value: { ".concat(y,":").concat(this.pocket[u][y]," }")):("data"===y&&(this.pocket[u][y]=!0===r?Object.assign({},this.pocket[u][y],v):v),"status"!==y&&"ref"!==y&&"error"!==y||(this.pocket[u][y]=v),h=!0)}return h&&"set"===i&&(this.clearStoreTransfers(u),this.$transfer_lastID===u&&(this.$transfer_lastID=""),this._$cached_data[u]&&delete this._$cached_data[u]),o(h)}},{key:"setDefer",value:function(t){var r=this;if(!(t=m(t)))throw"id must be set";if(this._ready[t]||(this._ready[t]=_()),!e(this.pocket)){var n="[setDefer] probe is empty, so nothing set, id:".concat(t);return this.debug&&a(n),this._ready[t].reject(n),null}var i=Object.values(this.pocket).filter((function(e){return-1!==e.id.indexOf(t)}));if(!i.length){var o="[setDefer] no pocketSet found for id:".concat(t," ");return this.debug&&a(o),this._ready[t].reject(o),null}try{return Promise.all(i.map((function(t){return t.sq.promise()}))).then((function(e){var n=e.map((function(t){return function(t){var e={};if(!f(t))return null;for(var n=0;n<r.probeProps.length;n++){var i=r.probeProps[n];t[i]&&(e[i]=t[i])}return e}(t.probe)})).filter((function(t){return!!t}));r._ready[t].resolve(n)}),(function(t){a("[setDefer] Promise.all",t)})),!0}catch(t){a("[setDefer]",t)}return!1}},{key:"distributor",value:function(){for(var t=0,e=Object.entries(this.payloadData);t<e.length;t++){var r=c(e[t],2),n=r[0],i=r[1];if(!(this.lastPocketTimestamp>i.timestamp)&&"complete"!==i.status&&"send"!==i.status&&"error"!==i.status){var s,l=u(i.value.values());try{for(l.s();!(s=l.n()).done;){var h=o({id:n},s.value);this.setProbe(h)||a("probe for id:".concat(n," already exists"))}}catch(t){l.e(t)}finally{l.f()}}}return this}},{key:"setProbe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.id||!t.task)throw"id and task both must be set";if(!m(t.id))throw"opts.id not valid";var e="".concat(t.id,"::").concat(t.task);if(this.pocket[e])return this.debug&&n("[setProbe] probe: ".concat(e," already set")),null;try{t.id=e;var r=null!==this.dispatcher?this._emit.bind(this):null,i=new this.Probe(t,r,this.debug);this.pocket[e]=i}catch(t){return a(t),null}return this.pocket[e]}},{key:"_emit",value:function(t){if(!t)return null;if(!this.dispatcher)return null;try{return this.dispatcher.initListener().next(t),!0}catch(t){return a("[_emit] dispatcher did not emit"),null}}},{key:"deletePocketSet",value:function(t){if(t){if(Object.values(this.pocket).length)for(var e=0,r=Object.values(this.pocket);e<r.length;e++){var n=r[e];this._$cached_data[n.id]&&delete this._$cached_data[n.id],n.id.includes(t)&&delete this.pocket[n.id]}this.payloadData[t]&&delete this.payloadData[t],this._ready[t]&&delete this._ready[t],void 0!==this._projectSetDispatcher[t]&&delete this._projectSetDispatcher[t],this._projectSetAsync[t]&&delete this._projectSetAsync[t],this._lastFilterList[t]&&delete this._lastFilterList[t];try{this.architectConfig[t]&&delete this.architectConfig[t]}catch(t){}this.clearStoreTransfers(t)}}},{key:"Probe",get:function(){return P()}}]),i}(j));return r(9)(D)}},function(t,e){t.exports=function(){return new function(){const t={};let e=null;const r=new Promise((e,r)=>{t.resolve=e,t.reject=r});this.resolve=(r=null)=>(e||(t.resolve(r),e=!0),this),this.reject=(r=null)=>(e||(t.reject(r),e=!0),this),this.promise=()=>r}}},function(t,e,r){function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(){var t=r(0),e=t.objectSize,i=t.warn,s=t.onerror,c=t.validID,u=t.copy,l=t.log,h=t.isString;return function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;a(this,t),this.debug=n||!1,this.async=(e||{}).async||null,this.architect=(e||{}).architect||null,this.dispatcher=(e||{}).dispatcher?r(2)():null,this.pocket={},this.payloadData={},this.lastPocketTimestamp=0,this._lastProjectID=null,this._lastProbeID=null,this._$cached_data={},this.$transfer_lastID="",this._ready={},this.d=void 0,this._projectSet={},this._transferCached=[],this._projectSetDispatcher={},this._projectSetAsync={},this._lastFilterList={},this.createArchitect()}var d,f;return d=t,(f=[{key:"createArchitect",value:function(){if(this.architect&&!this.architect_set){try{var t=r(7)();t.prototype=Object.create(this),t.prototype.constructor=t,Object.assign(this,new t)}catch(t){console.log("[createArchitect] error",t)}this.architect_set=!0}}},{key:"projectSetDispatcher",value:function(t){return t?(this._projectSetDispatcher[t]||this._projectSetDispatcher[t]||(this._projectSetDispatcher[t]=r(2)(t)),this._projectSetDispatcher[t]):(this.debug&&s("[projectSetDispatcher] projectID must be set"),null)}},{key:"projectProbeList",value:function(t){return Object.entries(this.pocket).filter((function(e){var r=n(e,2),i=r[0];return r[1],0===i.indexOf(t)})).map((function(t){var e=n(t,2);return e[0],e[1]}))}},{key:"clearStoreTransfers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var r=!1;return this._transferCached.length&&this._transferCached.forEach((function(n,i){var a=(n||{}).fromProbeID;a&&-1!==a.indexOf(e)&&(t._transferCached.splice(i,1),r=!0,t.debug&&l("[clearStoreTransfers] transferCached for probeID: ".concat(a," has been removed")))})),r}}},{key:"storeTransfers",value:function(t,e){return this._transferCached.push({timestamp:(new Date).getTime(),fromProbeID:t,data:e}),this._transferCached}},{key:"accessLastValidTransfer",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!this._transferCached.length)return{};this._transferCached.sort((function(t,e){return t.timestamp-e.timestamp}));var n=u(this._transferCached),i=n.reduce((function(e,n,i){var a=n.timestamp,o=(new Date).getTime()+r;return o>a&&o-a-r<=r&&(e=n,t._transferCached.splice(i,1)),e}),{});return e(i)?i:{}}},{key:"selectByTask",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e=h(e)?e:"",!this.idRegexValid(e)&&e)return null;if(e.indexOf(":")>0&&!this.pocket[e])return this.debug&&i("[selectByTask] when using '::' prefix selector, it should come at 0 index"),null;if(e.split(":").length>3||2===e.split(":").length)return this.debug&&i("[selectByTask] wrong taskName :".concat(e,", allowed prefix is '::taskName'")),null;if(r&&this.lastProbeID(e,!0),this.pocket[e])return r&&this.lastProbeID(e),e;var n=function(e){var r=e.split("::")[1]||e;return(t._lastProbeID||"").indexOf(r)>0&&r?t._lastProbeID:t._lastProjectID&&r?t._lastProjectID+"::"+r:t._lastProbeID},a=n(e);return a?r&&this.lastProbeID(a):this.debug&&i("[selectByTask] newProbeID was not found from taskOrProbeID: ".concat(e)),a}},{key:"lastProjectID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t&&this._lastProjectID&&(t=this._lastProjectID),t&&(t=this.validProjectID(t,e)),t&&this.payloadData[t]&&(this._lastProjectID=t),this.payloadData[t]&&t||null}},{key:"lastProbeID",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!t&&this._lastProbeID&&(t=this._lastProbeID),t&&(t=this.validProbe(t,e)),t&&this.pocket[t]&&(this._lastProbeID=t),t&&this.pocket[t]?t:null}},{key:"validProjectID",value:function(t){return(t=c(t))?(t||"").split(" ").length>1?null:this.idRegexValid(t)?t:null:null}},{key:"validProbe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(t=c(t))?this.idRegexValid(t)?-1===t.indexOf("::")?null:this.pocket[t]?t:(this.debug&&null===e&&i("[get] did not find probe with probeID ".concat(t)),null):void 0:null}},{key:"dataPropSelector",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data()",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{return t=Object.entries(o).reduce((function(t,e,r){var i=n(e,2),a=i[0];return i[1],void 0!==c[a]&&(t[a]=c[a]),t}),{}),e(t)||(t=void 0),e(t)+e(o)===2&&(t=Object.values(t).shift()),"data()"===r&&(this._$cached_data[a]=t),s?this:t}catch(e){return this.debug&&i("[$data] no dataProp found on probeID: ".concat(a)),"data()"===r&&(this._$cached_data[a]=t),s?this:t}}},{key:"idRegexValid",value:function(t){return!new RegExp(/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi,"gi").test(t)||null}},{key:"probeProps",get:function(){return["compaign","data","task","ref","error","id","status"]}}])&&o(d.prototype,f),t}()}},function(t,e,r){function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}t.exports=function(){var t=r(0),e=t.objectSize,i=t.isFunction,a=t.onerror,o=t.warn,s=t.log;function c(){var t=this;this._architectVal=null,this.architect=Object.create(c.prototype,{value:{enumerable:!0,configurable:!0,get:function(){return t._architectVal},set:function(r){e(r)&&(t._architectVal=r,s("[architect] updated"))}}})}return function(){var t=this;this.architectConfig={};var r=new c;this.architect=r.architect,this.setArchitect=function(e,r){return void 0===t.architectConfig[e]&&(t.architectConfig[e]=t.architect),t.architectConfig[e].value=Object.assign({},t.architectConfig[e].value,r),t},this.getArchitect=function(e){return(t.architectConfig[e]||{}).value},this.__asset=function(e,r,n){if(!i(r))return t.debug&&o("[$asset] asCallback must be a function"),null;if("project"!==e&&"cache"!==e){var a=t.lastProjectID(n);return n=t.validProjectID(a||n),t.getArchitect(n)?void 0!==t.getArchitect(n)[e]?r.call(t,t.getArchitect(n)[e]):(t.debug&&o("[$asset] assetName for architect doesnt exist"),null):(t.debug&&o("[$asset] architectConfig for assetName doesnt exist"),null)}t.debug&&o("[$asset] 'project, cache' are  restricted")},this.__architect=function(r,s){if(!i(r))return t.debug&&a("[$architect] callback must be set"),t;var c=r.call(t);if(!e(c))return t.debug&&a("[architect] must return a valid object settings {project, asset}, at least 1 is required"),t;var u=(c.project||{}).id,l=t.lastProjectID(s);if(!(s=t.validProjectID(l||s||u)))return t.debug&&a("[$architect] if this is a new project, you must specify projectID"),t;var h,d,f,p=Object.entries(c).reduce((function(t,e){var r,i,a=(i=2,function(t){if(Array.isArray(t))return t}(r=e)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(r,i)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(r,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],s=a[1];return-1!==["project","asset","cache"].indexOf(o)&&(t[o]=s),t}),{});for(var y in(t.getArchitect(s)||{}).cache?p.cache=t.getArchitect(s).cache:(p.cache||(p.cache={project:!1,asset:!1}),t.setArchitect(s,{cache:p.cache})),p){var v=p[y],b=!0===p.cache[y]&&("project"===y||"asset"===y);if("project"===y){try{if(b&&t.getArchitect(s)[y])continue}catch(t){}t.setArchitect(s,{project:t.$payload(v,v.async,v.type).d})}if("asset"===y){if(!v.name||!v.value)return t.debug&&o("[$architect] asset must include {value, name}"),t;if("project"===v.name||"cache"===v.name)return t.debug&&o('[$architect] asset props, "project, cache" are reserved'),t;try{if(b&&t.getArchitect(s)[v.name])continue}catch(t){}t.setArchitect(s,(h={},d=v.name,f=v.value,d in h?Object.defineProperty(h,d,{value:f,enumerable:!0,configurable:!0,writable:!0}):h[d]=f,h))}}return t}}}},function(t,e,r){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}e.Probe=function(){var t=r(0),e=t.isString,a=t.isArray,o=t.warn,s=t.log,c=t.isNumber,u=t.onerror,l=t.last,h=t.copy,d=t.isObject,f=r(1);return function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(n(this,t),this.debug=a||!1,(c(r.id)||r.id)&&(r.id=r.id.toString()),!r.task||!e(r.task))throw"task as string is required";this._id=null,this._error=[],this._ref=null,this._task=null,this._status=null,this._data=null,this._compaign=null,this._dataIndex=0,this._statusIndex=0,this._statusAsync=[],this.emitter=i||null,this.task=r.task,this.id=r.id,this.status="open",r.ref!==this._ref&&(this.ref=r.ref),r.data!==this._data&&(this.data=r.data),r.compaign&&(this.compaign=r.compaign),this._completeAsync=f()}var r,p;return r=t,(p=[{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"complete"===this.status||"send"===this.status?(this.debug&&o("[Probe][update] cannot update data on complete status"),this):!d(t)&&e?(this.debug&&o("[Probe][update] cannot update none object 'data' with option 'merge=true' set"),this):(d(t)&&e?this.data=Object.assign({},this.data,t):void 0!==t&&(this.data=t),this)}},{key:"all",value:function(){return{error:this.error,ref:this.ref,compaign:this.compaign,data:this.data,id:this.id,task:this.task,status:this.status}}},{key:"onComplete",value:function(t){var e=this;("complete"===t||"error"===t)&&"send"!==this._status&&this._dataIndex>0&&(this.emitter&&setTimeout((function(){e.emitter({probe:e,status:t})})),this.sq.resolve({probe:this.all()}),this._status="send")}},{key:"onOpenStatus",value:function(t){var e=this;"open"===t&&this.emitter&&setTimeout((function(){e.emitter({probe:e,status:"open"})}))}},{key:"sq",get:function(){return this._sq||(this._sq=f()),this._sq}},{key:"id",set:function(t){if(this._id)this.debug&&o("cannot update already set id: ".concat(this._id));else{if(!t)throw"id is required";if(t.split(" ").length>1)throw"each id cannot have spaces";if(-1===t.indexOf("::"))throw"each id must be of format id::taskName";if(-1!==t.indexOf(":::"))throw"each id must be of format id::taskName";var e=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(e,"gi").test(t))throw"your id is invalid, allowed chars: ".concat(e);if(-1===(t=t.replace(/ /gi,"_").toLowerCase()).indexOf(this._task))throw"wrong id setup, your id should make up the taks name, example: id='cocacola::drink'";this._id=t}},get:function(){return this._id}},{key:"error",set:function(t){t&&(!(t||[]).length&&a(t)||(this._error.push(t),this._error=this._error.filter((function(t){return!!t}))))},get:function(){return this._error.length?this._error:null}},{key:"ref",get:function(){return this._ref},set:function(t){t&&(e(t)?"complete"!==this.status&&"send"!==this._compaign.status&&(this._ref=t):o("[ref] must be a string"))}},{key:"compaign",get:function(){return this._compaign},set:function(t){void 0!==t&&(this._compaign?this.debug&&o("cannot update already set compaign ".concat(this._compaign)):t&&(e(t)?this._compaign=t:this.debug&&o("compaign must be a string",t)))}},{key:"task",set:function(t){if(void 0!==t)if(this._task)this.debug&&o("cannot update already set task");else if(t)if(e(t)){if(-1!==t.indexOf("::"))throw"task seperator :: is restricted";if(t.split(" ").length>1)throw"task cannot have spaces, use seperators: _+";var r=/[`~!@#$%^&*()\=?;'",.<>\{\}\[\]\\\/]/gi;if(new RegExp(r,"gi").test(t))throw"your task is invalid, allowed chars: ".concat(r);this._task=t.replace(/ /gi,"_").toLowerCase()}else this.debug&&o("task must be a string")},get:function(){return this._task}},{key:"data",set:function(t){if(void 0!==t){if("complete"===this.status||"send"===this.status)return this.debug&&o("you cannot update data once the status is complete or send"),null;this._dataIndex++,"open"===this.status&&null!==this._data&&this._dataIndex>1&&(this.status="updated"),this._data=t}},get:function(){return this._data}},{key:"statusStackOrder",get:function(){return{open:{value:1,set:!1},updated:{value:2,set:!1},complete:{value:3,set:!1},send:{value:4,set:!1},error:{value:5,set:!1}}}},{key:"status",get:function(){return this._status},set:function(t){var e=this;!function(r){try{if(e.statusStackOrder[r].value>2&&!0===e.statusStackOrder[r].set)return!1}catch(t){u("statusStackOrder invalid status")}if("complete"===e._status||"send"===e._status)return e.debug&&o("cannot update status if already complete, id:".concat(e.id)),!1;switch(r){case"open":if("updated"===e._status){e.debug&&o("cannot set status back to open once set to updated");break}e._status=r,e.statusStackOrder[r].set=!0,e.onOpenStatus(t),e.setStatusAsync=r;break;case"updated":if("complete"===e._status){e.debug&&o("cannot update status to 'updated' then previously set to 'complete'");break}e._dataIndex>0&&(e._status=r,e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e.debug&&s("id:".concat(e.id,", data updated")));break;case"complete":e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e._status=r,e.onComplete(t);break;case"send":if("complete"!==e._status){e.debug&&o("cannot update status to 'send' then previously not set to 'complete'");break}e._status=r,e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e._completeAsync.resolve({status:e._status,id:e.id});break;case"error":if("complete"===e._status)return;e.statusStackOrder[r].set=!0,e.setStatusAsync=r,e.onComplete(t);break;default:e.debug&&o("id:".concat(e.id,",  you set invalid status: ").concat(r,", nothing changed"))}}(t)}},{key:"setStatusAsync",set:function(t){var e={timestamp:(new Date).getTime(),p:f()};this._statusAsync.push(e)},get:function(){var t=l(this._statusAsync.sort((function(t,e){return t.timestamp-e.timestamp})).map((function(t){return t.p})));return t.resolve(h(this.status)),t}},{key:"getStatusAsync",get:function(){return this.setStatusAsync.promise()}},{key:"completeAsync",get:function(){return this._completeAsync.promise()}},{key:"statusAsync",get:function(){return this.getStatusAsync}}])&&i(r.prototype,p),t}()}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}t.exports=function(t){var e=r(0),n=e.copy,a=e.warn,h=e.isArray,d=e.onerror,f=e.objectSize,p=e.isString,y=e.uniq,v=e.isFunction;return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(k,t);var e,r,b,g,m=(b=k,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=l(b);if(g){var r=l(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return u(this,t)});function k(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,k),m.call(this,t,e)}return e=k,(r=[{key:"$architect",value:function(){return this.architect?this.__architect.apply(this,arguments):(this.debug&&a('[$architect] "opts.architect" must be set to use this option'),this)}},{key:"$asset",value:function(){return this.architect?this.__asset.apply(this,arguments):(this.debug&&a('[$asset] "opts.architect" must be set to use this option'),null)}},{key:"$probeStatusAsync",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);return s(l(k.prototype),"$probeStatusAsync",this).call(this,e)}},{key:"$get",value:function(t,e){t=this.selectByTask(t,!0);var r=this.lastProbeID(t);return s(l(k.prototype),"$get",this).call(this,r,e)}},{key:"$getByRef",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object.assign(this.pocket).filter((function(e,r){var n=i(e,2);return n[0],n[1].ref===t}))}},{key:"$set",value:function(t,e){e=this.selectByTask(e,!0);var r=this.lastProbeID(e);return s(l(k.prototype),"$set",this).call(this,t,r)}},{key:"$probe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=this.selectByTask(t,!0);var e=this.lastProbeID(t);if(this.pocket[e]){if("Probe"===this.pocket[e].constructor.name)return this.pocket[e];this.debug&&d("[$probe] probeID: ".concat(t," is not an instance of Probe{}"))}else this.debug&&a("[$probe] not found for probeID: ".concat(t))}},{key:"$update",value:function(t,e,r){r=this.selectByTask(r,!0);var n=this.lastProbeID(r);return s(l(k.prototype),"$update",this).call(this,t,e,n)}},{key:"$select",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=p(t)?t:"",this.lastProjectID(t),this}},{key:"$filter",value:function(t,e){var r=this;e=this.lastProjectID(e);var n=function(t){return r.d=t,r};return v(t)?this.payloadData[e]?(this._lastFilterList[e]=[],this.projectProbeList(e).forEach((function(n,i){var a=t.call(n,n);void 0===a||!0!==a&&1!==a||r._lastFilterList[e].push(n)})),n(this._lastFilterList[e])):(this.debug&&a("[$filter] no projectID found"),n(null)):n([])}},{key:"$compute",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";r=this.lastProjectID(r);var n=function(t){return t&&delete e._lastFilterList[r],e.d=t,e};return v(t)?this.payloadData[r]?(this._lastFilterList[r]||[]).length?(this._lastFilterList[r].forEach((function(e){"complete"===e.status&&"send"===e.status||t.call(e,e)})),n(this._lastFilterList[r])):(this.projectProbeList(r).forEach((function(e){"complete"===e.status&&"send"===e.status||t.call(e,e)})),n(this.projectProbeList(r))):(this.debug&&a("[$compute] no project found fo your/last id projectID:".concat(r)),n(null)):(this.debug&&a("[$compute] cb must be a function"),n(null))}},{key:"$list",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"self";if(e=this.lastProjectID(e),!this.payloadData[e])return[];var a=function(){return Object.entries(t.pocket).reduce((function(t,r,n){var a=i(r,2),o=(a[0],a[1]);return o.id.includes(e)&&t.push(o),t}),[])};return v(r)?(this.projectProbeList(e).forEach((function(t){r(t.all())})),"self"!==n&&n?"list"===n?a():void 0:this):a()}},{key:"$transfer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=this.selectByTask(t,!0),t=this.lastProbeID(t),this.pocket[t]?(this.storeTransfers(t,n(this.pocket[t].data)),this.$transfer_lastID=t,this):(this.debug&&a("[$transfer] no Probe{} found for this id fromProbeID:".concat(t)),this)}},{key:"$to",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(t=this.selectByTask(t,e),e&&(t=this.validProbe(t)),!t)return this.debug&&a("[$to] toProbeID is invalid"),this;if(!this.pocket[t])return this.debug&&a("[$to] no Probe{} found for this id toProbeID:".concat(t)),this;if(this.$transfer_lastID){var n=this.accessLastValidTransfer(r);if(f(n)){var i=n.fromProbeID,o=n.data;if(this.$transfer_lastID===i){if("complete"===this.pocket[t].status||"send"===this.pocket[t].status)return this.debug&&a("[$to] cannot transfer since toProbeID: ".concat(t," is already complete")),this.$transfer_lastID="",this;this.pocket[i].data=null,this.pocket[t].data=o}}else this.debug&&a("[$to] no last valid transfer found");this.$transfer_lastID=""}return this}},{key:"$of",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.selectByTask(t,!0),this}},{key:"$data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=this.selectByTask(e,!0),this.pocket[e]?(h(t)&&(t||[]).length&&(t=y(t).reduce((function(t,e){return void 0!==e&&(t[e.trim()]=!0),t}),{})),t&&f(t)?this.dataPropSelector("data()",e,t,r,n(this.pocket[e].data)):(this._$cached_data[e]=n(this.pocket[e].data),r?this:this._$cached_data[e])):r?this:void 0}},{key:"$cached",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e=this.selectByTask(e,!0),this.pocket[e]){var r=void 0!==this._$cached_data[e]&&null!==this._$cached_data[e];if(r)return p(t)&&(t||"").length&&(t=y(t.trim().replace(/ /gi,"").split(",")).reduce((function(t,e){return void 0!==e&&(t[e]=!0),t}),{})),!f(this._$cached_data[e])&&r?f(t)?void 0:this._$cached_data[e]:t&&f(t)?this.dataPropSelector("cached()",e,t,!1,this._$cached_data[e]):void 0===this._$cached_data[e]?void 0:this._$cached_data[e]}}},{key:"$compaign",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].compaign):null}},{key:"$ref",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].ref):null}},{key:"$status",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].status):null}},{key:"$task",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].task):null}},{key:"$error",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].error):null}},{key:"$all",value:function(t){return t=this.selectByTask(t,!0),this.pocket[t]?n(this.pocket[t].all()):null}}])&&o(e.prototype,r),k}(t)}}]));
//# sourceMappingURL=pocket_browser.9d8fab1a.js.map